import{jsx as t,jsxs as d,Fragment as re}from"react/jsx-runtime";import{useState as u,useMemo as Re}from"react";import{b as G,L as se,K as ye,aF as Se,bK as Oe,ao as Ne,be as Te,j as De,bw as Pe,u as M,a as Le,g as _e,aM as we,F as xe,a0 as h,a3 as b,I as Y,J as ee,a6 as P,a7 as f,S as te,E as D,h as K,f as ae,q as Ke,bL as Ve,ag as Ue,P as Ge,bM as ne,C as Me}from"./index-C9t2UlUN.js";import{K as Q}from"./KeycloakTextInput-DrlF32nr.js";import{L as be}from"./PaginatingTableToolbar-oQUfBy2J.js";import{R as He,u as je}from"./RoutableTabs-vx5wTdby.js";import{ac as Be,ad as We,ae as $e,af as ze,a1 as fe,a2 as ve,ag as Je}from"./KeycloakDataTable-2rLFZPhG.js";import{V as Xe}from"./ViewHeader-cxZm8XhN.js";import{D as ge}from"./DropdownPanel-UFbgzvY8.js";import{u as ke,F as Ce}from"./useFormatDate-Yp0qEhJS.js";import{p as Fe}from"./pickBy-3m0iiQTY.js";import{C as Ze,L as qe}from"./CodeEditor-Cp4g17EF.js";import{F as Ee,a as V}from"./FlexItem-BEayPdRt.js";import{F as Ie,A as Ae}from"./Form-Cdw1qhWG.js";import{D as U}from"./DatePicker-D83L1Ym_.js";import{M as Qe,a as Ye}from"./Modal-Bgkd26UL.js";import{T as et}from"./Trans-DcN6j3pV.js";import{W as tt}from"./warning-triangle-icon-BwpfST2i.js";import{a as oe,b as ie}from"./Tabs-CjrDEqsl.js";import{D as at,a as le,b as ce,c as de}from"./DescriptionListTerm-CWlDWEWz.js";import"react-dom";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./ToolbarContent-D6TJq6fk.js";import"./PageHandler-TK8xnd8P.js";import"./DynamicComponents-D5DD9CFr.js";import"./FileUpload-CTw4RKK1.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./useToggle-K3Kx99tM.js";import"./ConfirmDialog-BDkqxnFL.js";import"./DataListItemRow-Bimi62Tu.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./KeySelect-CPI9XGq0.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";import"./PageList-59HC89eh.js";import"./copy-icon-CYSS18Ce.js";import"./MenuList-Br-Zu33q.js";const pe=38,rt=({text:e,children:o})=>{const l=e||"",m=l.length>pe,C=l.substring(0,pe);return m?t(ye,{content:e,children:o(C+"â€¦")}):o(l)},st=e=>e.operationType==="DELETE"?!1:e.resourceType==="USER"||e.resourceType==="GROUP_MEMBERSHIP"||e.resourceType==="GROUP"||e.resourceType==="CLIENT"||e.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||e.resourceType==="CLIENT_SCOPE"||e.resourceType==="AUTH_FLOW"||e.resourcePath?.startsWith("roles-by-id"),nt=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),ot=(e,o)=>{const l=nt.exec(o.resourcePath);if(!l)return console.warn("event didn't contain a valid link",o),"";const m=l[1];return o.resourceType==="CLIENT"||o.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?Se({realm:e,clientId:m,tab:o.resourceType==="CLIENT"?"settings":"authorization"}):o.resourceType==="GROUP"?Oe({realm:e,id:m}):o.resourceType==="CLIENT_SCOPE"?Ne({realm:e,id:m,tab:"settings"}):o.resourceType==="USER"||o.resourceType==="GROUP_MEMBERSHIP"?Te({realm:e,id:m,tab:"settings"}):o.resourceType==="AUTH_FLOW"?De({realm:e,id:m,usedBy:"-"}):o.resourcePath?.startsWith("roles-by-id")?Pe({realm:e,id:m,tab:"details"}):""},it=({event:e})=>{const{realm:o}=G();return t(rt,{text:e.resourcePath,children:l=>st(e)?t(se,{to:ot(o,e),children:l}):t("span",{children:l})})},lt=e=>t(it,{event:e}),me={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},ue=({titleKey:e,onClose:o,children:l})=>{const{t:m}=M();return t(Qe,{variant:Ye.medium,title:m(e),isOpen:!0,onClose:o,children:l})},ct=()=>{const{t:e}=M(),{realm:o}=G(),l=Le(),m=ke(),C=l.enums?.resourceType,H=l.enums?.operationType,[F,j]=u(0),[B,L]=u(!1),[W,v]=u(!1),[$,z]=u(!1),[T,E]=u({}),[y,I]=u(),[_,w]=u(),J={resourceTypes:e("resourceTypes"),operationTypes:e("operationTypes"),resourcePath:e("resourcePath"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),authClient:e("client"),authUser:e("userId"),authRealm:e("realm"),authIpAddress:e("ipAddress")},A=_e({mode:"onChange",defaultValues:me}),{getValues:R,reset:S,formState:{isDirty:x},control:g}=A;function X(a,r){return ae.realms.findAdminEvents({...T,realm:o,first:a,max:r})}function Z(){L(!1),n()}function k(){S(),n()}function q(a){const r={...R()};delete r[a],S({...me,...r}),n()}function s(a,r){const i=R(),c=i[a],O=Array.isArray(c)?c.filter(N=>N!==r):c;S({...i,[a]:O}),n()}function n(){const a=Fe(R(),r=>r!==""||Array.isArray(r)&&r.length>0);E(a),j(F+1)}const p=Re(()=>_?.representation?we(JSON.parse(_.representation)):"",[_?.representation]);return d(re,{children:[y&&t(ue,{titleKey:"auth",onClose:()=>I(void 0),children:d(Be,{"aria-label":"authData","data-testid":"auth-dialog",variant:We.compact,cells:[e("attribute"),e("value")],rows:[[e("realm"),y.authDetails?.realmId],[e("client"),y.authDetails?.clientId],[e("user"),y.authDetails?.userId],[e("ipAddress"),y.authDetails?.ipAddress]],children:[t($e,{}),t(ze,{})]})}),_&&t(ue,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>w(void 0),children:t(Ze,{isLineNumbersVisible:!0,isReadOnly:!0,code:p,language:qe.json,height:"8rem"})}),t(fe,{loader:X,isPaginated:!0,ariaLabelKey:"adminEvents",toolbarItem:t(xe,{...A,children:d(Ee,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[t(V,{children:t(ge,{buttonText:e("searchForAdminEvent"),setSearchDropdownOpen:L,searchDropdownOpen:B,marginRight:"2.5rem",width:"15vw",children:d(Ie,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[t(h,{label:e("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:t(b,{name:"resourceTypes",control:g,render:({field:a})=>t(Y,{className:"keycloak__events_search__type_select",name:"resourceTypes","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:e("hide"),collapsedText:e("showRemaining")},variant:ee.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>v(r),selections:a.value,onSelect:(r,i)=>{const c=i.toString(),O=a.value.includes(c)?a.value.filter(N=>N!==c):[...a.value,c];a.onChange(O)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:W,"aria-labelledby":"resourceTypes",chipGroupComponent:t(P,{children:a.value.map(r=>t(f,{onClick:i=>{i.stopPropagation(),a.onChange(a.value.filter(c=>c!==r))},children:r},r))}),children:C?.map(r=>t(te,{value:r},r))})})}),t(h,{label:e("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:t(b,{name:"operationTypes",control:g,render:({field:a})=>t(Y,{className:"keycloak__events_search__type_select",name:"operationTypes","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:e("hide"),collapsedText:e("showRemaining")},variant:ee.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>z(r),selections:a.value,onSelect:(r,i)=>{const c=i.toString(),O=a.value.includes(c)?a.value.filter(N=>N!==c):[...a.value,c];a.onChange(O)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:$,"aria-labelledby":"operationTypes",chipGroupComponent:t(P,{children:a.value.map(r=>t(f,{onClick:i=>{i.stopPropagation(),a.onChange(a.value.filter(c=>c!==r))},children:r},r))}),children:H?.map(r=>t(te,{value:r},r))})})}),t(D,{name:"resourcePath",label:e("resourcePath")}),t(D,{name:"authRealm",label:e("realm")}),t(D,{name:"authClient",label:e("client")}),t(D,{name:"authUser",label:e("user")}),t(D,{name:"authIpAddress",label:e("ipAddress")}),t(h,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(b,{name:"dateFrom",control:g,render:({field:a})=>t(U,{className:"pf-u-w-100",value:a.value,onChange:(r,i)=>a.onChange(i),inputProps:{id:"kc-dateFrom"}})})}),t(h,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(b,{name:"dateTo",control:g,render:({field:a})=>t(U,{className:"pf-u-w-100",value:a.value,onChange:(r,i)=>a.onChange(i),inputProps:{id:"kc-dateTo"}})})}),d(Ae,{children:[t(K,{variant:"primary",onClick:Z,"data-testid":"search-events-btn",isDisabled:!x,children:e("searchAdminEventsBtn")}),t(K,{variant:"secondary",onClick:k,isDisabled:!x,children:e("resetBtn")})]})]})})}),t(V,{children:Object.entries(T).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(T).map(a=>{const[r,i]=a;return t(P,{className:"pf-u-mt-md pf-u-mr-md",categoryName:J[r],isClosable:!0,onClick:()=>q(r),children:typeof i=="string"?t(f,{isReadOnly:!0,children:i}):i.map(c=>t(f,{onClick:()=>s(r,c),children:c},c))},r)})})})]})}),actions:[{title:e("auth"),onRowClick:a=>I(a)},{title:e("representation"),onRowClick:a=>w(a)}],columns:[{name:"time",displayKey:"time",cellRenderer:a=>m(new Date(a.time),Ce)},{name:"resourcePath",displayKey:"resourcePath",cellRenderer:lt},{name:"resourceType",displayKey:"resourceType"},{name:"operationType",displayKey:"operationType",transforms:[ve(10)]},{name:"",displayKey:"user",cellRenderer:a=>a.authDetails?.userId||""}],emptyState:t(be,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(T).length>0},F)]})},he={client:"",dateFrom:"",dateTo:"",user:"",type:[],ipAddress:""},dt=e=>e.error?t(ye,{content:e.error,children:d("span",{children:[t(tt,{color:"orange"})," ",e.type]})}):d("span",{children:[t(Me,{color:"green"})," ",e.type]}),pt=e=>d(at,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[e.details&&Object.entries(e.details).map(([o,l])=>d(le,{children:[t(ce,{children:o}),t(de,{children:l})]},o)),e.error&&d(le,{children:[t(ce,{children:"error"}),t(de,{children:e.error})]},"error")]}),mt=e=>{const{t:o}=M(),{realm:l}=G();return d(re,{children:[e.userId&&t(se,{to:Te({realm:l,id:e.userId,tab:"settings"}),children:e.userId},`link-${e.time}-${e.type}`),!e.userId&&o("noUserDetails")]})};function ta(){const{t:e}=M(),{realm:o}=G(),l=ke(),[m,C]=u(0),[H,F]=u(!1),[j,B]=u(!1),[L,W]=u(),[v,$]=u({}),z={client:e("client"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),user:e("userId"),type:e("eventType"),ipAddress:e("ipAddress")},{getValues:T,register:E,reset:y,formState:{isDirty:I},control:_,handleSubmit:w}=_e({mode:"onChange",defaultValues:he});Ke(()=>ae.realms.getConfigEvents({realm:o}),s=>W(s),[]);function J(s,n){return ae.realms.findEvents({...v,realm:o,first:s,max:n})}const A=s=>je(ne({realm:o,tab:s})),R=A("user-events"),S=A("admin-events");function x(){F(!1),k()}function g(){y(),k()}function X(s){const n={...T()};delete n[s],y({...he,...n}),k()}function Z(s,n){const p=T(),a=p[s],r=Array.isArray(a)?a.filter(i=>i!==n):a;y({...p,[s]:r}),k()}function k(){const s=Fe(T(),n=>n!==""||Array.isArray(n)&&n.length>0);$(s),C(m+1)}const q=()=>d(Ee,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[t(V,{children:t(ge,{buttonText:e("searchForUserEvent"),setSearchDropdownOpen:F,searchDropdownOpen:H,marginRight:"2.5rem",width:"15vw",children:d(Ie,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:w(x),isHorizontal:!0,children:[t(h,{label:e("userId"),fieldId:"kc-userId",className:"keycloak__events_search__form_label",children:t(Q,{id:"kc-userId","data-testid":"userId-searchField",...E("user")})}),t(h,{label:e("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:t(b,{name:"type",control:_,render:({field:s})=>t(Y,{className:"keycloak__events_search__type_select",name:"eventType","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:e("hide"),collapsedText:e("showRemaining")},variant:ee.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:n=>B(n),selections:s.value,onSelect:(n,p)=>{const a=p.toString(),r=s.value.includes(a)?s.value.filter(i=>i!==a):[...s.value,a];s.onChange(r)},onClear:n=>{n.stopPropagation(),s.onChange([])},isOpen:j,"aria-labelledby":"eventType",chipGroupComponent:t(P,{children:s.value.map(n=>t(f,{onClick:p=>{p.stopPropagation(),s.onChange(s.value.filter(a=>a!==n))},children:e(`eventTypes.${n}.name`)},n))}),children:L?.enabledEventTypes?.map(n=>t(te,{value:n,children:e(`eventTypes.${n}.name`)},n))})})}),t(h,{label:e("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:t(Q,{id:"kc-client","data-testid":"client-searchField",...E("client")})}),t(h,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(b,{name:"dateFrom",control:_,render:({field:s})=>t(U,{className:"pf-u-w-100",value:s.value,onChange:(n,p)=>s.onChange(p),inputProps:{id:"kc-dateFrom"}})})}),t(h,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(b,{name:"dateTo",control:_,render:({field:s})=>t(U,{className:"pf-u-w-100",value:s.value,onChange:(n,p)=>s.onChange(p),inputProps:{id:"kc-dateTo"}})})}),t(h,{label:e("ipAddress"),fieldId:"kc-ipAddress",className:"keycloak__events_search__form_label",children:t(Q,{id:"kc-ipAddress","data-testid":"ipAddress-searchField",...E("ipAddress")})}),d(Ae,{children:[t(K,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!I,children:e("searchUserEventsBtn")}),t(K,{variant:"secondary",onClick:g,isDisabled:!I,children:e("resetBtn")})]})]})})}),t(V,{children:Object.entries(v).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(v).map(s=>{const[n,p]=s;return t(P,{className:"pf-u-mt-md pf-u-mr-md",categoryName:z[n],isClosable:!0,onClick:()=>X(n),children:typeof p=="string"?t(f,{isReadOnly:!0,children:p}):p.map(a=>t(f,{onClick:()=>Z(n,a),children:e(`eventTypes.${a}.name`)},a))},n)})})})]});return d(re,{children:[t(Xe,{titleKey:"titleEvents",subKey:d(et,{i18nKey:"eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",t(se,{to:Ve({realm:o,tab:"events"}),children:e("eventConfig")}),"page realm settings to configure."]}),helpUrl:Ue.eventsUrl,divider:!1}),t(Ge,{variant:"light",className:"pf-u-p-0",children:d(He,{isBox:!0,defaultLocation:ne({realm:o,tab:"user-events"}),children:[t(oe,{title:t(ie,{children:e("userEvents")}),...R,children:t("div",{className:"keycloak__events_table",children:t(fe,{loader:J,detailColumns:[{name:"details",enabled:s=>s.details!==void 0,cellRenderer:pt}],isPaginated:!0,ariaLabelKey:"titleEvents",toolbarItem:q(),columns:[{name:"time",displayKey:"time",cellFormatters:[Je],cellRenderer:s=>l(new Date(s.time),Ce)},{name:"userId",displayKey:"user",cellRenderer:mt},{name:"type",displayKey:"eventType",cellRenderer:dt},{name:"ipAddress",displayKey:"ipAddress",transforms:[ve(10)]},{name:"clientId",displayKey:"client"}],emptyState:t(be,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(v).length>0},m)})}),t(oe,{title:t(ie,{children:e("adminEvents")}),"data-testid":"admin-events-tab",...S,children:t(ct,{})})]})})]})}export{ta as default};
//# sourceMappingURL=EventsSection-CbEJ9E3m.js.map
