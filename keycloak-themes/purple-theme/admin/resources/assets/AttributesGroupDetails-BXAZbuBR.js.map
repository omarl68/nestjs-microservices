{"version":3,"file":"AttributesGroupDetails-BXAZbuBR.js","sources":["../../src/realm-settings/user-profile/AttributesGroupForm.tsx","../../src/realm-settings/user-profile/AttributesGroupDetails.tsx"],"sourcesContent":["import type { UserProfileGroup } from \"@keycloak/keycloak-admin-client/lib/defs/userProfileMetadata\";\nimport {\n  ActionGroup,\n  Button,\n  FormGroup,\n  PageSection,\n  Text,\n  TextContent,\n} from \"@patternfly/react-core\";\nimport { useEffect, useMemo } from \"react\";\nimport { FormProvider, SubmitHandler, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate, useParams } from \"react-router-dom\";\n\nimport { FormAccess } from \"../../components/form/FormAccess\";\nimport { HelpItem } from \"ui-shared\";\nimport type { KeyValueType } from \"../../components/key-value-form/key-value-convert\";\nimport { KeyValueInput } from \"../../components/key-value-form/KeyValueInput\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport type { EditAttributesGroupParams } from \"../routes/EditAttributesGroup\";\nimport { toUserProfile } from \"../routes/UserProfile\";\nimport { useUserProfile } from \"./UserProfileContext\";\n\nimport \"../realm-settings-section.css\";\n\nfunction parseAnnotations(input: Record<string, unknown>): KeyValueType[] {\n  return Object.entries(input).reduce((p, [key, value]) => {\n    if (typeof value === \"string\") {\n      return [...p, { key, value }];\n    } else {\n      return [...p];\n    }\n  }, [] as KeyValueType[]);\n}\n\nfunction transformAnnotations(input: KeyValueType[]): Record<string, unknown> {\n  return Object.fromEntries(\n    input\n      .filter((annotation) => annotation.key.length > 0)\n      .map((annotation) => [annotation.key, annotation.value] as const),\n  );\n}\n\ntype FormFields = Required<Omit<UserProfileGroup, \"annotations\">> & {\n  annotations: KeyValueType[];\n};\n\nconst defaultValues: FormFields = {\n  annotations: [],\n  displayDescription: \"\",\n  displayHeader: \"\",\n  name: \"\",\n};\n\nexport default function AttributesGroupForm() {\n  const { t } = useTranslation();\n  const { realm } = useRealm();\n  const { config, save } = useUserProfile();\n  const navigate = useNavigate();\n  const params = useParams<EditAttributesGroupParams>();\n  const form = useForm<FormFields>({ defaultValues });\n\n  const matchingGroup = useMemo(\n    () => config?.groups?.find(({ name }) => name === params.name),\n    [config?.groups],\n  );\n\n  useEffect(() => {\n    if (!matchingGroup) {\n      return;\n    }\n\n    const annotations = matchingGroup.annotations\n      ? parseAnnotations(matchingGroup.annotations)\n      : [];\n\n    form.reset({ ...defaultValues, ...matchingGroup, annotations });\n  }, [matchingGroup]);\n\n  const onSubmit: SubmitHandler<FormFields> = async (values) => {\n    if (!config) {\n      return;\n    }\n\n    const groups = [...(config.groups ?? [])];\n    const updateAt = matchingGroup ? groups.indexOf(matchingGroup) : -1;\n    const updatedGroup: UserProfileGroup = {\n      ...values,\n      annotations: transformAnnotations(values.annotations),\n    };\n\n    if (updateAt === -1) {\n      groups.push(updatedGroup);\n    } else {\n      groups[updateAt] = updatedGroup;\n    }\n\n    const success = await save({ ...config, groups });\n\n    if (success) {\n      navigate(toUserProfile({ realm, tab: \"attributes-group\" }));\n    }\n  };\n\n  return (\n    <>\n      <ViewHeader\n        titleKey={matchingGroup ? \"editGroupText\" : \"createGroupText\"}\n        divider\n      />\n      <PageSection variant=\"light\" onSubmit={form.handleSubmit(onSubmit)}>\n        <FormAccess isHorizontal role=\"manage-realm\">\n          <FormGroup\n            label={t(\"nameField\")}\n            fieldId=\"kc-name\"\n            isRequired\n            helperTextInvalid={t(\"required\")}\n            validated={form.formState.errors.name ? \"error\" : \"default\"}\n            labelIcon={\n              <HelpItem helpText={t(\"nameHintHelp\")} fieldLabelId=\"nameField\" />\n            }\n          >\n            <KeycloakTextInput\n              id=\"kc-name\"\n              isReadOnly={!!matchingGroup}\n              {...form.register(\"name\", { required: true })}\n            />\n            {!!matchingGroup && (\n              <input type=\"hidden\" {...form.register(\"name\")} />\n            )}\n          </FormGroup>\n          <FormGroup\n            label={t(\"displayHeaderField\")}\n            fieldId=\"kc-display-header\"\n            labelIcon={\n              <HelpItem\n                helpText={t(\"displayHeaderHintHelp\")}\n                fieldLabelId=\"displayHeaderField\"\n              />\n            }\n          >\n            <KeycloakTextInput\n              id=\"kc-display-header\"\n              {...form.register(\"displayHeader\")}\n            />\n          </FormGroup>\n          <FormGroup\n            label={t(\"displayDescriptionField\")}\n            fieldId=\"kc-display-description\"\n            labelIcon={\n              <HelpItem\n                helpText={t(\"displayDescriptionHintHelp\")}\n                fieldLabelId=\"displayDescriptionField\"\n              />\n            }\n          >\n            <KeycloakTextInput\n              id=\"kc-display-description\"\n              {...form.register(\"displayDescription\")}\n            />\n          </FormGroup>\n          <TextContent>\n            <Text component=\"h2\">{t(\"annotationsText\")}</Text>\n          </TextContent>\n          <FormGroup label={t(\"annotationsText\")} fieldId=\"kc-annotations\">\n            <FormProvider {...form}>\n              <KeyValueInput label={t(\"annotationsText\")} name=\"annotations\" />\n            </FormProvider>\n          </FormGroup>\n          <ActionGroup>\n            <Button variant=\"primary\" type=\"submit\" data-testid=\"saveGroupBtn\">\n              {t(\"save\")}\n            </Button>\n            <Button\n              variant=\"link\"\n              component={(props) => (\n                <Link\n                  {...props}\n                  to={toUserProfile({ realm, tab: \"attributes-group\" })}\n                />\n              )}\n            >\n              {t(\"cancel\")}\n            </Button>\n          </ActionGroup>\n        </FormAccess>\n      </PageSection>\n    </>\n  );\n}\n","import AttributesGroupForm from \"./AttributesGroupForm\";\nimport { UserProfileProvider } from \"./UserProfileContext\";\n\nconst AttributesGroupDetails = () => (\n  <UserProfileProvider>\n    <AttributesGroupForm />\n  </UserProfileProvider>\n);\n\nexport default AttributesGroupDetails;\n"],"names":["parseAnnotations","input","p","key","value","transformAnnotations","annotation","defaultValues","AttributesGroupForm","useTranslation","realm","useRealm","config","save","useUserProfile","navigate","useNavigate","params","useParams","form","useForm","matchingGroup","useMemo","name","useEffect","annotations","onSubmit","values","groups","updateAt","updatedGroup","toUserProfile","jsxs","Fragment","jsx","ViewHeader","PageSection","FormAccess","FormGroup","HelpItem","KeycloakTextInput","TextContent","Text","FormProvider","KeyValueInput","ActionGroup","Button","props","Link","AttributesGroupDetails","UserProfileProvider"],"mappings":"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"}