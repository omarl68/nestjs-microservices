import{jsx as e,jsxs as o,Fragment as V}from"react/jsx-runtime";import*as qe from"react";import{useState as m,useMemo as Ct,useEffect as Be,Fragment as _n,useId as da,useRef as ft}from"react";import{_ as It,k as Ue,aI as ua,b as be,u as w,af as Ln,a as We,q as le,aJ as st,aK as pa,aL as nn,a0 as C,a1 as A,I as Q,J as W,S as z,ai as ha,aj as ma,f as x,ak as ga,aM as et,Z as ne,a3 as D,a9 as lt,aa as Re,ax as _,V as re,h as N,aN as fa,g as Ne,e as ce,B as Te,A as ee,E as Oe,aO as ze,P as ge,aP as Dn,G as Se,aQ as Pt,aR as Pe,aS as Ve,a2 as Ae,aT as ba,ac as ya,ae as Nn,Y as je,H as va,L as Ce,aU as kt,aV as Wt,aW as Sa,aX as Kn,aY as Ta,aZ as Ca,ad as Ge,a_ as Ia,a4 as it,F as Me,T as vt,a$ as ka,U as Le,K as Hn,c as rt,b0 as St,n as Ut,O as Jt,Q as Mn,D as tt,b1 as Aa,an as ot,b2 as an,b3 as Fn,b4 as sn,b5 as zn,b6 as ln,R as Tt,b7 as Ra,y as Ot,z as nt,b8 as Ea,b9 as xa,ba as wa,p as Oa,aq as Pa,av as _a,r as La,bb as Da,bc as rn,bd as Vn,be as Na,aE as Ka,bf as Ha,bg as Ma,bh as on,bi as cn,bj as Fa,aF as za,M as Va,N as dn,bk as qa}from"./index-C9t2UlUN.js";import{C as Qt,u as Ee}from"./ConfirmDialog-BDkqxnFL.js";import{K as ct}from"./KeycloakTextArea-DChmurIP.js";import{a as At,M as Je}from"./Modal-Bgkd26UL.js";import{F as Ie,A as _e}from"./Form-Cdw1qhWG.js";import{P as Ua}from"./PermissionTab-Cqx0kVF9.js";import{R as Ba}from"./RolesList-BkHvB0Et.js";import{R as Ht,u as Mt}from"./RoutableTabs-vx5wTdby.js";import{V as ja}from"./ViewHeader-cxZm8XhN.js";import{u as qn,F as Un}from"./useIsFeatureEnabled-CkHhuO9z.js";import{u as Yt}from"./useParams-DL8-63Ov.js";import{u as ke}from"./useToggle-K3Kx99tM.js";import{F as ue,a as _t,C as Ga,b as Bn}from"./FormAccess-DnQCcStE.js";import{K as $a}from"./KeyValueInput-BJlDoGlu.js";import{M as jn}from"./MultiLineInput-DibC-IV_.js";import{T as Xt}from"./TimeSelector-CWH4kuIN.js";import{s as Gn}from"./sortBy-CgAHVq9r.js";import{s as Wa,L as De,a as un,b as pn,P as Lt}from"./PaginatingTableToolbar-oQUfBy2J.js";import{a1 as Dt,a3 as Qe,a4 as Ye,a5 as oe,a6 as B,a7 as Xe,a8 as H,a9 as dt}from"./KeycloakDataTable-2rLFZPhG.js";import{u as $n,F as Ja}from"./useFormatDate-Yp0qEhJS.js";import{K as me}from"./KeycloakTextInput-DrlF32nr.js";import{E as Wn}from"./ExpandableSection-DjAskWMd.js";import{b as ye,T as Qa,c as Ya}from"./ToolbarContent-D6TJq6fk.js";import{S as Xa}from"./SessionsTable-BPkwHML9.js";import{C as Za,a as ei}from"./ClientDescription--30ytydx.js";import{L as ti}from"./LoginSettings-B0XCQ-X4.js";import{C as ni}from"./DynamicComponents-D5DD9CFr.js";import{U as Jn,N as hn,D as ai,A as ii}from"./NewPolicyDialog-Q18nUkuT.js";import{d as Qn,i as xt,g as si}from"./utils-DeGqqWSp.js";import{c as li}from"./camelCase-Df6HZkse.js";import{D as mn}from"./policyRepresentation-LeM_FTje.js";import{D as ut,a as ri,b as oi,c as ci}from"./DescriptionListTerm-CWlDWEWz.js";import{E as Yn,a as Xn}from"./EmptyStateBody-CyIhnUop.js";import{E as di}from"./EmptyStateSecondaryActions-BekVwNvY.js";import{D as ui}from"./DeleteScopeDialog-DQGMYZro.js";import{J as pi}from"./JsonFileUpload-BSVnFg4G.js";import{P as Bt}from"./PasswordInput-CJKuHljf.js";import{F as Zn}from"./FileUpload-CTw4RKK1.js";import{F as hi,a as gn}from"./FlexItem-BEayPdRt.js";import{S as mi,a as gi,C as fi,n as bi,t as yi}from"./SearchFilter-BsIw65oH.js";import{A as fn,d as bn,e as vi,a as Si,f as Ti,C as yn}from"./ClientScopeTypes-43MQv2_N.js";import{c as bt,T as Ci,a as ae,b as ie}from"./Tabs-CjrDEqsl.js";import{Q as Ii}from"./question-circle-icon-B-vzDm0d.js";import{R as ki}from"./AddRoleMappingModal-BWNuJU0W.js";import{T as Ai}from"./Trans-DcN6j3pV.js";import"react-dom";import"./PageHandler-TK8xnd8P.js";import"./PageList-59HC89eh.js";import"./copy-icon-CYSS18Ce.js";import"./KeySelect-CPI9XGq0.js";import"./_baseFlatten-BQ8y46Zj.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./ListItem-B-msUVzK.js";import"./SwitchControl-KjYluOpZ.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./DataListItemRow-Bimi62Tu.js";import"./CodeEditor-Cp4g17EF.js";import"./filter-icon-C8nM2k1N.js";import"./DatePicker-D83L1Ym_.js";import"./MenuList-Br-Zu33q.js";import"./capitalize-w6Zchk1l.js";import"./_baseSlice-F8doVSIJ.js";import"./FileUploadForm-DmYGfve4.js";const Et={codeBlock:"pf-c-code-block",codeBlockActions:"pf-c-code-block__actions",codeBlockCode:"pf-c-code-block__code",codeBlockContent:"pf-c-code-block__content",codeBlockHeader:"pf-c-code-block__header",codeBlockPre:"pf-c-code-block__pre"},ea=n=>{var{children:s=null,className:a,actions:t=null}=n,i=It(n,["children","className","actions"]);return qe.createElement("div",Object.assign({className:Ue(Et.codeBlock,a)},i),qe.createElement("div",{className:Ue(Et.codeBlockHeader)},qe.createElement("div",{className:Ue(Et.codeBlockActions)},t&&t)),qe.createElement("div",{className:Ue(Et.codeBlockContent)},s))};ea.displayName="CodeBlock";const ta=n=>{var{children:s=null,className:a}=n,t=It(n,["children","className"]);return qe.createElement("div",Object.assign({className:Ue("pf-c-code-block__actions-item",a)},t),s)};ta.displayName="CodeBlockAction";const jt=n=>{var{className:s,children:a}=n,t=It(n,["className","children"]);return qe.createElement("div",Object.assign({className:Ue(Wa.panelHeader,s)},t),a)};jt.displayName="PanelHeader";var Gt;(function(n){n.ul="ul",n.ol="ol",n.dl="dl"})(Gt||(Gt={}));const na=n=>{var{children:s=null,className:a="",component:t=Gt.ul,isPlain:i=!1}=n,l=It(n,["children","className","component","isPlain"]);const r=t;return qe.createElement(r,Object.assign({},l,{className:Ue(i&&ua.modifiers.plain,a)}),s)};na.displayName="TextList";var $t;(function(n){n.li="li",n.dt="dt",n.dd="dd"})($t||($t={}));const aa=n=>{var{children:s=null,className:a="",component:t=$t.li}=n,i=It(n,["children","className","component"]);const l=t;return qe.createElement(l,Object.assign({},i,{className:Ue(a)}),s)};aa.displayName="TextListItem";const Ri=({id:n,open:s,toggleDialog:a,protocol:t="openid-connect"})=>{const{realm:i}=be(),{t:l}=w(),{enabled:r}=Ln(),c=We().clientInstallations[t],[p,f]=m(c[c.length-1].id),[g,u]=m(),[h,S]=m(!1),R=Ct(()=>c.find(b=>b.id===p)??null,[p]),y=b=>b.replace(/<PrivateKeyPem>.*<\/PrivateKeyPem>/gs,`<PrivateKeyPem>${l("privateKeyMask")}</PrivateKeyPem>`);return le(async()=>{if(R?.mediaType==="application/zip")return(await ha(`${ga(x.baseUrl)}admin/realms/${i}/clients/${n}/installation/providers/${p}`,{method:"GET",headers:ma(await x.getAccessToken())})).arrayBuffer();{const b=await x.clients.getInstallationProviders({id:n,providerId:p});return typeof b=="string"?y(b):et(b)}},b=>u(b),[n,p]),Be(()=>u(""),[n,p]),e(Qt,{titleKey:l("downloadAdaptorTitle"),continueButtonLabel:l("download"),onConfirm:()=>{st.saveAs(new Blob([g],{type:R?.mediaType}),R?.filename)},open:s,toggleDialog:a,variant:At.medium,children:e(Ie,{children:o(pa,{hasGutter:!0,children:[e(nn,{children:e(C,{fieldId:"type",label:l("formatOption"),labelIcon:e(A,{helpText:l("downloadType"),fieldLabelId:"formatOption"}),children:e(Q,{toggleId:"type",isOpen:h,onToggle:b=>S(b),variant:W.single,value:p,selections:p,onSelect:(b,P)=>{f(P.toString()),S(!1)},"aria-label":"Select Input",menuAppendTo:()=>document.body,children:c.map(b=>e(z,{value:b.id,isSelected:p===b.id,description:r?b.helpText:void 0,children:b.displayType},b.id))})})}),!R?.downloadOnly&&e(nn,{isFilled:!0,children:e(C,{fieldId:"details",label:l("details"),labelIcon:e(A,{helpText:l("detailsHelp"),fieldLabelId:"details"}),children:e(ct,{id:"details",readOnly:!0,rows:12,resizeOrientation:"vertical",value:g&&typeof g=="string"?g:"","aria-label":"text area example"})})})]})})})},vn="tokenLifespan.inherited",Sn="tokenLifespan.expires",yt=({id:n,name:s,defaultValue:a,units:t})=>{const{t:i}=w(),[l,r]=m(!1),[d,c]=m(!1),p=()=>c(!0),f=()=>c(!1),{control:g}=ne(),u=h=>typeof h=="number"||typeof h=="string"&&h!==""||d;return e(C,{label:i(n),fieldId:n,labelIcon:e(A,{helpText:i(`${n}Help`),fieldLabelId:n}),children:e(D,{name:s,defaultValue:"",control:g,render:({field:h})=>o(lt,{hasGutter:!0,children:[e(Re,{children:o(Q,{variant:W.single,onToggle:r,isOpen:l,onSelect:(S,R)=>{h.onChange(R),r(!1)},selections:[u(h.value)?i(Sn):i(vn)],children:[e(z,{value:"",children:i(vn)}),e(z,{value:60,children:i(Sn)})]})}),e(Re,{children:e(Xt,{validated:u(h.value)&&h.value<1?"warning":"default",units:t,value:h.value===""?a:h.value,onChange:h.onChange,onFocus:p,onBlur:f,min:1,isDisabled:!u(h.value)})})]})})})},Ei=({save:n,reset:s,protocol:a,hasConfigureAccess:t})=>{const{t:i}=w(),[l,r]=m(!1),[d,c]=m(),{realm:p}=be(),g=qn()(Un.DPoP);le(()=>x.realms.findOne({realm:p}),c,[]);const{control:u}=ne();return o(ue,{role:"manage-realm",fineGrainedAccess:t,isHorizontal:!0,children:[a!=="openid-connect"&&e(C,{label:i("assertionLifespan"),fieldId:"assertionLifespan",labelIcon:e(A,{helpText:i("assertionLifespanHelp"),fieldLabelId:"assertionLifespan"}),children:e(D,{name:_("attributes.saml.assertion.lifespan"),defaultValue:"",control:u,render:({field:h})=>e(Xt,{units:["minute","day","hour"],value:h.value,onChange:h.onChange})})}),a==="openid-connect"&&o(V,{children:[e(yt,{id:"accessTokenLifespan",name:_("attributes.access.token.lifespan"),defaultValue:d?.accessTokenLifespan,units:["minute","day","hour"]}),e(yt,{id:"clientSessionIdle",name:_("attributes.client.session.idle.timeout"),defaultValue:d?.clientSessionIdleTimeout,units:["minute","day","hour"]}),e(yt,{id:"clientSessionMax",name:_("attributes.client.session.max.lifespan"),defaultValue:d?.clientSessionMaxLifespan,units:["minute","day","hour"]}),e(yt,{id:"clientOfflineSessionIdle",name:_("attributes.client.offline.session.idle.timeout"),defaultValue:d?.offlineSessionIdleTimeout,units:["minute","day","hour"]}),e(yt,{id:"clientOfflineSessionMax",name:_("attributes.client.offline.session.max.lifespan"),defaultValue:d?.offlineSessionMaxLifespanEnabled?d.offlineSessionMaxLifespan:void 0,units:["minute","day","hour"]}),e(C,{label:i("oAuthMutual"),fieldId:"oAuthMutual",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:i("oAuthMutualHelp"),fieldLabelId:"oAuthMutual"}),children:e(D,{name:_("attributes.tls.client.certificate.bound.access.tokens"),defaultValue:!1,control:u,render:({field:h})=>e(re,{id:"oAuthMutual-switch",label:i("on"),labelOff:i("off"),isChecked:h.value==="true",onChange:S=>h.onChange(""+S),"aria-label":i("oAuthMutual")})})}),g&&e(C,{label:i("oAuthDPoP"),fieldId:"oAuthDPoP",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:i("oAuthDPoPHelp"),fieldLabelId:"oAuthDPoP"}),children:e(D,{name:_("attributes.dpop.bound.access.tokens"),defaultValue:!1,control:u,render:({field:h})=>e(re,{id:"oAuthDPoP-switch",label:i("on"),labelOff:i("off"),isChecked:h.value==="true",onChange:S=>h.onChange(""+S),"aria-label":i("oAuthDPoP")})})}),e(C,{label:i("keyForCodeExchange"),fieldId:"keyForCodeExchange",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:i("keyForCodeExchangeHelp"),fieldLabelId:"keyForCodeExchange"}),children:e(D,{name:_("attributes.pkce.code.challenge.method"),defaultValue:"",control:u,render:({field:h})=>e(Q,{toggleId:"keyForCodeExchange",variant:W.single,onToggle:r,isOpen:l,onSelect:(S,R)=>{h.onChange(R),r(!1)},selections:[h.value||i("choose")],children:["","S256","plain"].map(S=>e(z,{value:S,children:S||i("choose")},S))})})}),e(C,{label:i("pushedAuthorizationRequestRequired"),fieldId:"pushedAuthorizationRequestRequired",labelIcon:e(A,{helpText:i("pushedAuthorizationRequestRequiredHelp"),fieldLabelId:"pushedAuthorizationRequestRequired"}),children:e(D,{name:_("attributes.require.pushed.authorization.requests"),defaultValue:"false",control:u,render:({field:h})=>e(re,{id:"pushedAuthorizationRequestRequired",label:i("on"),labelOff:i("off"),isChecked:h.value==="true",onChange:S=>h.onChange(S.toString()),"aria-label":i("pushedAuthorizationRequestRequired")})})}),e(C,{label:i("lightweightAccessToken"),fieldId:"lightweightAccessToken",labelIcon:e(A,{helpText:i("lightweightAccessTokenHelp"),fieldLabelId:"lightweightAccessToken"}),children:e(D,{name:_("attributes.client.use.lightweight.access.token.enabled"),defaultValue:"false",control:u,render:({field:h})=>e(re,{id:"lightweightAccessToken",label:i("on"),labelOff:i("off"),isChecked:h.value==="true",onChange:S=>h.onChange(S.toString()),"aria-label":i("lightweightAccessToken")})})}),e(C,{label:i("acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e(A,{helpText:i("acrToLoAMappingHelp"),fieldLabelId:"acrToLoAMapping"}),children:e($a,{label:i("acrToLoAMapping"),name:_("attributes.acr.loa.map")})}),e(C,{label:i("defaultACRValues"),fieldId:"defaultACRValues",labelIcon:e(A,{helpText:i("defaultACRValuesHelp"),fieldLabelId:"defaultACRValues"}),children:e(jn,{id:"defaultACRValues","aria-label":"defaultACRValues",name:_("attributes.default.acr.values"),stringify:!0})})]}),o(_e,{children:[e(N,{variant:"secondary",onClick:n,"data-testid":"OIDCAdvancedSave",children:i("save")}),e(N,{variant:"link",onClick:s,"data-testid":"OIDCAdvancedRevert",children:i("revert")})]})]})},xi=({protocol:n,save:s,reset:a,hasConfigureAccess:t})=>{const{t:i}=w(),[l,r]=m([]),[d,c]=m(!1),[p,f]=m(!1),{control:g}=ne();return le(()=>x.authenticationManagement.getFlows(),u=>{let h=[...u.filter(S=>S.providerId!=="client-flow")];h=Gn(h,[S=>S.alias]),r([e(z,{value:"",children:i("choose")},"empty"),...h.map(S=>e(z,{value:S.id,children:S.alias},S.id))])},[]),o(ue,{role:"manage-clients",fineGrainedAccess:t,isHorizontal:!0,children:[e(C,{label:i("browserFlow"),fieldId:"browserFlow",labelIcon:e(A,{helpText:i("browserFlowHelp"),fieldLabelId:"browserFlow"}),children:e(D,{name:"authenticationFlowBindingOverrides.browser",defaultValue:"",control:g,render:({field:u})=>e(Q,{toggleId:"browserFlow",variant:W.single,onToggle:c,isOpen:d,onSelect:(h,S)=>{u.onChange(S),c(!1)},selections:[u.value],children:l})})}),n==="openid-connect"&&e(C,{label:i("directGrant"),fieldId:"directGrant",labelIcon:e(A,{helpText:i("directGrantHelp"),fieldLabelId:"directGrant"}),children:e(D,{name:"authenticationFlowBindingOverrides.direct_grant",defaultValue:"",control:g,render:({field:u})=>e(Q,{toggleId:"directGrant",variant:W.single,onToggle:f,isOpen:p,onSelect:(h,S)=>{u.onChange(S),f(!1)},selections:[u.value],children:l})})}),o(_e,{children:[e(N,{variant:"secondary",onClick:s,"data-testid":"OIDCAuthFlowOverrideSave",children:i("save")}),e(N,{variant:"link",onClick:a,"data-testid":"OIDCAuthFlowOverrideRevert",children:i("revert")})]})]})},wi=n=>{const{field:s}=fa(n);return e(Xt,{...n,...s})},Oi=({clientId:n,isOpen:s,onAdded:a,onClose:t})=>{const{t:i}=w(),{register:l,handleSubmit:r,formState:{isDirty:d,isValid:c}}=Ne(),{addAlert:p,addError:f}=ce();async function g({node:u}){try{await x.clients.addClusterNode({id:n,node:u}),a(u),p(i("addedNodeSuccess"),ee.success)}catch(h){f("addedNodeFail",h)}t()}return e(Je,{title:i("addNode"),isOpen:s,onClose:t,variant:"small",actions:[e(N,{id:"add-node-confirm",type:"submit",form:"add-host-form",isDisabled:!d||!c,children:i("save")},"confirm"),e(N,{id:"add-node-cancel",variant:Te.link,onClick:t,children:i("cancel")},"cancel")],children:e(Ie,{id:"add-host-form",onSubmit:r(g),isHorizontal:!0,children:e(C,{label:i("nodeHost"),fieldId:"nodeHost",isRequired:!0,children:e(me,{id:"nodeHost",...l("node",{required:!0}),isRequired:!0})})})})},Pi=({save:n,client:{id:s,registeredNodes:a,access:t}})=>{const{t:i}=w(),{addAlert:l,addError:r}=ce(),d=$n(),[c,p]=m(a||{}),[f,g]=m(!1),[u,h]=m(""),[S,R]=m(!1),[y,b]=m(0),P=()=>b(new Date().getTime()),j=async()=>{const T=await x.clients.testNodesAvailable({id:s});Ni(T,"testCluster",l,i)},[$,X]=Ee({titleKey:"deleteNode",messageKey:i("deleteNodeBody",{node:u}),continueButtonLabel:"delete",continueButtonVariant:Te.danger,onConfirm:async()=>{try{await x.clients.deleteClusterNode({id:s,node:u}),p({...Object.keys(c).reduce((T,G)=>(G!==u&&(T[G]=c[G]),T),{})}),P(),l(i("deleteNodeSuccess"),ee.success)}catch(T){r("deleteNodeFail",T)}}});return o(V,{children:[e(ue,{role:"manage-clients",fineGrainedAccess:t?.configure,isHorizontal:!0,children:e(C,{label:i("nodeReRegistrationTimeout"),fieldId:"kc-node-reregistration-timeout",labelIcon:e(A,{helpText:i("nodeReRegistrationTimeoutHelp"),fieldLabelId:"nodeReRegistrationTimeout"}),children:o(lt,{hasGutter:!0,children:[e(Re,{children:e(wi,{name:"nodeReRegistrationTimeout"})}),e(Re,{children:e(N,{variant:Te.secondary,onClick:()=>n(),children:i("save")})})]})})}),o(V,{children:[e(X,{}),e(Oi,{clientId:s,isOpen:S,onAdded:T=>{c[T]=Date.now()/1e3,P()},onClose:()=>R(!1)}),e(Wn,{toggleText:i("registeredClusterNodes"),onToggle:g,isExpanded:f,children:e(Dt,{ariaLabelKey:"registeredClusterNodes",loader:()=>Promise.resolve(Object.entries(c||{}).map(T=>({host:T[0],registration:T[1]}))),toolbarItem:o(V,{children:[e(ye,{children:e(N,{id:"testClusterAvailability",onClick:j,variant:Te.secondary,isDisabled:Object.keys(c).length===0,children:i("testClusterAvailability")})}),e(ye,{children:e(N,{id:"registerNodeManually",onClick:()=>R(!0),variant:Te.tertiary,children:i("registerNodeManually")})})]}),actions:[{title:i("delete"),onRowClick:T=>{h(T.host),$()}}],columns:[{name:"host",displayKey:"nodeHost"},{name:"registration",displayKey:"lastRegistration",cellFormatters:[T=>T?d(new Date(parseInt(T.toString())*1e3),Ja):""]}],emptyState:e(De,{message:i("noNodes"),instructions:i("noNodesInstructions"),primaryActionText:i("registerNodeManually"),onPrimaryAction:()=>R(!0)})},y)})]})]})},ia=n=>{const{t:s}=w();return o(V,{children:[e(Oe,{name:"attributes.logoUri",label:s("logoUrl"),labelIcon:s("logoUrlHelp"),type:"url",...n}),e(Oe,{name:"attributes.policyUri",label:s("policyUrl"),labelIcon:s("policyUrlHelp"),type:"url",...n}),e(Oe,{name:"attributes.tosUri",label:s("termsOfServiceUrl"),labelIcon:s("termsOfServiceUrlHelp"),type:"url",...n})]})},_i=({save:n,reset:s,hasConfigureAccess:a})=>{const{t}=w(),i=We().providers,l=i?.clientSignature.providers,r=i?.contentencryption.providers,d=i?.cekmanagement.providers,c=i?.signature.providers,[p,f]=m(!1),[g,u]=m(!1),[h,S]=m(!1),[R,y]=m(!1),[b,P]=m(!1),[j,$]=m(!1),[X,T]=m(!1),[G,M]=m(!1),[F,L]=m(!1),[v,I]=m(!1),[q,k]=m(!1),[U,O]=m(!1),[K,se]=m(!1),[ve,Z]=m(!1),{control:J}=ne(),de=[e(z,{value:"",children:t("choose")},"empty"),...ze(l).map(E=>e(z,{value:E},E))],pe=[e(z,{value:"",children:t("choose")},"empty"),...ze(d).map(E=>e(z,{value:E},E))],pt=[e(z,{value:"",children:t("unsigned")},"unsigned"),...ze(c).map(E=>e(z,{value:E},E))],xe=[e(z,{value:"",children:t("choose")},"empty"),...ze(r).map(E=>e(z,{value:E},E))],ht=[e(z,{value:"any",children:t("any")},"any"),e(z,{value:"none",children:t("none")},"none"),...ze(l).map(E=>e(z,{value:E},E))],mt=[e(z,{value:"any",children:t("any")},"any"),...ze(d).map(E=>e(z,{value:E},E))],Ze=[e(z,{value:"any",children:t("any")},"any"),...ze(r).map(E=>e(z,{value:E},E))],he=[e(z,{value:"",children:t("choose")},"empty"),...ze(c).map(E=>e(z,{value:E},E))],Ke=["not required","request or request_uri","request only","request_uri only"].map(E=>e(z,{value:E,children:t(`requestObject.${E}`)},E));return o(ue,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e(ia,{}),e(C,{label:t("accessTokenSignatureAlgorithm"),fieldId:"accessTokenSignatureAlgorithm",labelIcon:e(A,{helpText:t("accessTokenSignatureAlgorithmHelp"),fieldLabelId:"accessTokenSignatureAlgorithm"}),children:e(D,{name:_("attributes.access.token.signed.response.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"accessTokenSignatureAlgorithm",variant:W.single,onToggle:f,isOpen:p,onSelect:(fe,Y)=>{E.onChange(Y),f(!1)},selections:E.value,"aria-label":t("selectAccessTokenSignatureAlgorithm"),children:de})})}),e(C,{label:t("idTokenSignatureAlgorithm"),fieldId:"kc-id-token-signature",labelIcon:e(A,{helpText:t("idTokenSignatureAlgorithmHelp"),fieldLabelId:"idTokenSignatureAlgorithm"}),children:e(D,{name:_("attributes.id.token.signed.response.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"idTokenSignatureAlgorithm",variant:W.single,onToggle:u,isOpen:g,onSelect:(fe,Y)=>{E.onChange(Y),u(!1)},selections:E.value,"aria-label":t("selectIdTokenSignatureAlgorithm"),children:de})})}),e(C,{label:t("idTokenEncryptionKeyManagementAlgorithm"),fieldId:"idTokenEncryptionKeyManagementAlgorithm",labelIcon:e(A,{helpText:t("idTokenEncryptionKeyManagementAlgorithmHelp"),fieldLabelId:"idTokenEncryptionKeyManagementAlgorithm"}),children:e(D,{name:_("attributes.id.token.encrypted.response.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"idTokenEncryptionKeyManagementAlgorithm",variant:W.single,onToggle:S,isOpen:h,onSelect:(fe,Y)=>{E.onChange(Y),S(!1)},selections:E.value,"aria-label":t("selectIdTokenEncryptionKeyManagementAlgorithm"),children:pe})})}),e(C,{label:t("idTokenEncryptionContentEncryptionAlgorithm"),fieldId:"idTokenEncryptionContentEncryptionAlgorithm",labelIcon:e(A,{helpText:t("idTokenEncryptionContentEncryptionAlgorithmHelp"),fieldLabelId:"idTokenEncryptionContentEncryptionAlgorithm"}),children:e(D,{name:_("attributes.id.token.encrypted.response.enc"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"idTokenEncryptionContentEncryptionAlgorithm",variant:W.single,onToggle:y,isOpen:R,onSelect:(fe,Y)=>{E.onChange(Y),y(!1)},selections:E.value,"aria-label":t("selectIdTokenEncryptionContentEncryptionAlgorithm"),children:xe})})}),e(C,{label:t("userInfoSignedResponseAlgorithm"),fieldId:"userInfoSignedResponseAlgorithm",labelIcon:e(A,{helpText:t("userInfoSignedResponseAlgorithmHelp"),fieldLabelId:"userInfoSignedResponseAlgorithm"}),children:e(D,{name:_("attributes.user.info.response.signature.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"userInfoSignedResponseAlgorithm",variant:W.single,onToggle:P,isOpen:b,onSelect:(fe,Y)=>{E.onChange(Y),P(!1)},selections:E.value,"aria-label":t("selectUserInfoSignedResponseAlgorithm"),children:pt})})}),e(C,{label:t("userInfoResponseEncryptionKeyManagementAlgorithm"),fieldId:"userInfoResponseEncryptionKeyManagementAlgorithm",labelIcon:e(A,{helpText:t("userInfoResponseEncryptionKeyManagementAlgorithmHelp"),fieldLabelId:"userInfoResponseEncryptionKeyManagementAlgorithm"}),children:e(D,{name:_("attributes.user.info.encrypted.response.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"userInfoResponseEncryptionKeyManagementAlgorithm",variant:W.single,onToggle:se,isOpen:K,onSelect:(fe,Y)=>{E.onChange(Y),se(!1)},selections:E.value,"aria-label":t("selectUserInfoResponseEncryptionKeyManagementAlgorithm"),children:pe})})}),e(C,{label:t("userInfoResponseEncryptionContentEncryptionAlgorithm"),fieldId:"userInfoResponseEncryptionContentEncryptionAlgorithm",labelIcon:e(A,{helpText:t("userInfoResponseEncryptionContentEncryptionAlgorithmHelp"),fieldLabelId:"userInfoResponseEncryptionContentEncryptionAlgorithm"}),children:e(D,{name:_("attributes.user.info.encrypted.response.enc"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"userInfoResponseEncryptionContentEncryptionAlgorithm",variant:W.single,onToggle:Z,isOpen:ve,onSelect:(fe,Y)=>{E.onChange(Y),Z(!1)},selections:E.value,"aria-label":t("selectUserInfoResponseEncryptionContentEncryptionAlgorithm"),children:xe})})}),e(C,{label:t("requestObjectSignatureAlgorithm"),fieldId:"requestObjectSignatureAlgorithm",labelIcon:e(A,{helpText:t("requestObjectSignatureAlgorithmHelp"),fieldLabelId:"requestObjectSignatureAlgorithm"}),children:e(D,{name:_("attributes.request.object.signature.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"requestObjectSignatureAlgorithm",variant:W.single,onToggle:$,isOpen:j,onSelect:(fe,Y)=>{E.onChange(Y),$(!1)},selections:E.value,"aria-label":t("selectRequestObjectSignatureAlgorithm"),children:ht})})}),e(C,{label:t("requestObjectEncryption"),fieldId:"requestObjectEncryption",labelIcon:e(A,{helpText:t("requestObjectEncryptionHelp"),fieldLabelId:"requestObjectEncryption"}),children:e(D,{name:_("attributes.request.object.encryption.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"requestObjectEncryption",variant:W.single,onToggle:M,isOpen:G,onSelect:(fe,Y)=>{E.onChange(Y),M(!1)},selections:E.value,"aria-label":t("selectRequestObjectEncryption"),children:mt})})}),e(C,{label:t("requestObjectEncoding"),fieldId:"requestObjectEncoding",labelIcon:e(A,{helpText:t("requestObjectEncodingHelp"),fieldLabelId:"requestObjectEncoding"}),children:e(D,{name:_("attributes.request.object.encryption.enc"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"requestObjectEncoding",variant:W.single,onToggle:L,isOpen:F,onSelect:(fe,Y)=>{E.onChange(Y),L(!1)},selections:E.value,"aria-label":t("selectRequestObjectEncoding"),children:Ze})})}),e(C,{label:t("requestObjectRequired"),fieldId:"requestObjectRequired",labelIcon:e(A,{helpText:t("requestObjectRequiredHelp"),fieldLabelId:"requestObjectRequired"}),children:e(D,{name:_("attributes.request.object.required"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"requestObjectRequired",variant:W.single,onToggle:T,isOpen:X,onSelect:(fe,Y)=>{E.onChange(Y),T(!1)},selections:E.value,"aria-label":t("selectRequestObjectRequired"),children:Ke})})}),e(C,{label:t("validRequestURIs"),fieldId:"validRequestURIs",labelIcon:e(A,{helpText:t("validRequestURIsHelp"),fieldLabelId:"validRequestURIs"}),children:e(jn,{name:_("attributes.request.uris"),"aria-label":t("validRequestURIs"),addButtonLabel:"addRequestUri",stringify:!0})}),e(C,{label:t("authorizationSignedResponseAlg"),fieldId:"authorizationSignedResponseAlg",labelIcon:e(A,{helpText:t("authorizationSignedResponseAlgHelp"),fieldLabelId:"authorizationSignedResponseAlg"}),children:e(D,{name:_("attributes.authorization.signed.response.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"authorizationSignedResponseAlg",variant:W.single,onToggle:I,isOpen:v,onSelect:(fe,Y)=>{E.onChange(Y),I(!1)},selections:E.value,"aria-label":t("selectAuthorizationSignedResponseAlg"),children:he})})}),e(C,{label:t("authorizationEncryptedResponseAlg"),fieldId:"authorizationEncryptedResponseAlg",labelIcon:e(A,{helpText:t("authorizationEncryptedResponseAlgHelp"),fieldLabelId:"authorizationEncryptedResponseAlg"}),children:e(D,{name:_("attributes.authorization.encrypted.response.alg"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"authorizationEncryptedResponseAlg",variant:W.single,onToggle:k,isOpen:q,onSelect:(fe,Y)=>{E.onChange(Y),k(!1)},selections:E.value,"aria-label":t("selectAuthorizationEncryptedResponseAlg"),children:pe})})}),e(C,{label:t("authorizationEncryptedResponseEnc"),fieldId:"authorizationEncryptedResponseEnc",labelIcon:e(A,{helpText:t("authorizationEncryptedResponseEncHelp"),fieldLabelId:"authorizationEncryptedResponseEnc"}),children:e(D,{name:_("attributes.authorization.encrypted.response.enc"),defaultValue:"",control:J,render:({field:E})=>e(Q,{toggleId:"authorizationEncryptedResponseEnc",variant:W.single,onToggle:O,isOpen:U,onSelect:(fe,Y)=>{E.onChange(Y),O(!1)},selections:E.value,"aria-label":t("selectAuthorizationEncryptedResponseEnc"),children:xe})})}),o(_e,{children:[e(N,{variant:"secondary",id:"fineGrainSave",onClick:n,children:t("save")}),e(N,{id:"fineGrainRevert",variant:"link",onClick:s,children:t("revert")})]})]})},Li=({save:n,reset:s})=>{const{t:a}=w();return o(ue,{role:"manage-realm",isHorizontal:!0,children:[e(ia,{}),e(Oe,{name:"attributes.saml_assertion_consumer_url_post",label:a("assertionConsumerServicePostBindingURL"),labelIcon:a("assertionConsumerServicePostBindingURLHelp"),type:"url"}),e(Oe,{name:"attributes.saml_assertion_consumer_url_redirect",label:a("assertionConsumerServiceRedirectBindingURL"),labelIcon:a("assertionConsumerServiceRedirectBindingURLHelp"),type:"url"}),e(Oe,{name:"attributes.saml_single_logout_service_url_post",label:a("logoutServicePostBindingURL"),labelIcon:a("logoutServicePostBindingURLHelp"),type:"url"}),e(Oe,{name:"attributes.saml_single_logout_service_url_redirect",label:a("logoutServiceRedirectBindingURL"),labelIcon:a("logoutServiceRedirectBindingURLHelp"),type:"url"}),e(Oe,{name:"attributes.saml_single_logout_service_url_soap",label:a("logoutServiceSoapBindingUrl"),labelIcon:a("logoutServiceSoapBindingUrlHelp"),type:"url"}),e(Oe,{name:"attributes.saml_single_logout_service_url_artifact",label:a("logoutServiceArtifactBindingUrl"),labelIcon:a("logoutServiceArtifactBindingUrlHelp"),type:"url"}),e(Oe,{name:"attributes.saml_artifact_binding_url",label:a("artifactBindingUrl"),labelIcon:a("artifactBindingUrlHelp"),type:"url"}),e(Oe,{name:"attributes.saml_artifact_resolution_service_url",label:a("artifactResolutionService"),labelIcon:a("artifactResolutionServiceHelp"),type:"url"}),o(_e,{children:[e(N,{variant:"tertiary",onClick:n,"data-testid":"fineGrainSave",children:a("save")}),e(N,{variant:"link",onClick:s,"data-testid":"fineGrainRevert",children:a("revert")})]})]})},Di=({save:n,reset:s,hasConfigureAccess:a})=>{const{t}=w(),{control:i}=ne();return o(ue,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e(C,{label:t("excludeSessionStateFromAuthenticationResponse"),fieldId:"excludeSessionStateFromAuthenticationResponse",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:t("excludeSessionStateFromAuthenticationResponseHelp"),fieldLabelId:"excludeSessionStateFromAuthenticationResponse"}),children:e(D,{name:_("attributes.exclude.session.state.from.auth.response"),defaultValue:"",control:i,render:({field:l})=>e(re,{id:"excludeSessionStateFromAuthenticationResponse-switch",label:t("on"),labelOff:t("off"),isChecked:l.value==="true",onChange:r=>l.onChange(r.toString()),"aria-label":t("excludeSessionStateFromAuthenticationResponse")})})}),e(C,{label:t("excludeIssuerFromAuthenticationResponse"),fieldId:"excludeIssuerFromAuthenticationResponse",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:t("excludeIssuerFromAuthenticationResponseHelp"),fieldLabelId:"excludeIssuerFromAuthenticationResponse"}),children:e(D,{name:_("attributes.exclude.issuer.from.auth.response"),defaultValue:"",control:i,render:({field:l})=>e(re,{id:"excludeIssuerFromAuthenticationResponse-switch",label:t("on"),labelOff:t("off"),isChecked:l.value==="true",onChange:r=>l.onChange(r.toString()),"aria-label":t("excludeIssuerFromAuthenticationResponse")})})}),e(C,{label:t("useRefreshTokens"),fieldId:"useRefreshTokens",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:t("useRefreshTokensHelp"),fieldLabelId:"useRefreshTokens"}),children:e(D,{name:_("attributes.use.refresh.tokens"),defaultValue:"true",control:i,render:({field:l})=>e(re,{id:"useRefreshTokens",label:t("on"),labelOff:t("off"),isChecked:l.value==="true",onChange:r=>l.onChange(r.toString()),"aria-label":t("useRefreshTokens")})})}),e(C,{label:t("useRefreshTokenForClientCredentialsGrant"),fieldId:"useRefreshTokenForClientCredentialsGrant",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:t("useRefreshTokenForClientCredentialsGrantHelp"),fieldLabelId:"useRefreshTokenForClientCredentialsGrant"}),children:e(D,{name:_("attributes.client_credentials.use_refresh_token"),defaultValue:"false",control:i,render:({field:l})=>e(re,{id:"useRefreshTokenForClientCredentialsGrant",label:t("on"),labelOff:t("off"),isChecked:l.value==="true",onChange:r=>l.onChange(r.toString()),"aria-label":t("useRefreshTokenForClientCredentialsGrant")})})}),e(C,{label:t("useLowerCaseBearerType"),fieldId:"useLowerCaseBearerType",hasNoPaddingTop:!0,labelIcon:e(A,{helpText:t("useLowerCaseBearerTypeHelp"),fieldLabelId:"useLowerCaseBearerType"}),children:e(D,{name:_("attributes.token.response.type.bearer.lower-case"),defaultValue:"false",control:i,render:({field:l})=>e(re,{id:"useLowerCaseBearerType",label:t("on"),labelOff:t("off"),isChecked:l.value==="true",onChange:r=>l.onChange(r.toString()),"aria-label":t("useLowerCaseBearerType")})})}),o(_e,{children:[e(N,{variant:"secondary",onClick:n,"data-testid":"OIDCCompatabilitySave",children:t("save")}),e(N,{variant:"link",onClick:s,"data-testid":"OIDCCompatabilityRevert",children:t("revert")})]})]})},Ni=(n,s,a,t)=>{const i=n.successRequests?.length||0,l=n.failedRequests?.length||0;i===0&&l===0?a(t("noAdminUrlSet"),ee.warning):l>0?(a(t(s+"Success",{successNodes:n.successRequests}),ee.success),a(t(s+"Fail",{failedNodes:n.failedRequests}),ee.danger)):a(t(s+"Success",{successNodes:n.successRequests}),ee.success)},Ki=({save:n,client:s})=>{const{t:a}=w(),t="openid-connect",{setValue:i}=ne(),{publicClient:l,attributes:r,protocol:d,authenticationFlowBindingOverrides:c}=s,p=f=>{for(const g of f)i(_(`attributes.${g}`),r?.[g]||"")};return e(ge,{variant:"light",className:"pf-u-py-0",children:e(Dn,{label:a("jumpToSection"),sections:[{title:a("clustering"),isHidden:!l,panel:e(Pi,{client:s,save:n})},{title:a("fineGrainOpenIdConnectConfiguration"),isHidden:d!==t,panel:o(V,{children:[e(Se,{className:"pf-u-pb-lg",children:a("fineGrainOpenIdConnectConfigurationHelp")}),e(_i,{save:n,reset:()=>{p(["logoUri","policyUri","tosUri","access.token.signed.response.alg","id.token.signed.response.alg","id.token.encrypted.response.alg","id.token.encrypted.response.enc","user.info.response.signature.alg","user.info.encrypted.response.alg","user.info.encrypted.response.enc","request.object.signature.alg","request.object.encryption.alg","request.object.encryption.enc","request.object.required","request.uris","authorization.signed.response.alg","authorization.encrypted.response.alg","authorization.encrypted.response.enc"])}})]})},{title:a("openIdConnectCompatibilityModes"),isHidden:d!==t,panel:o(V,{children:[e(Se,{className:"pf-u-pb-lg",children:a("openIdConnectCompatibilityModesHelp")}),e(Di,{save:()=>n(),reset:()=>p(["exclude.session.state.from.auth.response","use.refresh.tokens","client_credentials.use_refresh_token","token.response.type.bearer.lower-case"])})]})},{title:a("fineGrainSamlEndpointConfig"),isHidden:d===t,panel:o(V,{children:[e(Se,{className:"pf-u-pb-lg",children:a("fineGrainSamlEndpointConfigHelp")}),e(Li,{save:()=>n(),reset:()=>p(["logoUri","policyUri","tosUri","saml_assertion_consumer_url_post","saml_assertion_consumer_url_redirect","saml_single_logout_service_url_post","saml_single_logout_service_url_redirect","saml_single_logout_service_url_artifact","saml_artifact_binding_url","saml_artifact_resolution_service_url"])})]})},{title:a("advancedSettings"),panel:o(V,{children:[e(Se,{className:"pf-u-pb-lg",children:a("advancedSettings"+Pt(d||""))}),e(Ei,{protocol:d,save:()=>n(),reset:()=>{p(["saml.assertion.lifespan","access.token.lifespan","tls.client.certificate.bound.access.tokens","pkce.code.challenge.method"])}})]})},{title:a("authenticationOverrides"),panel:o(V,{children:[e(Se,{className:"pf-u-pb-lg",children:a("authenticationOverridesHelp")}),e(xi,{protocol:d,save:()=>n(),reset:()=>{i("authenticationFlowBindingOverrides.browser",c?.browser),i("authenticationFlowBindingOverrides.direct_grant",c?.direct_grant)}})]})}],borders:!0})})},Hi=({client:n})=>{const{t:s}=w();return e(ge,{variant:"light",className:"pf-u-p-0",children:e(Xa,{loader:async(t,i)=>{const l=d=>c=>c.map(p=>({type:d,...p}));return(await Promise.all([x.clients.listSessions({id:n.id,first:t,max:i}).then(l(s("sessionsType.regularSSO"))),x.clients.listOfflineSessions({id:n.id,first:t,max:i}).then(l(s("sessionsType.offline")))])).flat()},hiddenColumns:["clients"],emptyInstructions:s("noSessionsForClient")})})},Mi=({client:n,save:s,reset:a})=>{const{t}=w(),{register:i,watch:l}=ne(),{hasAccess:r}=Pe(),d=r("manage-clients")||n.access?.configure,c=l("protocol");return o(ue,{isHorizontal:!0,fineGrainedAccess:n.access?.configure,role:"manage-clients",children:[!n.bearerOnly&&e(ti,{protocol:c}),c!=="saml"&&e(C,{label:t("adminURL"),fieldId:"kc-admin-url",labelIcon:e(A,{helpText:t("adminURLHelp"),fieldLabelId:"adminURL"}),children:e(me,{id:"kc-admin-url",type:"url",...i("adminUrl")})}),n.bearerOnly&&e(_t,{name:"settings",save:s,reset:a,isActive:!d})]})},Fi=({access:n})=>{const{t:s}=w(),{register:a,control:t,watch:i}=ne(),[l,r]=m(!1),d=We().themes.login,c=i("consentRequired"),p=i(_("attributes.display.on.consent.screen"));return o(ue,{isHorizontal:!0,fineGrainedAccess:n,role:"manage-clients",children:[e(C,{label:s("loginTheme"),labelIcon:e(A,{helpText:s("loginThemeHelp"),fieldLabelId:"loginTheme"}),fieldId:"loginTheme",children:e(D,{name:"attributes.login_theme",defaultValue:"",control:t,render:({field:f})=>e(Q,{toggleId:"loginTheme",onToggle:r,onSelect:(g,u)=>{f.onChange(u.toString()),r(!1)},selections:f.value||s("choose"),variant:W.single,"aria-label":s("loginTheme"),isOpen:l,children:[e(z,{value:"",children:s("choose")},"empty"),...d.map(g=>e(z,{selected:g.name===f.value,value:g.name},g.name))]})})}),e(C,{label:s("consentRequired"),labelIcon:e(A,{helpText:s("consentRequiredHelp"),fieldLabelId:"consentRequired"}),fieldId:"kc-consent",hasNoPaddingTop:!0,children:e(D,{name:"consentRequired",defaultValue:!1,control:t,render:({field:f})=>e(re,{id:"kc-consent-switch",label:s("on"),labelOff:s("off"),isChecked:f.value,onChange:f.onChange,"aria-label":s("consentRequired")})})}),e(C,{label:s("displayOnClient"),labelIcon:e(A,{helpText:s("displayOnClientHelp"),fieldLabelId:"displayOnClient"}),fieldId:"kc-display-on-client",hasNoPaddingTop:!0,children:e(D,{name:_("attributes.display.on.consent.screen"),defaultValue:!1,control:t,render:({field:f})=>e(re,{id:"kc-display-on-client-switch",label:s("on"),labelOff:s("off"),isChecked:f.value==="true",onChange:g=>f.onChange(""+g),isDisabled:!c,"aria-label":s("displayOnClient")})})}),e(C,{label:s("consentScreenText"),labelIcon:e(A,{helpText:s("consentScreenTextHelp"),fieldLabelId:"consentScreenText"}),fieldId:"kc-consent-screen-text",children:e(ct,{id:"kc-consent-screen-text",...a(_("attributes.consent.screen.text")),isDisabled:!(c&&p==="true")})})]})},Tn=(n,s)=>(n?.startsWith("https://")||n?.startsWith("http://"))&&!n.includes("*")||n===""||s,zi=({save:n,reset:s,client:{access:a}})=>{const{t}=w(),{register:i,control:l,watch:r,formState:{errors:d}}=ne(),{hasAccess:c}=Pe(),p=c("manage-clients")||a?.configure,f=r("protocol"),g=r("frontchannelLogout");return o(ue,{isHorizontal:!0,fineGrainedAccess:a?.configure,role:"manage-clients",children:[e(C,{label:t("frontchannelLogout"),labelIcon:e(A,{helpText:t("frontchannelLogoutHelp"),fieldLabelId:"frontchannelLogout"}),fieldId:"kc-frontchannelLogout",hasNoPaddingTop:!0,children:e(D,{name:"frontchannelLogout",defaultValue:!0,control:l,render:({field:u})=>e(re,{id:"kc-frontchannelLogout-switch",label:t("on"),labelOff:t("off"),isChecked:u.value,onChange:u.onChange,"aria-label":t("frontchannelLogout")})})}),f==="openid-connect"&&g&&e(C,{label:t("frontchannelLogoutUrl"),fieldId:"frontchannelLogoutUrl",labelIcon:e(A,{helpText:t("frontchannelLogoutUrlHelp"),fieldLabelId:"frontchannelLogoutUrl"}),helperTextInvalid:d.attributes?.[Ve("frontchannel.logout.url")]?.message,validated:d.attributes?.[Ve("frontchannel.logout.url")]?.message?Ae.error:Ae.default,children:e(me,{id:"frontchannelLogoutUrl",type:"url",...i(_("attributes.frontchannel.logout.url"),{validate:u=>Tn(u,t("frontchannelUrlInvalid").toString())}),validated:d.attributes?.[Ve("frontchannel.logout.url")]?.message?Ae.error:Ae.default})}),f==="openid-connect"&&o(V,{children:[e(C,{label:t("backchannelLogoutUrl"),fieldId:"backchannelLogoutUrl",labelIcon:e(A,{helpText:t("backchannelLogoutUrlHelp"),fieldLabelId:"backchannelLogoutUrl"}),helperTextInvalid:d.attributes?.[Ve("backchannel.logout.url")]?.message,validated:d.attributes?.[Ve("backchannel.logout.url")]?.message?Ae.error:Ae.default,children:e(me,{id:"backchannelLogoutUrl",type:"url",...i(_("attributes.backchannel.logout.url"),{validate:u=>Tn(u,t("backchannelUrlInvalid").toString())}),validated:d.attributes?.[Ve("backchannel.logout.url")]?.message?Ae.error:Ae.default})}),e(C,{label:t("backchannelLogoutSessionRequired"),labelIcon:e(A,{helpText:t("backchannelLogoutSessionRequiredHelp"),fieldLabelId:"backchannelLogoutSessionRequired"}),fieldId:"backchannelLogoutSessionRequired",hasNoPaddingTop:!0,children:e(D,{name:_("attributes.backchannel.logout.session.required"),defaultValue:"true",control:l,render:({field:u})=>e(re,{id:"backchannelLogoutSessionRequired",label:t("on"),labelOff:t("off"),isChecked:u.value==="true",onChange:h=>u.onChange(h.toString()),"aria-label":t("backchannelLogoutSessionRequired")})})}),e(C,{label:t("backchannelLogoutRevokeOfflineSessions"),labelIcon:e(A,{helpText:t("backchannelLogoutRevokeOfflineSessionsHelp"),fieldLabelId:"backchannelLogoutRevokeOfflineSessions"}),fieldId:"backchannelLogoutRevokeOfflineSessions",hasNoPaddingTop:!0,children:e(D,{name:_("attributes.backchannel.logout.revoke.offline.tokens"),defaultValue:"false",control:l,render:({field:u})=>e(re,{id:"backchannelLogoutRevokeOfflineSessions",label:t("on"),labelOff:t("off"),isChecked:u.value==="true",onChange:h=>u.onChange(h.toString()),"aria-label":t("backchannelLogoutRevokeOfflineSessions")})})})]}),e(_t,{name:"settings",save:n,reset:s,isActive:p})]})},He=({name:n,label:s})=>{const{t:a}=w(),{control:t}=ne();return e(C,{hasNoPaddingTop:!0,label:a(s),fieldId:s,labelIcon:e(A,{helpText:a(`${s}Help`),fieldLabelId:s}),children:e(D,{name:n,defaultValue:"false",control:t,render:({field:i})=>e(re,{id:n,"data-testid":s,label:a("on"),labelOff:a("off"),isChecked:i.value==="true",onChange:l=>i.onChange(l.toString()),"aria-label":a(s)})})})},Vi=()=>{const{t:n}=w(),{control:s}=ne(),[a,t]=m(!1);return o(ue,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e(C,{label:n("nameIdFormat"),fieldId:"nameIdFormat",labelIcon:e(A,{helpText:n("nameIdFormatHelp"),fieldLabelId:"nameIdFormat"}),children:e(D,{name:"attributes.saml_name_id_format",defaultValue:"username",control:s,render:({field:i})=>e(Q,{toggleId:"samlNameIdFormat",onToggle:t,onSelect:(l,r)=>{i.onChange(r.toString()),t(!1)},selections:i.value,variant:W.single,"aria-label":n("nameIdFormat"),isOpen:a,children:["username","email","transient","persistent"].map(l=>e(z,{selected:l===i.value,value:l},l))})})}),e(He,{name:"attributes.saml_force_name_id_format",label:"forceNameIdFormat"}),e(He,{name:_("attributes.saml.force.post.binding"),label:"forcePostBinding"}),e(He,{name:_("attributes.saml.artifact.binding"),label:"forceArtifactBinding"}),e(He,{name:_("attributes.saml.authnstatement"),label:"includeAuthnStatement"}),e(He,{name:_("attributes.saml.onetimeuse.condition"),label:"includeOneTimeUseCondition"}),e(He,{name:_("attributes.saml.server.signature.keyinfo.ext"),label:"optimizeLookup"}),e(He,{name:_("attributes.saml.allow.ecp.flow"),label:"allowEcpFlow"})]})},Cn=["RSA_SHA1","RSA_SHA256","RSA_SHA256_MGF1","RSA_SHA512","RSA_SHA512_MGF1","DSA_SHA1"],In=["NONE","KEY_ID","CERT_SUBJECT"],Ft=[{name:"EXCLUSIVE",value:"http://www.w3.org/2001/10/xml-exc-c14n#"},{name:"EXCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments"},{name:"INCLUSIVE",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315"},{name:"INCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments"}],qi=()=>{const{t:n}=w(),[s,a]=m(!1),[t,i]=m(!1),[l,r]=m(!1),{control:d,watch:c}=ne(),p=c(_("attributes.saml.server.signature")),f=c(_("attributes.saml.assertion.signature"));return o(ue,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e(He,{name:_("attributes.saml.server.signature"),label:"signDocuments"}),e(He,{name:_("attributes.saml.assertion.signature"),label:"signAssertions"}),(p==="true"||f==="true")&&o(V,{children:[e(C,{label:n("signatureAlgorithm"),fieldId:"signatureAlgorithm",labelIcon:e(A,{helpText:n("signatureAlgorithmHelp"),fieldLabelId:"signatureAlgorithm"}),children:e(D,{name:_("attributes.saml.signature.algorithm"),defaultValue:Cn[0],control:d,render:({field:g})=>e(Q,{toggleId:"signatureAlgorithm",onToggle:a,onSelect:(u,h)=>{g.onChange(h.toString()),a(!1)},selections:g.value,variant:W.single,"aria-label":n("signatureAlgorithm"),isOpen:s,children:Cn.map(u=>e(z,{selected:u===g.value,value:u},u))})})}),e(C,{label:n("signatureKeyName"),fieldId:"signatureKeyName",labelIcon:e(A,{helpText:n("signatureKeyNameHelp"),fieldLabelId:"signatureKeyName"}),children:e(D,{name:_("attributes.saml.server.signature.keyinfo.xmlSigKeyInfoKeyNameTransformer"),defaultValue:In[0],control:d,render:({field:g})=>e(Q,{toggleId:"signatureKeyName",onToggle:i,onSelect:(u,h)=>{g.onChange(h.toString()),i(!1)},selections:g.value,variant:W.single,"aria-label":n("signatureKeyName"),isOpen:t,children:In.map(u=>e(z,{selected:u===g.value,value:u},u))})})}),e(C,{label:n("canonicalization"),fieldId:"canonicalization",labelIcon:e(A,{helpText:n("canonicalizationHelp"),fieldLabelId:"canonicalization"}),children:e(D,{name:"attributes.saml_signature_canonicalization_method",defaultValue:Ft[0].value,control:d,render:({field:g})=>e(Q,{toggleId:"canonicalization",onToggle:r,onSelect:(u,h)=>{g.onChange(h.toString()),r(!1)},selections:Ft.find(u=>u.value===g.value)?.name,variant:W.single,"aria-label":n("canonicalization"),isOpen:l,children:Ft.map(u=>e(z,{selected:u.value===g.value,value:u.value,children:u.name},u.name))})})})]})]})},Ui=n=>{const{t:s}=w(),{watch:a}=ne(),t=a("protocol"),{client:i}=n;return e(Dn,{label:s("jumpToSection"),className:"pf-u-px-lg pf-u-pb-lg",sections:[{title:s("generalSettings"),panel:e(Ie,{isHorizontal:!0,children:e(Za,{protocol:i.protocol,hasConfigureAccess:i.access?.configure})})},{title:s("accessSettings"),panel:e(Mi,{...n})},{title:s("samlCapabilityConfig"),isHidden:t!=="saml"||i.bearerOnly,panel:e(Vi,{})},{title:s("signatureAndEncryption"),isHidden:t!=="saml"||i.bearerOnly,panel:e(qi,{})},{title:s("capabilityConfig"),isHidden:t!=="openid-connect"||i.bearerOnly,panel:e(ei,{})},{title:s("loginSettings"),isHidden:i.bearerOnly,panel:e(Fi,{access:i.access?.configure})},{title:s("logoutSettings"),isHidden:i.bearerOnly,panel:e(zi,{...n})}]})},Bi=({name:n,rowIndex:s,attribute:a,selectableValues:t,resources:i})=>{const{t:l}=w(),{control:r,register:d,getValues:c}=ne(),[p,f]=m([!1]),g=(R,y)=>{const b=[...p];b[R]=y,f(b)},u=Ct(()=>{let R=[];return t&&(R=Qn.find(y=>y.key===c().context?.[s]?.key)?.values),R},[c]),h=()=>{const R=i?.find(y=>y.name===c().resources?.[s]?.key)?.scopes;if(u?.length&&!i)return u.map(y=>e(z,{value:y.key,children:y.name},y.key));if(R?.length)return R.map(y=>e(z,{value:y.name,children:y.name},y.name))},S=R=>li(R).replace(/\W/g,"");return e(H,{children:i||u?.length?e(D,{name:`${n}.${s}.value`,defaultValue:[],control:r,render:({field:R})=>e(Q,{toggleId:`${a.id}-value`,className:"kc-attribute-value-selectable",name:`${n}.${s}.value`,chipGroupProps:{numChips:1,expandedText:l("hide"),collapsedText:l("showRemaining")},onToggle:y=>g(s,y),isOpen:p[s],variant:W.typeahead,typeAheadAriaLabel:l("selectOrTypeAKey"),placeholderText:l("selectOrTypeAKey"),selections:R.value,onSelect:(y,b)=>{R.onChange(b),g(s,!1)},children:h()})}):e(me,{id:`${S(a.key)}-value`,className:"value-input",defaultValue:a.value,"data-testid":"attribute-value-input","aria-label":l("value"),...d(`${n}.${s}.value`)})})},kn=({name:n,selectableValues:s,resources:a})=>{const{t}=w(),{control:i,watch:l}=ne(),{fields:r,append:d,remove:c}=ba({control:i,name:n}),[p,f]=m([!1]),g=(h,S)=>{const R=[...p];R[h]=S,f(R)};Be(()=>{r.length||d({key:"",value:""},{shouldFocus:!1})},[r]);const u=l(`${n}.${r.length-1}.value`,"");return o(Qe,{className:"kc-attributes__table","aria-label":"Role attribute keys and values",variant:"compact",children:[e(Ye,{children:o(oe,{children:[e(B,{width:40,children:t("key")}),e(B,{width:40,children:t("value")})]})}),o(Xe,{children:[r.map((h,S)=>o(oe,{"data-testid":"attribute-row",children:[e(H,{children:e(D,{name:`${n}.${S}.key`,defaultValue:"",control:i,render:({field:R})=>e(Q,{toggleId:`${n}.${S}.key`,className:"kc-attribute-key-selectable",name:`${n}.${S}.key`,onToggle:y=>g(S,y),isOpen:p[S],variant:W.typeahead,typeAheadAriaLabel:t("selectOrTypeAKey"),placeholderText:t("selectOrTypeAKey"),selections:R.value,onSelect:(y,b)=>{R.onChange(b.toString()),g(S,!1)},children:s?.map(y=>e(z,{selected:y.name===R.value,value:a?y.name:y.key,children:y.name},y.key))})})}),e(Bi,{name:n,attribute:h,rowIndex:S,selectableValues:s,resources:a}),e(H,{children:e(N,{id:`${n}-minus-button-${S}`,variant:"link",className:"kc-attributes__minus-icon",onClick:()=>c(S),"aria-label":t("remove"),children:e(ya,{})})})]},h.id)),e(oe,{children:e(H,{children:e(N,{"aria-label":t("addAttribute",{label:t("attribute")}),id:`${n}-plus-icon`,variant:"link",className:"kc-attributes__plus-icon",onClick:()=>{d({key:"",value:""}),f([...p,!1])},icon:e(Nn,{}),isDisabled:!u,"data-testid":"attribute-add-row",children:t("addAttribute",{label:t("attribute")})})})})]})]})},ji=({data:n})=>{const{t:s}=w(),[a,t]=ke();return o(V,{children:[e(N,{"data-testid":"authorization-revert",onClick:t,variant:"secondary",children:s("showAuthData")}),e(Je,{variant:At.medium,isOpen:a,"aria-label":s("authData"),header:o(je,{children:[e(Se,{component:va.h1,children:s("authData")}),e(Se,{children:s("authDataDescription")})]}),onClose:t,actions:[e(N,{"data-testid":"cancel",id:"modal-cancel",onClick:t,children:s("cancel")},"cancel")],children:e(ct,{readOnly:!0,rows:20,value:et(n)})})]})},Gi=({idx:n,rowIndex:s,outerPolicy:a,resource:t})=>{const[i,l]=m(!1),{t:r}=w(),{realm:d}=be(),{clientId:c}=Yt();return o(Xe,{isExpanded:i,children:[o(oe,{children:[e(H,{expand:{rowIndex:s,isExpanded:i,onToggle:()=>l(p=>!p)}}),e(H,{"data-testid":`name-column-${t.resource}`,children:e(Ce,{to:kt({realm:d,id:c,permissionType:a.policy?.type,permissionId:a.policy?.id}),children:a.policy?.name})}),e(H,{id:a.status?.toLowerCase(),children:r(a.status?.toLowerCase())}),e(H,{children:r(`${a.policy?.decisionStrategy?.toLowerCase()}`)}),e(H,{children:a.status===mn.Permit?t.policies?.[s]?.scopes?.join(", "):"-"}),e(H,{children:a.status===mn.Deny&&t.policies?.[s]?.scopes?.length?t.policies[s].scopes?.join(", "):"-"})]}),o(oe,{isExpanded:i,children:[e(H,{}),e(H,{colSpan:5,children:i&&e(dt,{children:e(ut,{isHorizontal:!0,className:"keycloak_resource_details",children:e(je,{children:e(na,{children:a.associatedPolicies?.map(p=>o(aa,{children:[e(Ce,{to:Wt({realm:d,id:c,policyType:p.policy?.type,policyId:p.policy?.id}),children:p.policy?.name}),r("votedToStatus",{status:Sa(p.status)})]},"policyDetails"))})})})})})]},`child-${t.resource}`)]},n)},$i=({rowIndex:n,resource:s,evaluateResults:a})=>{const[t,i]=m(!1),{t:l}=w();return o(Xe,{isExpanded:t,children:[o(oe,{children:[e(H,{expand:{rowIndex:n,isExpanded:t,onToggle:()=>i(r=>!r)}}),e(H,{"data-testid":`name-column-${s.resource}`,children:s.resource?.name}),e(H,{id:s.status?.toLowerCase(),children:l(`${s.status?.toLowerCase()}`)}),e(H,{children:s.allowedScopes?.length?s.allowedScopes.map(r=>r.name):"-"})]}),o(oe,{isExpanded:t,children:[e(H,{}),e(H,{colSpan:5,children:e(dt,{children:t&&e(ut,{isHorizontal:!0,className:"keycloak_resource_details",children:o(Qe,{"aria-label":l("evaluationResults"),children:[e(Ye,{children:o(oe,{children:[e(B,{"aria-hidden":"true"}),e(B,{children:l("permission")}),e(B,{children:l("results")}),e(B,{children:l("decisionStrategy")}),e(B,{children:l("grantedScopes")}),e(B,{children:l("deniedScopes")}),e(B,{"aria-hidden":"true"})]})}),Object.values(a[n].policies).map((r,d)=>e(Gi,{idx:d,rowIndex:n,outerPolicy:r,resource:s},d))]})})})})]},`child-${s.resource}`)]})};function Wi(n,s){switch(s){case"STATUS_PERMITTED":return n.filter(({status:a})=>a==="PERMIT");case"STATUS_DENIED":return n.filter(({status:a})=>a==="DENY");default:return n}}const Ji=({evaluateResult:n,refresh:s,back:a})=>{const{t}=w(),[i,l]=ke(),[r,d]=m("ALL"),[c,p]=m(""),[f,g]=m(""),u=()=>{p(f)},h=b=>{b.key==="Enter"&&u()},S=Ct(()=>Wi(n.results,r).filter(({resource:b})=>b?.name?.includes(c)??!1),[n.results,r,c]),R=n.results.length===0,y=S.length===0;return o(ge,{children:[e(Qa,{children:o(Ya,{className:"providers-toolbar",children:[e(ye,{children:o(Kn,{children:[e(Ta,{name:"inputGroupName",id:"inputGroupName",type:"search","aria-label":t("search"),placeholder:t("search"),onChange:g,onKeyDown:h}),e(N,{variant:Te.control,"aria-label":t("search"),onClick:()=>u(),children:e(Ca,{})})]})}),e(ye,{children:o(Q,{width:300,"data-testid":"filter-type-select",isOpen:i,className:"kc-filter-type-select",variant:W.single,onToggle:l,onSelect:(b,P)=>{d(P),l(),s()},selections:r,children:[e(z,{"data-testid":"all-results-option",value:"ALL",isPlaceholder:!0,children:t("allResults")}),e(z,{"data-testid":"result-permit-option",value:"STATUS_PERMITTED",children:t("resultPermit")}),e(z,{"data-testid":"result-deny-option",value:"STATUS_DENIED",children:t("resultDeny")})]})})]})}),!y&&o(Qe,{"aria-label":t("evaluationResults"),children:[e(Ye,{children:o(oe,{children:[e(B,{"aria-hidden":"true"}),e(B,{children:t("resource")}),e(B,{children:t("overallResults")}),e(B,{children:t("scopes")}),e(B,{"aria-hidden":"true"})]})}),S.map((b,P)=>e($i,{rowIndex:P,resource:b,evaluateResults:n.results},P))]}),(y||R)&&o(V,{children:[e(Ge,{}),e(De,{isSearchVariant:!0,message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")})]}),e(Ie,{children:o(_t,{name:"authorization",children:[e(N,{"data-testid":"authorization-eval",id:"back-btn",onClick:a,children:t("back")})," ",e(N,{"data-testid":"authorization-reevaluate",id:"reevaluate-btn",variant:"secondary",onClick:s,children:t("reevaluate")})," ",e(ji,{data:n.rpt})]})})]})},Qi=n=>{const{hasAccess:s}=Pe();return s("view-users")?e(Yi,{...n}):e(Ia,{permissionNeeded:"view-users"})},Yi=({client:n})=>{const s=Ne({mode:"onChange"}),{control:a,register:t,reset:i,trigger:l,formState:{isValid:r,errors:d}}=s,{t:c}=w(),{addError:p}=ce(),f=be(),[g,u]=m(!1),[h,S]=m(!1),[R,y]=m(!1),[b,P]=m(!1),[j,$]=m([]),[X,T]=m([]),[G,M]=m(),[F,L]=m([]);le(()=>x.roles.find(),k=>{L(k)},[]),le(()=>Promise.all([x.clients.listResources({id:n.id}),x.clients.listAllScopes({id:n.id})]),([k,U])=>{$(k),T(U)},[]);const v=async()=>{if(!await l())return;const k=s.getValues(),U=ka(k.resources),O={roleIds:k.roleIds??[],clientId:k.client.id,userId:k.user[0],resources:j.filter(K=>Object.keys(U).includes(K.name)).map(K=>({...K,scopes:K.scopes?.filter(se=>Object.values(U).flatMap(ve=>ve).includes(se.name))})),entitlements:!1,context:{attributes:Object.fromEntries(k.context.attributes.filter(K=>K.key||K.value!=="").map(({key:K,value:se})=>[K,se]))}};try{const K=await x.clients.evaluateResource({id:n.id,realm:f.realm},O);M(K)}catch(K){p("evaluateError",K)}},I=it({control:a,name:"user",defaultValue:[]}),q=it({control:a,name:"roleIds",defaultValue:[]});return G?e(Ji,{evaluateResult:G,refresh:v,back:()=>M(void 0)}):e(ge,{children:o(Me,{...s,children:[o(un,{children:[e(jt,{children:e(vt,{headingLevel:"h2",children:c("identityInformation")})}),e(pn,{children:o(ue,{isHorizontal:!0,role:"view-clients",children:[e(ni,{name:"client",label:"client",helpText:"clientHelp",defaultValue:n.clientId}),e(Jn,{name:"user",label:"users",helpText:c("selectUser"),defaultValue:[],variant:W.typeahead,isRequired:q?.length===0}),e(C,{label:c("roles"),labelIcon:e(A,{helpText:c("rolesHelp"),fieldLabelId:"roles"}),fieldId:"realmRole",validated:d.roleIds?"error":"default",helperTextInvalid:c("required"),isRequired:I.length===0,children:e(D,{name:"roleIds",control:a,defaultValue:[],rules:{validate:k=>(k||"").length>0||I.length>0},render:({field:k})=>e(Q,{placeholderText:c("selectARole"),variant:W.typeaheadMulti,toggleId:"role",onToggle:S,selections:k.value,onSelect:(U,O)=>{const K=O.toString();k.value?.includes(K)?k.onChange(k.value.filter(se=>se!==K)):k.onChange([...k.value||[],K]),S(!1)},onClear:U=>{U.stopPropagation(),k.onChange([])},"aria-label":c("realmRole"),isOpen:h,children:F.map(U=>e(z,{selected:U.name===k.value,value:U.name},U.name))})})})]})})]}),o(un,{children:[e(jt,{children:e(vt,{headingLevel:"h2",children:c("permissions")})}),e(pn,{children:o(ue,{isHorizontal:!0,role:"view-clients",children:[e(C,{label:c("applyToResourceType"),fieldId:"applyToResourceType",labelIcon:e(A,{helpText:c("applyToResourceTypeHelp"),fieldLabelId:"applyToResourceType"}),children:e(re,{id:"applyToResource-switch",label:c("on"),labelOff:c("off"),isChecked:b,onChange:P,"aria-label":c("applyToResourceType")})}),b?o(V,{children:[e(C,{label:c("resourceType"),isRequired:!0,labelIcon:e(A,{helpText:c("resourceTypeHelp"),fieldLabelId:"resourceType"}),fieldId:"client",validated:d.alias?"error":"default",helperTextInvalid:c("required"),children:e(me,{id:"alias","aria-label":"resource-type","data-testid":"alias",...t("alias",{required:!0})})}),e(C,{label:c("authScopes"),labelIcon:e(A,{helpText:c("scopesSelect"),fieldLabelId:"client"}),fieldId:"authScopes",children:e(D,{name:"authScopes",defaultValue:[],control:a,render:({field:k})=>e(Q,{toggleId:"authScopes",onToggle:u,onSelect:(U,O)=>{const K=O.toString();k.value.includes(K)?k.onChange(k.value.filter(se=>se!==K)):k.onChange([...k.value,K]),u(!1)},selections:k.value,variant:W.typeaheadMulti,typeAheadAriaLabel:c("selectAuthScopes"),isOpen:g,"aria-label":c("selectAuthScopes"),children:X.map(U=>e(z,{selected:k.value.includes(U.name),value:U.name},U.id))})})})]}):e(C,{label:c("resourcesAndScopes"),id:"resourcesAndScopes",labelIcon:e(A,{helpText:c("contextualAttributesHelp"),fieldLabelId:"resourcesAndScopes"}),fieldId:"resourcesAndScopes",children:e(kn,{selectableValues:j.map(k=>({name:k.name,key:k._id})),resources:j,name:"resources"})}),e(Wn,{toggleText:c("contextualInfo"),onToggle:()=>y(!R),isExpanded:R,children:e(C,{label:c("contextualAttributes"),id:"contextualAttributes",labelIcon:e(A,{helpText:c("contextualAttributesHelp"),fieldLabelId:"contextualAttributes"}),helperTextInvalid:c("required"),fieldId:"contextualAttributes",children:e(kn,{selectableValues:Qn,name:"context.attributes"})})})]})})]}),o(_e,{children:[e(N,{"data-testid":"authorization-eval",id:"authorization-eval",className:"pf-u-mr-md",isDisabled:!r,onClick:()=>v(),children:c("evaluate")}),e(N,{"data-testid":"authorization-revert",id:"authorization-revert",className:"pf-u-mr-md",variant:"link",onClick:()=>i(),children:c("revert")})]})]})})},Xi=()=>{const{t:n}=w(),{clientId:s}=Yt(),{addAlert:a,addError:t}=ce(),[i,l]=m(),[r,d]=m();le(()=>x.clients.exportResource({id:s}),p=>{l(JSON.stringify(p,null,2)),d(p)},[]);const c=()=>{try{st.saveAs(new Blob([et(r)],{type:"application/json"}),"test-authz-config.json"),a(n("exportAuthDetailsSuccess"),ee.success)}catch(p){t("exportAuthDetailsError",p)}};return i?e(ge,{children:o(ue,{isHorizontal:!0,role:"manage-authorization",className:"pf-u-mt-lg",children:[e(C,{label:n("authDetails"),labelIcon:e(A,{helpText:n("authDetailsHelp"),fieldLabelId:"authDetails"}),fieldId:"client",children:e(ct,{id:"authorizationDetails",readOnly:!0,resizeOrientation:"vertical",value:i,"aria-label":n("authDetails"),rows:10})}),o(_e,{children:[e(N,{"data-testid":"authorization-export-download",onClick:()=>c(),children:n("download")}),e(N,{"data-testid":"authorization-export-copy",variant:"secondary",onClick:async()=>{try{await navigator.clipboard.writeText(i),a(n("copied"),ee.success)}catch(p){t(n("copyError"),p)}},children:n("copy")})]})]})}):e(Le,{})};function Zi(n){return e($e,{...n})}function $e({name:n,array:s,convert:a,link:t}){const{t:i}=w();return o(ri,{children:[e(oi,{children:i(n)}),o(ci,{children:[s?.map(l=>{const r=typeof l=="string"?l:a(l);return t?e(Ce,{to:t(l),className:"pf-u-pr-sm",children:r},r):e("span",{className:"pf-u-pr-sm",children:r},r)}),s?.length===0&&e("i",{children:i("none")})]})]})}const An=({permissionType:n,disabled:s=!1,clientId:a})=>{const{t}=w(),{realm:i}=be(),l=rt();return e(N,{"data-testid":`create-${n}`,className:s?"keycloak__permissions__empty_state ":"pf-u-m-sm",variant:"secondary",onClick:()=>!s&&l(St({realm:i,id:a,permissionType:n})),children:t(`create${Pt(n)}BasedPermission`)})},Rn=({permissionType:n,disabled:s,...a})=>{const{t}=w();return s?e(Hn,{content:t(`no${Pt(n)}CreateHint`),children:e(An,{...a,disabled:s,permissionType:n})}):e(An,{...a,disabled:s,permissionType:n})},es=({clientId:n,isResourceEnabled:s,isScopeEnabled:a})=>{const{t}=w();return o(Yn,{"data-testid":"empty-state",variant:"large",children:[e(di,{icon:Nn}),e(vt,{headingLevel:"h1",size:"lg",children:t("emptyPermissions")}),e(Xn,{children:t("emptyPermissionInstructions")}),e(Rn,{permissionType:"resource",disabled:s,clientId:n}),e("br",{}),e(Rn,{permissionType:"scope",disabled:a,clientId:n})]})},Zt=({array:n})=>{const{t:s}=w();return!n||n.length<=1?null:e(Ut,{color:"blue",children:s("more",{count:n.length-1})})},en=({types:n,search:s,onSearch:a,type:t})=>{const{t:i}=w(),{register:l,control:r,reset:d,formState:{isDirty:c},handleSubmit:p}=Ne({mode:"onChange"}),[f,g]=ke(),[u,h]=ke(),S=y=>{g(),a(y)};Be(()=>d(s),[s]);const R=y=>[e(z,{value:"",children:i("allTypes")},"empty"),...(n||[]).map(b=>e(z,{selected:b.type===y,value:b.type,children:b.name},b.type))];return e(Jt,{"data-testid":"searchdropdown_dorpdown",className:"pf-u-ml-md",toggle:o(Mn,{onToggle:g,className:"keycloak__client_authentication__searchdropdown",children:[t==="resource"&&i("searchClientAuthorizationResource"),t==="policy"&&i("searchClientAuthorizationPolicy"),t==="permission"&&i("searchClientAuthorizationPermission")]}),isOpen:f,children:o(Ie,{isHorizontal:!0,className:"keycloak__client_authentication__searchdropdown_form",onSubmit:p(S),children:[e(C,{label:i("name"),fieldId:"name",children:e(me,{id:"name","data-testid":"searchdropdown_name",...l("name")})}),t==="resource"&&o(V,{children:[e(C,{label:i("type"),fieldId:"type",children:e(me,{id:"type","data-testid":"searchdropdown_type",...l("type")})}),e(C,{label:i("uris"),fieldId:"uri",children:e(me,{id:"uri","data-testid":"searchdropdown_uri",...l("uri")})}),e(C,{label:i("owner"),fieldId:"owner",children:e(me,{id:"owner","data-testid":"searchdropdown_owner",...l("owner")})})]}),t!=="resource"&&t!=="policy"&&e(C,{label:i("resource"),fieldId:"resource",children:e(me,{id:"resource","data-testid":"searchdropdown_resource",...l("resource")})}),t!=="policy"&&e(C,{label:i("scope"),fieldId:"scope",children:e(me,{id:"scope","data-testid":"searchdropdown_scope",...l("scope")})}),t!=="resource"&&e(C,{label:i("type"),fieldId:"type",children:e(D,{name:"type",defaultValue:"",control:r,render:({field:y})=>e(Q,{toggleId:"type",onToggle:h,onSelect:(b,P)=>{b.stopPropagation(),y.onChange(P),h()},selections:y.value||i("allTypes"),variant:W.single,"aria-label":i("type"),isOpen:u,children:R(y.value)})})}),o(_e,{children:[e(N,{variant:"primary",type:"submit","data-testid":"search-btn",isDisabled:!c,children:i("search")}),e(N,{variant:"link","data-testid":"revert-btn",onClick:()=>a({}),children:i("clear")})]})]})})},ts=({row:n})=>o(V,{children:[n.associatedPolicies?.[0]?.name," ",e(Zt,{array:n.associatedPolicies})]}),ns=({clientId:n,isDisabled:s=!1})=>{const{t:a}=w(),t=rt(),{addAlert:i,addError:l}=ce(),{realm:r}=be(),[d,c]=m(),[p,f]=m(),[g,u]=m(),[h,S]=m(),[R,y]=ke(),[b,P]=m({}),[j,$]=m(0),X=()=>$(j+1),[T,G]=m(10),[M,F]=m(0);le(async()=>{const k=await x.clients.findPermissions({first:M,max:T+1,id:n,...b});return await Promise.all(k.map(async U=>{const O=await x.clients.getAssociatedPolicies({id:n,permissionId:U.id});return{...U,associatedPolicies:O,isExpanded:!1}}))},c,[j,b,M,T]),le(async()=>{const k={first:0,max:1},[U,O,K]=await Promise.all([x.clients.listPolicyProviders({id:n}),x.clients.listResources({...k,id:n}),x.clients.listAllScopes({...k,id:n})]);return{policies:U.filter(se=>se.type==="resource"||se.type==="scope"),resources:O.length!==1,scopes:K.length!==1}},({policies:k,resources:U,scopes:O})=>{u(k),S({resources:U,scopes:O})},[]);const[L,v]=Ee({titleKey:"deletePermission",messageKey:a("deletePermissionConfirm",{permission:p?.name}),continueButtonVariant:Te.danger,continueButtonLabel:"confirm",onConfirm:async()=>{try{await x.clients.delPermission({id:n,type:p?.type,permissionId:p?.id}),i(a("permissionDeletedSuccess"),ee.success),X()}catch(k){l("permissionDeletedError",k)}}});if(!d)return e(Le,{});const I=d.length===0,q=Object.keys(b).length!==0;return o(ge,{variant:"light",className:"pf-u-p-0",children:[e(v,{}),(!I||q)&&e(Lt,{count:d.length,first:M,max:T,onNextClick:F,onPreviousClick:F,onPerPageSelect:(k,U)=>{F(k),G(U)},toolbarItem:o(V,{children:[e(ye,{children:e(en,{types:g,search:b,onSearch:P,type:"permission"})}),e(ye,{children:e(Jt,{toggle:e(Mn,{onToggle:y,isDisabled:s,isPrimary:!0,"data-testid":"permissionCreateDropdown",children:a("createPermission")}),isOpen:R,dropdownItems:[e(tt,{"data-testid":"create-resource",isDisabled:s||h?.resources,component:"button",onClick:()=>t(St({realm:r,id:n,permissionType:"resource"})),children:a("createResourceBasedPermission")},"createResourceBasedPermission"),e(Aa,{},"separator"),o(tt,{"data-testid":"create-scope",isDisabled:s||h?.scopes,component:"button",onClick:()=>t(St({realm:r,id:n,permissionType:"scope"})),children:[a("createScopeBasedPermission"),h?.scopes&&e(ot,{className:"pf-u-mt-sm",variant:"warning",isInline:!0,isPlain:!0,title:a("noScopeCreateHint")})]},"createScopeBasedPermission")]})})]}),children:!I&&o(Qe,{"aria-label":a("resources"),variant:"compact",children:[e(Ye,{children:o(oe,{children:[e(B,{"aria-hidden":"true"}),e(B,{children:a("name")}),e(B,{children:a("type")}),e(B,{children:a("associatedPolicy")}),e(B,{children:a("description")}),e(B,{"aria-hidden":"true"})]})}),d.map((k,U)=>o(Xe,{isExpanded:k.isExpanded,children:[o(oe,{children:[e(H,{expand:{rowIndex:U,isExpanded:k.isExpanded,onToggle:(O,K)=>{const se=d.map((ve,Z)=>Z===K?{...ve,isExpanded:!ve.isExpanded}:ve);c(se)}}}),e(H,{"data-testid":`name-column-${k.name}`,children:e(Ce,{to:kt({realm:r,id:n,permissionType:k.type,permissionId:k.id}),children:k.name})}),e(H,{children:g?.find(O=>O.type===k.type)?.name}),e(H,{children:e(ts,{row:k})}),e(H,{children:k.description}),e(H,{actions:{items:[{title:a("delete"),onClick:async()=>{f(k),L()}}]}})]}),o(oe,{isExpanded:k.isExpanded,children:[e(H,{}),e(H,{colSpan:5,children:e(dt,{children:k.isExpanded&&e(ut,{isHorizontal:!0,className:"keycloak_resource_details",children:e($e,{name:"associatedPolicy",array:k.associatedPolicies,convert:O=>O.name,link:O=>Wt({id:n,realm:r,policyId:O.id,policyType:O.type})})})})})]},`child-${k.id}`)]},k.id))]})}),I&&!q&&e(es,{clientId:n,isResourceEnabled:!s&&h?.resources,isScopeEnabled:!s&&h?.scopes}),I&&q&&e(De,{isSearchVariant:!0,message:a("noSearchResults"),instructions:a("noSearchResultsInstructions")})]})},as=({row:n})=>o(V,{children:[n.dependentPolicies?.[0]?.name," ",e(Zt,{array:n.dependentPolicies})]}),is=({clientId:n,isDisabled:s=!1})=>{const{t:a}=w(),{addAlert:t,addError:i}=ce(),{realm:l}=be(),r=rt(),[d,c]=m(),[p,f]=m(),[g,u]=m(),[h,S]=m(0),R=()=>S(h+1),[y,b]=m(10),[P,j]=m(0),[$,X]=m({}),[T,G]=ke();le(async()=>{const I=await x.clients.listPolicies({first:P,max:y+1,id:n,permission:"false",...$});return await Promise.all([x.clients.listPolicyProviders({id:n}),...(I||[]).map(async q=>{const k=await x.clients.listDependentPolicies({id:n,policyId:q.id});return{...q,dependentPolicies:k,isExpanded:!1}})])},([I,...q])=>{u(I.filter(k=>k.type!=="resource"&&k.type!=="scope")),c(q)},[h,$,P,y]);const[M,F]=Ee({titleKey:"deletePolicy",children:o(V,{children:[a("deletePolicyConfirm"),p?.dependentPolicies&&p.dependentPolicies.length>0&&e(ot,{variant:"warning",isInline:!0,isPlain:!0,component:"p",title:a("deletePolicyWarning"),className:"pf-u-pt-lg",children:e("p",{className:"pf-u-pt-xs",children:p.dependentPolicies.map(I=>e("strong",{className:"pf-u-pr-md",children:I.name},I.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await x.clients.delPolicy({id:n,policyId:p?.id}),t(a("policyDeletedSuccess"),ee.success),R()}catch(I){i("policyDeletedError",I)}}});if(!d)return e(Le,{});const L=d.length===0,v=Object.keys($).length!==0;return o(ge,{variant:"light",className:"pf-u-p-0",children:[e(F,{}),(!L||v)&&o(V,{children:[T&&e(hn,{policyProviders:g,onSelect:I=>r(an({id:n,realm:l,policyType:I.type})),toggleDialog:G}),e(Lt,{count:d.length,first:P,max:y,onNextClick:j,onPreviousClick:j,onPerPageSelect:(I,q)=>{j(I),b(q)},toolbarItem:o(V,{children:[e(ye,{children:e(en,{types:g,search:$,onSearch:X,type:"policy"})}),e(ye,{children:e(N,{"data-testid":"createPolicy",onClick:G,isDisabled:s,children:a("createPolicy")})})]}),children:!L&&o(Qe,{"aria-label":a("resources"),variant:"compact",children:[e(Ye,{children:o(oe,{children:[e(B,{"aria-hidden":"true"}),e(B,{children:a("name")}),e(B,{children:a("type")}),e(B,{children:a("dependentPermission")}),e(B,{children:a("description")}),e(B,{"aria-hidden":"true"})]})}),d.map((I,q)=>o(Xe,{isExpanded:I.isExpanded,children:[o(oe,{children:[e(H,{expand:{rowIndex:q,isExpanded:I.isExpanded,onToggle:(k,U)=>{const O=d.map((K,se)=>se===U?{...K,isExpanded:!K.isExpanded}:K);c(O)}}}),e(H,{"data-testid":`name-column-${I.name}`,children:e(Ce,{to:Wt({realm:l,id:n,policyType:I.type,policyId:I.id}),children:I.name})}),e(H,{children:Pt(I.type)}),e(H,{children:e(as,{row:I})}),e(H,{children:I.description}),!s&&e(H,{actions:{items:[{title:a("delete"),onClick:()=>{f(I),M()}}]}})]}),o(oe,{isExpanded:I.isExpanded,children:[e(H,{}),e(H,{colSpan:3+(s?0:1),children:e(dt,{children:I.isExpanded&&e(ut,{isHorizontal:!0,className:"keycloak_resource_details",children:e($e,{name:"dependentPermission",array:I.dependentPolicies,convert:k=>k.name,link:k=>kt({realm:l,id:n,permissionId:k.id,permissionType:k.type})})})})})]},`child-${I.id}`)]},I.id))]})})]}),L&&v&&e(De,{isSearchVariant:!0,isDisabled:s,message:a("noSearchResults"),instructions:a("noSearchResultsInstructions")}),L&&!v&&o(V,{children:[T&&e(hn,{policyProviders:g?.filter(I=>I.type!=="aggregate"),onSelect:I=>r(an({id:n,realm:l,policyType:I.type})),toggleDialog:G}),e(De,{message:a("emptyPolicies"),instructions:a("emptyPoliciesInstructions"),isDisabled:s,primaryActionText:a("createPolicy"),onPrimaryAction:G})]})]})},ss=({id:n,clientId:s,uris:a})=>{const{realm:t}=be(),[i,l]=m(),[r,d]=m();return le(()=>Promise.all([x.clients.listScopesByResource({id:s,resourceName:n}),x.clients.listPermissionsByResource({id:s,resourceId:n})]),([c,p])=>{l(c),d(p)},[]),!r||!i?e(Le,{}):o(ut,{isHorizontal:!0,className:"keycloak_resource_details",children:[e(Zi,{name:"uris",array:a}),e($e,{name:"scopes",array:i,convert:c=>c.name,link:c=>Fn({id:s,realm:t,scopeId:c.id})}),e($e,{name:"associatedPermissions",array:r,convert:c=>c.name,link:c=>kt({id:s,realm:t,permissionId:c.id,permissionType:"resource"})})]})},ls=({row:n})=>o(V,{children:[n.uris?.[0]," ",e(Zt,{array:n.uris})]}),rs=({clientId:n,isDisabled:s=!1})=>{const{t:a}=w(),t=rt(),{addAlert:i,addError:l}=ce(),{realm:r}=be(),[d,c]=m(),[p,f]=m(),[g,u]=m(),[h,S]=m(0),R=()=>S(h+1),[y,b]=m(10),[P,j]=m(0),[$,X]=m({});le(()=>{const v={first:P,max:y+1,deep:!1,...$};return x.clients.listResources({...v,id:n})},v=>c(v.map(I=>({...I,isExpanded:!1}))),[h,$,P,y]);const T=async v=>x.clients.listPermissionsByResource({id:n,resourceId:v}),[G,M]=Ee({titleKey:"deleteResource",children:o(V,{children:[a("deleteResourceConfirm"),g?.length&&e(ot,{variant:"warning",isInline:!0,isPlain:!0,title:a("deleteResourceWarning"),className:"pf-u-pt-lg",children:e("p",{className:"pf-u-pt-xs",children:g.map(v=>e("strong",{className:"pf-u-pr-md",children:v.name},v.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await x.clients.delResource({id:n,resourceId:p?._id}),i(a("resourceDeletedSuccess"),ee.success),R()}catch(v){l("resourceDeletedError",v)}}});if(!d)return e(Le,{});const F=d.length===0,L=Object.keys($).length!==0;return o(ge,{variant:"light",className:"pf-u-p-0",children:[e(M,{}),(!F||L)&&e(Lt,{count:d.length,first:P,max:y,onNextClick:j,onPreviousClick:j,onPerPageSelect:(v,I)=>{j(v),b(I)},toolbarItem:o(V,{children:[e(ye,{children:e(en,{search:$,onSearch:X,type:"resource"})}),e(ye,{children:e(N,{"data-testid":"createResource",isDisabled:s,component:v=>e(Ce,{...v,to:sn({realm:r,id:n})}),children:a("createResource")})})]}),children:!F&&o(Qe,{"aria-label":a("resources"),variant:"compact",children:[e(Ye,{children:o(oe,{children:[e(B,{"aria-hidden":"true"}),e(B,{children:a("name")}),e(B,{children:a("displayName")}),e(B,{children:a("type")}),e(B,{children:a("owner")}),e(B,{children:a("uris")}),!s&&o(V,{children:[e(B,{"aria-hidden":"true"}),e(B,{"aria-hidden":"true"})]})]})}),d.map((v,I)=>o(Xe,{isExpanded:v.isExpanded,children:[o(oe,{children:[e(H,{expand:{rowIndex:I,isExpanded:v.isExpanded,onToggle:(q,k)=>{const U=d.map((O,K)=>K===k?{...O,isExpanded:!O.isExpanded}:O);c(U)}}}),e(H,{"data-testid":`name-column-${v.name}`,children:e(Ce,{to:zn({realm:r,id:n,resourceId:v._id}),children:v.name})}),e(H,{children:v.displayName}),e(H,{children:v.type}),e(H,{children:v.owner?.name}),e(H,{children:e(ls,{row:v})}),!s&&o(V,{children:[e(H,{width:10,children:e(N,{variant:"link",component:q=>e(Ce,{...q,to:St({realm:r,id:n,permissionType:"resource",selectedId:v._id})}),children:a("createPermission")})}),e(H,{actions:{items:[{title:a("delete"),onClick:async()=>{f(v),u(await T(v._id)),G()}}]}})]})]}),o(oe,{isExpanded:v.isExpanded,children:[e(H,{}),e(H,{colSpan:4,children:e(dt,{children:v.isExpanded&&e(ss,{clientId:n,id:v._id,uris:v.uris})})})]},`child-${v._id}`)]},v._id))]})}),F&&L&&e(De,{isSearchVariant:!0,message:a("noSearchResults"),instructions:a("noSearchResultsInstructions")}),F&&!L&&e(De,{message:a("emptyResources"),instructions:a("emptyResourcesInstructions"),isDisabled:s,primaryActionText:a("createResource"),onPrimaryAction:()=>t(sn({realm:r,id:n}))})]})},os=({clientId:n,isDisabled:s=!1})=>{const{t:a}=w(),t=rt(),{realm:i}=be(),[l,r]=ke(),[d,c]=m(),[p,f]=m(),[g,u]=m([]),[h,S]=m(0),R=()=>S(h+1),[y,b]=m(10),[P,j]=m(0),[$,X]=m("");le(()=>{const L={first:P,max:y+1,deep:!1,name:$};return x.clients.listAllScopes({...L,id:n})},L=>{c(L.map(v=>({...v,isLoaded:!1}))),u(L.map(v=>({id:v.id,isExpanded:!1})))},[h,$,P,y]);const T=L=>d?.find(v=>v.id===L),G=L=>g.find(v=>v.id===L)?.isExpanded||!1;if(le(()=>{const L=g.filter(v=>v.isExpanded).map(({id:v})=>T(v)).filter(v=>!v.isLoaded);return Promise.all(L.map(async v=>{const[I,q]=await Promise.all([x.clients.listAllResourcesByScope({id:n,scopeId:v.id}),x.clients.listAllPermissionsByScope({id:n,scopeId:v.id})]);return{...v,resources:I,permissions:q,isLoaded:!0}}))},L=>{let v=[...d||[]];L.forEach(I=>{const q=d?.findIndex(k=>I.id===k.id);v=[...v.slice(0,q),I,...v.slice(q+1)]}),c(v)},[g]),!d)return e(Le,{});const M=d.length===0,F=$!=="";return o(ge,{variant:"light",className:"pf-u-p-0",children:[e(ui,{clientId:n,open:l,toggleDialog:r,selectedScope:p,refresh:R}),(!M||F)&&e(Lt,{count:d.length,first:P,max:y,onNextClick:j,onPreviousClick:j,onPerPageSelect:(L,v)=>{j(L),b(v)},inputGroupName:"search",inputGroupPlaceholder:a("searchByName"),inputGroupOnEnter:X,toolbarItem:e(ye,{children:e(N,{"data-testid":"createAuthorizationScope",component:L=>e(Ce,{...L,to:ln({realm:i,id:n})}),children:a("createAuthorizationScope")})}),children:!M&&o(Qe,{"aria-label":a("scopes"),variant:"compact",children:[e(Ye,{children:o(oe,{children:[e(B,{"aria-hidden":"true"}),e(B,{children:a("name")}),e(B,{children:a("displayName")}),e(B,{"aria-hidden":"true"}),e(B,{"aria-hidden":"true"})]})}),d.map((L,v)=>o(Xe,{isExpanded:G(L.id),children:[o(oe,{children:[e(H,{expand:{rowIndex:v,isExpanded:G(L.id),onToggle:(I,q,k)=>{u([...g.slice(0,q),{id:L.id,isExpanded:k},...g.slice(q+1)])}}}),e(H,{"data-testid":`name-column-${L.name}`,children:e(Ce,{to:Fn({realm:i,id:n,scopeId:L.id}),children:L.name})}),e(H,{children:L.displayName}),e(H,{width:10,children:e(N,{variant:"link",component:I=>e(Ce,{...I,to:St({realm:i,id:n,permissionType:"scope",selectedId:L.id})}),children:a("createPermission")})}),e(H,{isActionCell:!0,actions:{items:[{title:a("delete"),onClick:()=>{f(L),r()}}]}})]}),o(oe,{isExpanded:G(L.id),children:[e(H,{}),e(H,{colSpan:4,children:e(dt,{children:G(L.id)&&L.isLoaded?o(ut,{isHorizontal:!0,className:"keycloak_resource_details",children:[e($e,{name:"resources",array:L.resources,convert:I=>I.name,link:I=>zn({id:n,realm:i,resourceId:I._id})}),e($e,{name:"associatedPermissions",array:L.permissions,convert:I=>I.name,link:I=>kt({id:n,realm:i,permissionId:I.id,permissionType:I.type})})]}):e(Le,{})})})]},`child-${L.id}`)]},L.id))]})}),M&&!F&&e(De,{message:a("emptyAuthorizationScopes"),instructions:a("emptyAuthorizationInstructions"),isDisabled:s,onPrimaryAction:()=>t(ln({id:n,realm:i})),primaryActionText:a("createAuthorizationScope")}),M&&F&&e(De,{isSearchVariant:!0,isDisabled:s,message:a("noSearchResults"),instructions:a("noSearchResultsInstructions")})]})},cs=({onConfirm:n,closeDialog:s})=>{const{t:a}=w(),[t,i]=m({});return o(Je,{title:a("import"),isOpen:!0,variant:"small",onClose:s,actions:[e(N,{id:"modal-confirm",onClick:()=>{n(t),s()},"data-testid":"confirm",children:a("confirm")},"confirm"),e(N,{"data-testid":"cancel",id:"modal-cancel",variant:Te.link,onClick:()=>{s()},children:a("cancel")},"cancel")],children:[e(Ie,{children:e(pi,{id:"import-resource",onChange:i})}),Object.keys(t).length!==0&&o(V,{children:[e(Ge,{}),e("p",{className:"pf-u-my-lg",children:a("importResources")}),o(Ie,{isHorizontal:!0,children:[e(C,{label:a("policyEnforcementMode"),labelIcon:e(A,{helpText:a("policyEnforcementModeHelp"),fieldLabelId:"policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e(Tt,{id:"policyEnforcementMode",name:"policyEnforcementMode",label:a(`policyEnforcementModes.${t.policyEnforcementMode}`),isChecked:!0,isDisabled:!0,className:"pf-u-mb-md"})}),e(C,{label:a("decisionStrategy"),labelIcon:e(A,{helpText:a("decisionStrategyHelp"),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(Tt,{id:"decisionStrategy",name:"decisionStrategy",isChecked:!0,isDisabled:!0,label:a(`decisionStrategies.${t.decisionStrategy}`),className:"pf-u-mb-md"})}),e(C,{hasNoPaddingTop:!0,label:a("allowRemoteResourceManagement"),fieldId:"allowRemoteResourceManagement",labelIcon:e(A,{helpText:a("allowRemoteResourceManagement"),fieldLabelId:"allowRemoteResourceManagement"}),children:e(re,{id:"allowRemoteResourceManagement",label:a("on"),labelOff:a("off"),isChecked:t.allowRemoteResourceManagement,isDisabled:!0,"aria-label":a("allowRemoteResourceManagement")})})]}),e("div",{className:"pf-u-mt-md",children:Object.entries(t).filter(([,l])=>Array.isArray(l)).map(([l,r])=>o(_n,{children:[e(Ge,{}),e("p",{className:"pf-u-my-sm",children:o("strong",{children:[r.length," ",a(l)]})})]},l))}),e(Ge,{}),e(ot,{variant:"warning",className:"pf-u-mt-lg",isInline:!0,title:a("importWarning")})]})]})},En=["ENFORCING","PERMISSIVE","DISABLED"],ds=({clientId:n})=>{const{t:s}=w(),[a,t]=m(),[i,l]=ke(),r=Ne({}),{control:d,reset:c,handleSubmit:p}=r,{addAlert:f,addError:g}=ce(),{hasAccess:u}=Pe(),h=!u("manage-authorization");le(()=>x.clients.getResourceServer({id:n}),y=>{t(y),c(y)},[]);const S=async y=>{try{await x.clients.importResource({id:n},y),f(s("importResourceSuccess"),ee.success),c({...y})}catch(b){g("importResourceError",b)}},R=async y=>{try{await x.clients.updateResourceServer({id:n},y),f(s("updateResourceSuccess"),ee.success)}catch(b){g("resourceSaveError",b)}};return a?o(ge,{variant:"light",children:[i&&e(cs,{onConfirm:S,closeDialog:l}),o(ue,{role:"manage-authorization",isHorizontal:!0,onSubmit:p(R),children:[e(C,{label:s("import"),fieldId:"import",labelIcon:e(A,{helpText:s("importHelp"),fieldLabelId:"import"}),children:e(N,{variant:"secondary",onClick:l,children:s("import")})}),e(Ge,{}),e(C,{label:s("policyEnforcementMode"),labelIcon:e(A,{helpText:s("policyEnforcementModeHelp"),fieldLabelId:"policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e(D,{name:"policyEnforcementMode","data-testid":"policyEnforcementMode",defaultValue:En[0],control:d,render:({field:y})=>e(V,{children:En.map(b=>e(Tt,{id:b,"data-testid":b,isChecked:y.value===b,isDisabled:h,name:"policyEnforcementMode",onChange:()=>y.onChange(b),label:s(`policyEnforcementModes.${b}`),className:"pf-u-mb-md"},b))})})}),e(Me,{...r,children:e(ai,{isLimited:!0})}),e(C,{hasNoPaddingTop:!0,label:s("allowRemoteResourceManagement"),fieldId:"allowRemoteResourceManagement",labelIcon:e(A,{helpText:s("allowRemoteResourceManagementHelp"),fieldLabelId:"allowRemoteResourceManagement"}),children:e(D,{name:"allowRemoteResourceManagement","data-testid":"allowRemoteResourceManagement",defaultValue:!1,control:d,render:({field:y})=>e(re,{id:"allowRemoteResourceManagement",label:s("on"),labelOff:s("off"),isChecked:y.value,onChange:y.onChange,"aria-label":s("allowRemoteResourceManagement")})})}),e(_t,{name:"authenticationSettings",reset:()=>c(a),isActive:!0,isSubmit:!0})]})]}):e(Le,{})};function us(n){const[s,a]=m(null),[t,i]=m(null);function l(r){i({name:r.name,state:r.state})}return Be(()=>{a(null),i(null),navigator.permissions.query({name:n}).then(r=>{a(r),l(r)})},[n]),Be(()=>{if(!s)return;function r(){s&&l(s)}return s.addEventListener("change",r),()=>s.removeEventListener("change",r)},[s]),t}const sa=({id:n,label:s,text:a,variant:t="plain"})=>{const{t:i}=w(),l=Ra(),d=us("clipboard-write")?.state==="denied",[c,p]=m(0),f=Ct(()=>{if(d)return"clipboardCopyDenied";switch(c){case 0:return"copyToClipboard";case 1:return"copySuccess";case 2:return"clipboardCopyError"}},[d,c]);Be(()=>{if(c!==0)return l(()=>p(0),1e3)},[c,l]);const g=async u=>{try{await navigator.clipboard.writeText(u),p(1)}catch{p(2)}};return e(Ga,{id:`copy-button-${n}`,textId:s,"aria-label":i("copyToClipboard"),onClick:()=>g(a),exitDelay:600,variant:t,children:i(f)})},xn=({id:n,buttonLabel:s,client:a,secret:t,toggle:i})=>{const{t:l}=w(),r=ne(),{hasAccess:d}=Pe(),c=d("manage-clients")||a.access?.configure;return o(lt,{hasGutter:!0,children:[e(Re,{isFilled:!0,children:o(Kn,{children:[e(Bt,{id:n,value:t,isReadOnly:!0}),e(sa,{id:n,text:t,label:"clientSecret",variant:"control"})]})}),e(Re,{children:e(N,{variant:"secondary",isDisabled:r.formState.isDirty||!c,onClick:i,children:l(s)})})]})},wn=({time:n})=>{const{t:s}=w(),a=$n();return e("div",{className:"pf-u-my-md",children:(i=>i?s("secretExpiresOn",{time:a(new Date(i*1e3),{dateStyle:"full",timeStyle:"long"})}):void 0)(n)})},ps=({client:n,secret:s,toggle:a})=>{const{t}=w(),{addAlert:i,addError:l}=ce(),[r,d]=m(n.attributes?.["client.secret.rotated"]),c=n.attributes?.["client.secret.expiration.time"],p=n.attributes?.["client.secret.rotated.expiration.time"],f=h=>new Date().getTime()>=h*1e3,[g,u]=Ee({titleKey:"invalidateRotatedSecret",messageKey:"invalidateRotatedSecretExplain",continueButtonLabel:"confirm",onConfirm:async()=>{try{await x.clients.invalidateSecret({id:n.id}),d(void 0),i(t("invalidateRotatedSuccess"))}catch(h){l("invalidateRotatedError",h)}}});return o(V,{children:[e(u,{}),o(C,{label:t("clientSecret"),fieldId:"kc-client-secret",className:"pf-u-my-md",children:[e(xn,{id:"kc-client-secret",client:n,secret:s,toggle:a,buttonLabel:"regenerate"}),e(wn,{time:c}),f(c)&&e(ot,{variant:"warning",isInline:!0,title:t("secretHasExpired")})]}),r&&o(C,{label:t("secretRotated"),fieldId:"secretRotated",children:[e(xn,{id:"secretRotated",client:n,secret:r,toggle:g,buttonLabel:"invalidateSecret"}),e(wn,{time:p})]})]})},hs=({clientAuthenticatorType:n})=>{const{control:s}=ne(),{cryptoInfo:a}=We(),t=n==="client-jwt"?a?.clientSignatureAsymmetricAlgorithms??[]:a?.clientSignatureSymmetricAlgorithms??[],{t:i}=w(),[l,r]=m(!1);return e(C,{label:i("signatureAlgorithm"),fieldId:"kc-signature-algorithm",labelIcon:e(A,{helpText:i("signatureAlgorithmHelp"),fieldLabelId:"signatureAlgorithm"}),children:e(D,{name:_("attributes.token.endpoint.auth.signing.alg"),defaultValue:"",control:s,render:({field:d})=>o(Q,{maxHeight:200,toggleId:"kc-signature-algorithm",onToggle:r,onSelect:(c,p)=>{d.onChange(p.toString()),r(!1)},selections:d.value||i("anyAlgorithm"),variant:W.single,"aria-label":i("signatureAlgorithm"),isOpen:l,children:[e(z,{selected:d.value==="",value:"",children:i("anyAlgorithm")},"any"),e(V,{children:t.map(c=>e(z,{selected:c===d.value,value:c},c))})]})})})},ms=()=>{const{t:n}=w(),{register:s,control:a,formState:{errors:t}}=ne();return o(V,{children:[e(C,{label:n("allowRegexComparison"),labelIcon:e(A,{helpText:n("allowRegexComparisonHelp"),fieldLabelId:"allowRegexComparison"}),fieldId:"allowRegexComparison",hasNoPaddingTop:!0,children:e(D,{name:_("attributes.x509.allow.regex.pattern.comparison"),defaultValue:"false",control:a,render:({field:i})=>e(re,{id:"allowRegexComparison",label:n("on"),labelOff:n("off"),isChecked:i.value==="true",onChange:l=>i.onChange(l.toString()),"aria-label":n("allowRegexComparison")})})}),e(C,{label:n("subject"),fieldId:"kc-subject",labelIcon:e(A,{helpText:n("subjectHelp"),fieldLabelId:"subject"}),helperTextInvalid:n("required"),validated:t.attributes?.[Ve("x509.subjectdn")]?Ae.error:Ae.default,isRequired:!0,children:e(me,{type:"text",id:"kc-subject",validated:t.attributes?.[Ve("x509.subjectdn")]?Ae.error:Ae.default,...s(_("attributes.x509.subjectdn"),{required:!0})})})]})},gs=({client:n,save:s,refresh:a})=>{const{t}=w(),{addAlert:i,addError:l}=ce(),r=n.id,[d,c]=m([]),{control:p,formState:{isDirty:f},handleSubmit:g}=ne(),u=it({control:p,name:"clientAuthenticatorType",defaultValue:""}),[h,S]=m(""),[R,y]=m(""),[b,P]=m(!1),j=d.find(v=>v.id===u);le(()=>Promise.all([x.authenticationManagement.getClientAuthenticatorProviders(),x.clients.getClientSecret({id:r})]),([v,I])=>{c(v),S(I.value)},[]);async function $(v,I){try{const q=await v(r);return i(t(`${I}Success`),ee.success),q}catch(q){l(`${I}Error`,q)}}const X=async()=>{const v=await $(I=>x.clients.generateNewClientSecret({id:I}),"clientSecret");S(v?.value||""),a()},[T,G]=Ee({titleKey:"confirmClientSecretTitle",messageKey:"confirmClientSecretBody",continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:X}),M=async()=>{const v=await $(I=>x.clients.generateRegistrationAccessToken({id:I}),"accessToken");y(v?.registrationAccessToken||"")},[F,L]=Ee({titleKey:"confirmAccessTokenTitle",messageKey:"confirmAccessTokenBody",continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:M});return e(ge,{children:o(ue,{onSubmit:g(s),isHorizontal:!0,className:"pf-u-mt-md",role:"manage-clients",fineGrainedAccess:n.access?.configure,children:[e(G,{}),e(L,{}),o(Ot,{isFlat:!0,children:[o(nt,{children:[e(C,{label:t("clientAuthenticator"),fieldId:"kc-client-authenticator-type",labelIcon:e(A,{helpText:t("clientAuthenticatorTypeHelp"),fieldLabelId:"clientAuthenticator"}),children:e(D,{name:"clientAuthenticatorType",control:p,defaultValue:"",render:({field:v})=>e(Q,{toggleId:"kc-client-authenticator-type",required:!0,onToggle:P,onSelect:(I,q)=>{v.onChange(q),P(!1)},selections:v.value,variant:W.single,"aria-label":t("clientAuthenticator"),isOpen:b,children:d.map(I=>e(z,{selected:I.id===v.value,value:I.id,children:I.displayName},I.id))})})}),(u==="client-jwt"||u==="client-secret-jwt")&&e(hs,{clientAuthenticatorType:u}),u==="client-jwt"&&e(C,{children:e(ot,{variant:"info",isInline:!0,title:t("signedJWTConfirm")})}),u==="client-x509"&&e(ms,{}),e(_e,{children:e(N,{variant:"primary",type:"submit",isDisabled:!f,children:t("save")})})]}),j?.supportsSecret&&o(V,{children:[e(Ge,{}),e(nt,{children:e(ps,{client:n,secret:h,toggle:T})})]})]}),e(Ot,{isFlat:!0,children:e(nt,{children:e(C,{label:t("registrationAccessToken"),fieldId:"kc-access-token",labelIcon:e(A,{helpText:t("registrationAccessTokenHelp"),fieldLabelId:"registrationAccessToken"}),children:o(lt,{hasGutter:!0,children:[e(Re,{isFilled:!0,children:e(Bn,{id:"kc-access-token",isReadOnly:!0,children:R})}),e(Re,{children:e(N,{variant:"secondary",onClick:F,children:t("regenerate")})})]})})})})]})})},On=({id:n,keyInfo:s})=>{const{t:a}=w();return e(ct,{readOnly:!0,rows:5,id:n,"data-testid":"certificate",value:s?.certificate,"aria-label":a("certificate")})},tn=({keyInfo:n,plain:s=!1})=>{const{t:a}=w(),t=da();return s?e(On,{id:t,keyInfo:n}):e(C,{label:a("certificate"),fieldId:t,labelIcon:e(A,{helpText:a("certificateHelp"),fieldLabelId:t}),children:e(On,{id:t,keyInfo:n})})},la=({hidePassword:n=!1,isSaml:s=!1})=>{const{t:a}=w(),{register:t,formState:{errors:i}}=ne();return o(V,{children:[e(C,{label:a("keyAlias"),fieldId:"keyAlias",isRequired:!0,labelIcon:e(A,{helpText:a("keyAliasHelp"),fieldLabelId:"keyAlias"}),helperTextInvalid:a("required"),validated:i.keyAlias?"error":"default",children:e(me,{"data-testid":"keyAlias",id:"keyAlias",validated:i.keyAlias?"error":"default",...t("keyAlias",{required:!0})})}),!n&&e(C,{label:a("keyPassword"),fieldId:"keyPassword",isRequired:!0,labelIcon:e(A,{helpText:a("keyPasswordHelp"),fieldLabelId:"keyPassword"}),helperTextInvalid:a("required"),validated:i.keyPassword?"error":"default",children:e(Bt,{"data-testid":"keyPassword",id:"keyPassword",validated:i.keyPassword?"error":"default",...t("keyPassword",{required:!0})})}),s&&e(C,{label:a("realmCertificateAlias"),fieldId:"realmCertificateAlias",labelIcon:e(A,{helpText:a("realmCertificateAliasHelp"),fieldLabelId:"realmCertificateAlias"}),children:e(me,{"data-testid":"realmCertificateAlias",id:"realmCertificateAlias",...t("realmAlias")})}),e(C,{label:a("storePassword"),fieldId:"storePassword",isRequired:!0,labelIcon:e(A,{helpText:a("storePasswordHelp"),fieldLabelId:"storePassword"}),helperTextInvalid:a("required"),validated:i.storePassword?"error":"default",children:e(Bt,{"data-testid":"storePassword",id:"storePassword",validated:i.storePassword?"error":"default",...t("storePassword",{required:!0})})})]})},Pn="Certificate PEM",fs=new Map([["PKCS12","p12"],["JKS","jks"],["BCFKS","bcfks"]]),ra=n=>fs.get(n),Nt=({isSaml:n=!1,hasPem:s=!1,useFile:a=!1})=>{const{t}=w(),[i,l]=m(),[r,d]=m(!1),{control:c,watch:p}=ne(),f=p("format"),{cryptoInfo:g}=We(),u=[...g?.supportedKeystoreTypes??[],...s?[Pn]:[]];return o(Ie,{className:"pf-u-pt-lg",children:[e(C,{label:t("archiveFormat"),labelIcon:e(A,{helpText:t("archiveFormatHelp"),fieldLabelId:"archiveFormat"}),fieldId:"archiveFormat",children:e(D,{name:"format",defaultValue:u[0],control:c,render:({field:h})=>e(Q,{toggleId:"archiveFormat",onToggle:d,onSelect:(S,R)=>{h.onChange(R.toString()),d(!1)},selections:h.value,variant:W.single,"aria-label":t("archiveFormat"),isOpen:r,menuAppendTo:"parent",children:u.map(S=>e(z,{selected:S===h.value,value:S},S))})})}),a&&e(C,{label:t("importFile"),labelIcon:e(A,{helpText:t("importFileHelp"),fieldLabelId:"importFile"}),fieldId:"importFile",children:e(D,{name:"file",defaultValue:"",control:c,render:({field:h})=>e(Zn,{id:"importFile",value:h.value,filename:i,browseButtonText:t("browse"),onChange:(S,R)=>{l(R),h.onChange(S)}})})}),f!==Pn&&e(la,{hidePassword:a,isSaml:n})]})},bs=({clientId:n,save:s,toggleDialog:a})=>{const{t}=w(),i=Ne({defaultValues:{keyAlias:n},mode:"onChange"}),{handleSubmit:l,formState:{isValid:r}}=i;return o(Je,{variant:At.medium,title:t("generateKeys"),isOpen:!0,onClose:a,actions:[e(N,{id:"modal-confirm","data-testid":"confirm",isDisabled:!r,onClick:()=>{l(d=>{s(d),a()})()},children:t("generate")},"confirm"),e(N,{id:"modal-cancel","data-testid":"cancel",variant:Te.link,onClick:()=>{a()},children:t("cancel")},"cancel")],children:[e(je,{children:e(Se,{children:t("generateKeysDescription")})}),e(Me,{...i,children:e(Nt,{})})]})},ys=({save:n,toggleDialog:s})=>{const{t:a}=w(),t=Ne(),{control:i,handleSubmit:l}=t,[r,d]=m(!1),c=We().cryptoInfo?.supportedKeystoreTypes??[],p=c.concat(["Certificate PEM","Public Key PEM","JSON Web Key Set"]),f=it({control:i,name:"keystoreFormat",defaultValue:p[0]});return o(Je,{variant:At.medium,title:a("generateKeys"),isOpen:!0,onClose:s,actions:[e(N,{id:"modal-confirm","data-testid":"confirm",onClick:()=>{l(g=>{n(g),s()})()},children:a("import")},"confirm"),e(N,{id:"modal-cancel","data-testid":"cancel",variant:Te.link,onClick:()=>{s()},children:a("cancel")},"cancel")],children:[e(je,{children:e(Se,{children:a("generateKeysDescription")})}),o(Ie,{className:"pf-u-pt-lg",children:[e(C,{label:a("archiveFormat"),labelIcon:e(A,{helpText:a("archiveFormatHelp"),fieldLabelId:"archiveFormat"}),fieldId:"archiveFormat",children:e(D,{name:"keystoreFormat",control:i,defaultValue:p[0],render:({field:g})=>e(Q,{toggleId:"archiveFormat",onToggle:d,onSelect:(u,h)=>{g.onChange(h),d(!1)},selections:g.value,variant:W.single,"aria-label":a("archiveFormat"),isOpen:r,children:p.map(u=>e(z,{selected:u===g.value,value:u},u))})})}),c.includes(f)&&e(Me,{...t,children:e(la,{hidePassword:!0})}),e(C,{label:a("importFile"),fieldId:"importFile",children:e(D,{name:"file",control:i,defaultValue:{filename:""},render:({field:g})=>e(Zn,{id:"importFile",value:g.value.value,filename:g.value.filename,onChange:(u,h)=>g.onChange({value:u,filename:h})})})})]})]})},zt="jwt.credential",vs=({clientId:n,save:s,hasConfigureAccess:a})=>{const{t}=w(),{control:i,register:l,getValues:r,formState:{isDirty:d}}=ne(),{addAlert:c,addError:p}=ce(),[f,g]=m(),[u,h,S]=ke(),[R,y,b]=ke(),[P,j]=m(0),$=()=>j(P+1),X=it({control:i,name:_("attributes.use.jwks.url"),defaultValue:"false"});le(()=>x.clients.getKeyInfo({id:n,attr:zt}),M=>g(M),[P]);const T=async M=>{try{const F=await x.clients.generateAndDownloadKey({id:n,attr:zt},M);st.saveAs(new Blob([F],{type:"application/octet-stream"}),`keystore.${ra(M.format??"")}`),c(t("generateSuccess"),ee.success),$()}catch(F){p("generateError",F)}},G=async M=>{try{const F=new FormData,{file:L,...v}=M;for(const[I,q]of Object.entries(v))F.append(I,q);F.append("file",L.value),await x.clients.uploadCertificate({id:n,attr:zt},F),c(t("importSuccess"),ee.success),$()}catch(F){p("importError",F)}};return o(ge,{variant:"light",className:"keycloak__form",children:[u&&e(bs,{clientId:r("clientId"),toggleDialog:h,save:T}),R&&e(ys,{toggleDialog:y,save:G}),o(Ot,{isFlat:!0,children:[e(Ea,{children:e(xa,{children:t("jwksUrlConfig")})}),e(nt,{children:e(je,{children:e(Se,{children:t("keysIntro")})})}),e(nt,{children:o(ue,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e(C,{hasNoPaddingTop:!0,label:t("useJwksUrl"),fieldId:"useJwksUrl",labelIcon:e(A,{helpText:t("useJwksUrlHelp"),fieldLabelId:"useJwksUrl"}),children:e(D,{name:_("attributes.use.jwks.url"),control:i,render:({field:M})=>e(re,{"data-testid":"useJwksUrl",id:"useJwksUrl-switch",label:t("on"),labelOff:t("off"),isChecked:M.value==="true",onChange:F=>M.onChange(`${F}`),"aria-label":t("useJwksUrl")})})}),X!=="true"&&(f?e(tn,{plain:!0,keyInfo:f}):"No client certificate configured"),X==="true"&&e(C,{label:t("jwksUrl"),fieldId:"jwksUrl",labelIcon:e(A,{helpText:t("jwksUrlHelp"),fieldLabelId:"jwksUrl"}),children:e(me,{id:"jwksUrl",type:"url",...l(_("attributes.jwks.url"))})}),o(_e,{children:[e(N,{"data-testid":"saveKeys",onClick:s,isDisabled:!d,children:t("save")}),e(N,{"data-testid":"generate",variant:"secondary",onClick:()=>S(!0),children:t("generateNewKeys")}),e(N,{"data-testid":"import",variant:"secondary",onClick:()=>b(!0),isDisabled:X==="true",children:t("import")})]})]})})]})]})},Ss=({clientId:n,close:s,keyType:a})=>{const{t}=w(),{realm:i}=be(),{addAlert:l,addError:r}=ce(),d=Ne({defaultValues:{realmAlias:i}}),c=async p=>{try{const f=await x.clients.downloadKey({id:n,attr:a},p);st.saveAs(new Blob([f],{type:"application/octet-stream"}),`keystore.${ra(p.format??"")}`),l(t("samlKeysExportSuccess")),s()}catch(f){r("samlKeysExportError",f)}};return e(Je,{variant:"medium",title:t("exportSamlKeyTitle"),isOpen:!0,onClose:s,actions:[e(N,{id:"modal-confirm","data-testid":"confirm",type:"submit",form:"export-saml-key-form",children:t("export")},"confirm"),e(N,{id:"modal-cancel","data-testid":"cancel",variant:"link",onClick:()=>{s()},children:t("cancel")},"cancel")],children:e(Ie,{id:"export-saml-key-form",className:"pf-u-pt-lg",onSubmit:d.handleSubmit(c),children:e(Me,{...d,children:e(Nt,{isSaml:!0})})})})},oa=async(n,s,a,t)=>{try{const i=new FormData,{file:l,...r}=n;Object.entries(r).map(([d,c])=>i.append(d==="format"?"keystoreFormat":d,c.toString())),i.append("file",l),await x.clients.uploadKey({id:s,attr:a},i),t()}catch(i){t(i)}},Ts=({id:n,attr:s,onClose:a,onCancel:t})=>{const{t:i}=w(),[l,r]=m(!1),[d,c]=m(),p=Ne({mode:"onChange"}),{handleSubmit:f,formState:{isValid:g}}=p,{addAlert:u,addError:h}=ce(),S=y=>{oa(y,n,s,b=>{b?h("importError",b):u(i("importSuccess"),ee.success)})},R=async()=>{try{const y=await x.clients.generateKey({id:n,attr:s});c(y),st.saveAs(new Blob([y.privateKey],{type:"application/octet-stream"}),"private.key"),u(i("generateSuccess"),ee.success)}catch(y){h("generateError",y)}};return e(Je,{variant:At.medium,"aria-label":i("enableClientSignatureRequiredModal"),header:o(je,{children:[e(vt,{headingLevel:"h1",children:i("enableClientSignatureRequired")}),e(Se,{children:i("enableClientSignatureRequiredExplain")})]}),isOpen:!0,onClose:a,actions:[e(N,{id:"modal-confirm","data-testid":"confirm",variant:"primary",isDisabled:!g&&!d,onClick:()=>{l&&f(S)(),a()},children:i("confirm")},"confirm"),e(N,{id:"modal-cancel","data-testid":"cancel",variant:Te.link,onClick:t,children:i("cancel")},"cancel")],children:o(Me,{...p,children:[o(Ie,{isHorizontal:!0,children:[e(C,{label:i("selectMethod"),fieldId:"selectMethod",hasNoPaddingTop:!0,children:o(hi,{children:[e(gn,{children:e(Tt,{isChecked:!l,name:"selectMethodType",onChange:()=>r(!1),label:i("selectMethodType.generate"),id:"selectMethodType-generate"})}),e(gn,{children:e(Tt,{isChecked:l,name:"selectMethodType",onChange:()=>r(!0),label:i("selectMethodType.import"),id:"selectMethodType-import"})})]})}),!l&&e(C,{label:i("certificate"),fieldId:"certificate",labelIcon:e(A,{helpText:i("certificateHelp"),fieldLabelId:"certificate"}),children:o(lt,{hasGutter:!0,children:[e(Re,{isFilled:!0,children:e(tn,{plain:!0,keyInfo:d})}),e(Re,{children:e(N,{variant:"secondary","data-testid":"generate",onClick:R,children:i("generate")})})]})})]}),l&&e(Nt,{useFile:!0})]})})},Cs=({id:n,attr:s,onClose:a})=>{const{t}=w(),i=ne(),{handleSubmit:l}=i,{addAlert:r,addError:d}=ce(),c=p=>{oa(p,n,s,f=>{f?d("importError",f):r(t("importSuccess"),ee.success)})};return e(Qt,{open:!0,toggleDialog:a,continueButtonLabel:"import",titleKey:"importKey",onConfirm:()=>{l(c)(),a()},children:e(Me,{...i,children:e(Nt,{useFile:!0,hasPem:!0})})})},Vt=["saml.signing","saml.encryption"],at={"saml.signing":{name:_("attributes.saml.client.signature"),title:"signingKeysConfig",key:"clientSignature"},"saml.encryption":{name:_("attributes.saml.encrypt"),title:"encryptionKeysConfig",key:"encryptAssertions"}},Is=({clientId:n,keyInfo:s,attr:a,onChanged:t,onGenerate:i,onImport:l})=>{const{t:r}=w(),{control:d,watch:c}=ne(),p=at[a].title,f=at[a].key,g=at[a].name,[u,h]=ke(),S=c(g);return o(V,{children:[u&&e(Ss,{keyType:a,clientId:n,close:h}),o(wa,{title:r(p),className:"kc-form-panel__panel",children:[e(je,{className:"pf-u-pb-lg",children:e(Se,{children:r(`${p}Explain`)})}),e(ue,{role:"manage-clients",isHorizontal:!0,children:e(C,{labelIcon:e(A,{helpText:r(`${f}Help`),fieldLabelId:f}),label:r(f),fieldId:f,hasNoPaddingTop:!0,children:e(D,{name:g,control:d,defaultValue:"false",render:({field:R})=>e(re,{"data-testid":f,id:f,label:r("on"),labelOff:r("off"),isChecked:R.value==="true",onChange:y=>{const b=y.toString();b==="true"?(t(a),R.onChange(b)):i(a,!1)},"aria-label":r(f)})})})})]}),s?.certificate&&S==="true"&&e(Ot,{isFlat:!0,children:e(nt,{className:"kc-form-panel__body",children:o(Ie,{isHorizontal:!0,children:[e(tn,{keyInfo:s}),o(_e,{children:[e(N,{variant:"secondary",onClick:()=>i(a,!0),children:r("regenerate")}),e(N,{variant:"secondary",onClick:()=>l(a),children:r("importKey")}),e(N,{variant:"tertiary",onClick:h,children:r("export")})]})]})})})]})},ks=({clientId:n,save:s})=>{const{t:a}=w(),[t,i]=m(),[l,r]=m(),[d,c]=m(),[p,f]=m(),[g,u]=m(0),{setValue:h}=ne(),{addAlert:S,addError:R}=ce();le(()=>Promise.all(Vt.map(T=>x.clients.getKeyInfo({id:n,attr:T}))),T=>r(T),[g]);const y=async T=>{const G=Vt.indexOf(T);try{const M=[...l||[]];M[G]=await x.clients.generateKey({id:n,attr:T}),r(M),st.saveAs(new Blob([M[G].privateKey],{type:"application/octet-stream"}),"private.key"),S(a("generateSuccess"),ee.success)}catch(M){R("generateError",M)}},b=d?at[d].key:"",[P,j]=Ee({titleKey:a("disableSigning",{key:a(b)}),messageKey:a("disableSigningExplain",{key:a(b)}),continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:()=>{h(at[d].name,"false"),s()}}),[$,X]=Ee({titleKey:"reGenerateSigning",messageKey:"reGenerateSigningExplain",continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:()=>{y(d)}});return o(ge,{variant:"light",className:"keycloak__form",children:[t&&e(Ts,{id:n,attr:t,onClose:()=>{i(void 0),s(),u(g+1)},onCancel:()=>{h(at[d].name,"false"),i(void 0)}}),e(j,{}),e(X,{}),Vt.map((T,G)=>o(_n,{children:[p===T&&e(Cs,{id:n,attr:T,onClose:()=>f(void 0)}),e(Is,{clientId:n,keyInfo:l?.[G],attr:T,onChanged:i,onGenerate:(M,F)=>{c(M),F?$():P()},onImport:()=>f(T)})]},T))]})},wt="dedicated",As=({clientId:n,refresh:s,fineGrainedAccess:a,...t})=>{const{t:i}=w(),{addAlert:l,addError:r}=ce(),{hasAccess:d}=Pe(),c=f=>f.id===wt,p=d("manage-clients")||a;return e(Si,{isDisabled:c(t)||!p,clientScope:t,type:t.type,onSelect:async f=>{try{await Ti(n,t,t.type,f),l(i("clientScopeSuccess"),ee.success),s()}catch(g){r("clientScopeError",g)}}})},Rs=({clientId:n,protocol:s,clientName:a,fineGrainedAccess:t})=>{const{t:i}=w(),{addAlert:l,addError:r}=ce(),{realm:d}=be(),c=Oa(),[p,f]=m("name"),[g,u]=m(fn.none),[h,S]=m(!1),[R,y]=m(),[b,P]=m([]),j=O=>P(O.filter(({id:K})=>K!==wt)),[$,X]=m(!1),[T,G]=m(0),M=()=>G(T+1),F=O=>O.id===wt,{hasAccess:L}=Pe(),v=L("manage-clients")||t,I=L("view-clients")||t,q=async(O,K,se)=>{const ve=await x.clients.listDefaultClientScopes({id:n}),Z=await x.clients.listOptionalClientScopes({id:n}),J=await x.clientScopes.find(),de=he=>J.find(Ke=>he===Ke.id),pe=Z.map(he=>{const Ke=de(he.id);return{...he,type:yn.optional,description:Ke?.description}}),pt=ve.map(he=>{const Ke=de(he.id);return{...he,type:yn.default,description:Ke?.description}});let xe=[...pe,...pt];const ht=xe.map(he=>he.name);y(J.filter(he=>!ht.includes(he.name)).filter(he=>he.protocol===s)),xe=c(xe,La("name")),I&&xe.unshift({id:wt,name:i("dedicatedScopeName",{clientName:a}),type:fn.none,description:i("dedicatedScopeDescription")});const mt=p==="name"?bi(se):yi(g),Ze=Number(O);return xe.filter(mt).slice(Ze,Ze+Number(K))},[k,U]=Ee({titleKey:i("deleteClientScope",{count:b.length,name:b[0]?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:Te.danger,onConfirm:async()=>{try{await bn(n,b[0],b[0].type),l(i("clientScopeRemoveSuccess"),ee.success),M()}catch(O){r("clientScopeRemoveError",O)}}});return o(V,{children:[R&&e(ii,{clientScopes:R,clientName:a,open:h,toggleDialog:()=>S(!h),onAdd:async O=>{try{await Promise.all(O.map(async K=>await vi(n,K.scope,K.type))),l(i("clientScopeSuccess"),ee.success),M()}catch(K){r("clientScopeError",K)}}}),e(Dt,{loader:q,ariaLabelKey:`clientScopeList-${T}`,searchPlaceholderKey:p==="name"?"searchByName":void 0,canSelectAll:!0,isPaginated:!0,isSearching:p==="type",onSelect:O=>j([...O]),searchTypeComponent:e(mi,{searchType:p,onSelect:O=>f(O)}),toolbarItem:o(V,{children:[e(gi,{searchType:p,type:g,onSelect:O=>f(O),onType:O=>{u(O),M()}}),v&&o(V,{children:[e(U,{}),e(ye,{children:e(N,{onClick:()=>S(!0),children:i("addClientScope")})}),e(ye,{children:e(fi,{clientId:n,selectedRows:b,refresh:M})}),e(ye,{children:e(Jt,{toggle:e(Pa,{onToggle:()=>X(!$)}),isOpen:$,isPlain:!0,dropdownItems:[e(tt,{isDisabled:b.length===0,onClick:async()=>{try{await Promise.all(b.map(O=>bn(n,{...O},O.type))),X(!1),j([]),l(i("clientScopeRemoveSuccess")),M()}catch(O){r("clientScopeRemoveError",O)}},children:i("remove")},"deleteAll")]})})]})]}),columns:[{name:"name",displayKey:"assignedClientScope",cellRenderer:O=>F(O)?e(Ce,{to:_a({realm:d,clientId:n}),children:O.name}):O.name},{name:"type",displayKey:"assignedType",cellRenderer:O=>e(As,{clientId:n,refresh:M,...O})},{name:"description"}],actions:v?[{title:i("remove"),onRowClick:async O=>(j([O]),k(),!0)}]:[],emptyState:e(De,{message:i("emptyClientScopes"),instructions:i("emptyClientScopesInstructions"),primaryActionText:i("emptyClientScopesPrimaryAction"),onPrimaryAction:()=>S(!0)})},T)]})},qt=({text:n,user:s,label:a})=>{const{t}=w();return s?e(ea,{id:a,actions:e(ta,{children:e(sa,{id:"code",text:n,label:a})}),children:e(ct,{id:`text-area-${a}`,rows:20,value:n,"aria-label":a})}):o(Yn,{variant:"large",id:a,children:[e(vt,{headingLevel:"h2",size:"lg",children:t(`${a}No`)}),e(Xn,{children:t(`${a}IsDisabled`)})]})},Es=({protocolMappers:n})=>{const[s,a]=m(0);return Be(()=>{a(s+1)},[n]),e(Dt,{loader:()=>Promise.resolve(n),ariaLabelKey:"effectiveProtocolMappers",searchPlaceholderKey:"searchForProtocol","data-testid":"effective-protocol-mappers",columns:[{name:"mapperName",displayKey:"name"},{name:"containerName",displayKey:"parentClientScope"},{name:"type.category",displayKey:"category"},{name:"type.priority",displayKey:"priority"}]},s)},xs=({effectiveRoles:n})=>{const[s,a]=m(0);return Be(()=>{a(s+1)},[n]),e(Dt,{loader:()=>Promise.resolve(n),ariaLabelKey:"effectiveRoleScopeMappings",searchPlaceholderKey:"searchForRole","data-testid":"effective-role-scope-mappings",columns:[{name:"name",displayKey:"role"},{name:"containerId",displayKey:"origin"}]},s)},ws=({clientId:n,protocol:s})=>{const a="openid",{t}=w(),{enabled:i}=Ln(),{realm:l}=be(),r=We().protocolMapperTypes[s],[d,c]=m([]),[p,f]=m(!1),[g,u]=m([a]),[h,S]=m(0),[R,y]=m(""),b=()=>y(`${new Date().getTime()}`),[P,j]=m([]),[$,X]=m([]),[T,G]=m(""),[M,F]=m(""),[L,v]=m(""),I=ft(null),q=ft(null),k=ft(null),U=ft(null),O=ft(null),K=Ne(),{hasAccess:se}=Pe(),ve=se("view-users");return le(()=>x.clients.listOptionalClientScopes({id:n}),Z=>c(Z),[]),le(async()=>{const Z=g.join(" "),J=await x.clients.evaluatePermission({id:n,roleContainer:l,scope:Z,type:"granted"});return{mapperList:await x.clients.evaluateListProtocolMapper({id:n,scope:Z}),effectiveRoles:J}},({mapperList:Z,effectiveRoles:J})=>{j(J),Z.map(de=>{de.type=r.filter(pe=>pe.id===de.protocolMapper)[0]}),X(Z),b()},[g]),le(async()=>{const Z=g.join(" "),J=K.getValues("user");return J?await Promise.all([x.clients.evaluateGenerateAccessToken({id:n,userId:J[0],scope:Z}),x.clients.evaluateGenerateUserInfo({id:n,userId:J[0],scope:Z}),x.clients.evaluateGenerateIdToken({id:n,userId:J[0],scope:Z})]):[]},([Z,J,de])=>{G(et(Z)),F(et(J)),v(et(de))},[K.getValues("user"),g]),o(V,{children:[o(ge,{variant:"light",children:[i&&e(je,{className:"keycloak__section_intro__help",children:o(Se,{children:[e(Ii,{})," ",t("evaluateExplain")]})}),o(Ie,{isHorizontal:!0,children:[e(C,{label:t("scopeParameter"),fieldId:"scopeParameter",labelIcon:e(A,{helpText:t("scopeParameterHelp"),fieldLabelId:"scopeParameter"}),children:o(lt,{hasGutter:!0,children:[e(Re,{isFilled:!0,children:e(Q,{toggleId:"scopeParameter",variant:W.typeaheadMulti,typeAheadAriaLabel:t("scopeParameter"),onToggle:()=>f(!p),isOpen:p,selections:g,onSelect:(Z,J)=>{const de=J;g.includes(de)?de!==a&&u(g.filter(pe=>pe!==de)):u([...g,de])},"aria-labelledby":t("scopeParameter"),placeholderText:t("scopeParameterPlaceholder"),children:d.map((Z,J)=>e(z,{value:Z.name},J))})}),e(Re,{children:e(Bn,{className:"keycloak__scopes_evaluate__clipboard-copy",children:g.join(" ")})})]})}),ve&&e(Me,{...K,children:e(Jn,{name:"user",label:"users",helpText:t("userHelp"),defaultValue:"",variant:W.typeahead,isRequired:!0})})]})]}),o(Da,{hasGutter:!0,className:"keycloak__scopes_evaluate__tabs",children:[o(rn,{span:8,children:[e(bt,{"aria-labelledby":"pf-tab-0-effectiveProtocolMappers",eventKey:0,id:"effectiveProtocolMappers",ref:I,children:e(Es,{protocolMappers:$})}),e(bt,{"aria-labelledby":"pf-tab-0-effectiveRoleScopeMappings",eventKey:1,id:"effectiveRoleScopeMappings",ref:q,hidden:!0,children:e(xs,{effectiveRoles:P})}),e(bt,{"aria-labelledby":t("generatedAccessToken"),eventKey:2,id:"tab-generated-access-token",ref:k,hidden:!0,children:e(qt,{text:T,user:K.getValues("user"),label:"generatedAccessToken"})}),e(bt,{"aria-labelledby":t("generatedIdToken"),eventKey:3,id:"tab-generated-id-token",ref:U,hidden:!0,children:e(qt,{text:L,user:K.getValues("user"),label:"generatedIdToken"})}),e(bt,{"aria-labelledby":t("generatedUserInfo"),eventKey:4,id:"tab-generated-user-info",ref:O,hidden:!0,children:e(qt,{text:M,user:K.getValues("user"),label:"generatedUserInfo"})})]}),e(rn,{span:4,children:o(Ci,{id:"tabs",isVertical:!0,activeKey:h,onSelect:(Z,J)=>S(J),children:[e(ae,{id:"effectiveProtocolMappers","aria-controls":"effectiveProtocolMappers","data-testid":"effective-protocol-mappers-tab",eventKey:0,title:o(ie,{children:[t("effectiveProtocolMappers")," ",e(A,{fieldLabelId:"effectiveProtocolMappers",helpText:t("effectiveProtocolMappersHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:I}),e(ae,{id:"effectiveRoleScopeMappings","aria-controls":"effectiveRoleScopeMappings","data-testid":"effective-role-scope-mappings-tab",eventKey:1,title:o(ie,{children:[t("effectiveRoleScopeMappings")," ",e(A,{fieldLabelId:"effectiveRoleScopeMappings",helpText:t("effectiveRoleScopeMappingsHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:q}),e(ae,{id:"generatedAccessToken","aria-controls":"generatedAccessToken","data-testid":"generated-access-token-tab",eventKey:2,title:o(ie,{children:[t("generatedAccessToken")," ",e(A,{fieldLabelId:"generatedAccessToken",helpText:t("generatedAccessTokenHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:k}),e(ae,{id:"generatedIdToken","aria-controls":"generatedIdToken","data-testid":"generated-id-token-tab",eventKey:3,title:o(ie,{children:[t("generatedIdToken")," ",e(A,{fieldLabelId:"generatedIdToken",helpText:t("generatedIdTokenHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:U}),e(ae,{id:"generatedUserInfo","aria-controls":"generatedUserInfo","data-testid":"generated-user-info-tab",eventKey:4,title:o(ie,{children:[t("generatedUserInfo")," ",e(A,{fieldLabelId:"generatedUserInfo",helpText:t("generatedUserInfoHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:O})]},R)})]})]})},Os=({client:n})=>{const{t:s}=w(),{addAlert:a,addError:t}=ce(),{realm:i}=be(),[l,r]=m(),{hasAccess:d}=Pe(),c=d("manage-clients");le(()=>x.clients.getServiceAccountUser({id:n.id}),f=>r(f),[]);const p=async f=>{try{const g=f.filter(u=>u.client===void 0).map(u=>u.role).flat();await x.users.addRealmRoleMappings({id:l?.id,roles:g}),await Promise.all(f.filter(u=>u.client!==void 0).map(u=>x.users.addClientRoleMappings({id:l?.id,clientUniqueId:u.client.id,roles:[u.role]}))),a(s("roleMappingUpdatedSuccess"),ee.success)}catch(g){t("roleMappingUpdatedError",g)}};return l?o(V,{children:[o(ge,{className:"pf-u-pb-0",children:[e(Vn,{className:"pf-c-alert__icon keycloak--service-account--info-text"}),e("span",{className:"pf-u-pl-sm",children:o(Ai,{i18nKey:"manageServiceAccountUser",children:["",e(Ce,{to:Na({realm:i,id:l.id,tab:"settings"}),children:{link:l.username}})]})})]}),e(ki,{name:n.clientId,id:l.id,type:"users",isManager:c||n.access?.configure,save:p})]}):e(Le,{})},Ps=({onChange:n,value:s,save:a,client:t,toggleDownloadDialog:i,toggleDeleteDialog:l})=>{const{t:r}=w(),[d,c]=Ee({titleKey:"disableConfirmClientTitle",messageKey:"disableConfirmClient",continueButtonLabel:"disable",onConfirm:()=>{n(!s),a()}}),p=Ct(()=>{const h=si(r,t.protocol??"openid-connect");return[{text:t.bearerOnly?e(Hn,{"data-testid":"bearer-only-explainer-tooltip",content:r("explainBearerOnly"),children:e(Ut,{"data-testid":"bearer-only-explainer-label",icon:e(Vn,{}),children:h})}):e(Ut,{children:h})}]},[t,r]),{hasAccess:f}=Pe(),g=f("manage-clients")||t.access?.configure,u=[e(tt,{onClick:i,children:r("downloadAdapterConfig")},"download"),e(tt,{onClick:()=>Fa(t),children:r("export")},"export"),...!xt(t)&&g?[e(Ge,{},"divider"),e(tt,{"data-testid":"delete-client",onClick:l,children:r("delete")},"delete")]:[]];return o(V,{children:[e(c,{}),e(ja,{titleKey:t.clientId,subKey:"clientsExplain",badges:p,divider:!1,isReadOnly:!g,helpTextKey:"enableDisable",dropdownItems:u,isEnabled:s,onToggle:h=>{h?(n(h),a()):d()}})]})};function Ul(){const{t:n}=w(),{addAlert:s,addError:a}=ce(),{realm:t}=be(),{hasAccess:i}=Pe(),l=qn(),r=i("manage-authorization"),d=i("view-authorization"),c=i("manage-clients"),p=i("view-clients"),f=i("view-users"),g=l(Un.AdminFineGrainedAuthz)&&(r||d),u=rt(),[h,S]=ke(),[R,y]=ke(),b=Ne(),{clientId:P}=Yt(),[j,$]=m(0),X=it({control:b.control,name:"clientAuthenticatorType",defaultValue:"client-secret"}),[T,G]=m(),M=async()=>{const te=await x.clients.listRoles({id:P});return Gn(te,gt=>gt.name?.toUpperCase())},F=te=>Mt(za({realm:t,clientId:P,tab:te})),L=F("settings"),v=F("keys"),I=F("credentials"),q=F("roles"),k=F("clientScopes"),U=F("authorization"),O=F("serviceAccount"),K=F("sessions"),se=F("permissions"),ve=F("advanced"),Z=te=>Mt(on({realm:t,clientId:P,tab:te})),J=Z("setup"),de=Z("evaluate"),pe=te=>Mt(cn({realm:t,clientId:P,tab:te})),pt=pe("settings"),xe=pe("resources"),ht=pe("scopes"),mt=pe("policies"),Ze=pe("permissions"),he=pe("evaluate"),Ke=pe("export"),[E,fe]=Ee({titleKey:"clientDeleteConfirmTitle",messageKey:"clientDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:Te.danger,onConfirm:async()=>{try{await x.clients.del({id:P}),s(n("clientDeletedSuccess"),ee.success),u(Ka({realm:t}))}catch(te){a("clientDeleteError",te)}}}),Y=te=>{b.reset({...te}),Va(te,b.setValue),te.attributes?.["acr.loa.map"]&&b.setValue(_("attributes.acr.loa.map"),Object.entries(JSON.parse(te.attributes["acr.loa.map"])).flatMap(([gt,Kt])=>({key:gt,value:Kt})))};le(()=>x.clients.findOne({id:P}),te=>{if(!te)throw new Error(n("notFound"));G(qa(te)),Y(te)},[P,j]);const Fe=async({confirmed:te=!1,messageKey:gt="clientSaveSuccess"}={confirmed:!1,messageKey:"clientSaveSuccess"})=>{if(!await b.trigger())return;if(!T?.publicClient&&T?.clientAuthenticatorType!==X&&!te){y();return}const Kt=dn(b.getValues()),Rt=dn(Kt);Rt.attributes?.["acr.loa.map"]&&(Rt.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(Rt.attributes["acr.loa.map"].filter(({key:we})=>we!=="").map(({key:we,value:ca})=>[we,ca]))));try{const we={...T,...Rt};we.clientId=we.clientId?.trim(),await x.clients.update({id:P},we),Y(we),G(we),s(n(gt),ee.success)}catch(we){a("clientSaveError",we)}};return T?o(V,{children:[e(Qt,{continueButtonLabel:"yes",cancelButtonLabel:"no",titleKey:n("changeAuthenticatorConfirmTitle",{clientAuthenticatorType:X}),open:R,toggleDialog:y,onConfirm:()=>Fe({confirmed:!0}),children:e(V,{children:n("changeAuthenticatorConfirm",{clientAuthenticatorType:X})})}),e(fe,{}),h&&e(Ri,{id:T.id,protocol:T.protocol,open:!0,toggleDialog:S}),e(D,{name:"enabled",control:b.control,defaultValue:!0,render:({field:te})=>e(Ps,{value:te.value,onChange:te.onChange,client:T,save:Fe,toggleDeleteDialog:E,toggleDownloadDialog:S})}),e(ge,{variant:"light",className:"pf-u-p-0",children:e(Me,{...b,children:o(Ht,{"data-testid":"client-tabs","aria-label":"client-tabs",isBox:!0,mountOnEnter:!0,children:[e(ae,{id:"settings","data-testid":"clientSettingsTab",title:e(ie,{children:n("settings")}),...L,children:e(Ui,{client:T,save:()=>Fe(),reset:()=>Y(T)})}),(!T.publicClient&&!xt(T)||T.protocol==="saml")&&o(ae,{id:"keys","data-testid":"keysTab",title:e(ie,{children:n("keys")}),...v,children:[T.protocol==="openid-connect"&&e(vs,{clientId:P,save:Fe,hasConfigureAccess:T.access?.configure}),T.protocol==="saml"&&e(ks,{clientId:P,save:Fe})]}),!T.publicClient&&!xt(T)&&(p||T.access?.configure||T.access?.view)&&e(ae,{id:"credentials",title:e(ie,{children:n("credentials")}),...I,children:e(gs,{client:T,save:Fe,refresh:()=>$(j+1)},j)}),e(ae,{id:"roles","data-testid":"rolesTab",title:e(ie,{children:n("roles")}),...q,children:e(Ba,{loader:M,paginated:!1,messageBundle:"client",toCreate:Ha({realm:t,clientId:T.id}),toDetail:te=>Ma({realm:t,clientId:T.id,id:te,tab:"details"}),isReadOnly:!(c||T.access?.configure)})}),!xt(T)&&!T.bearerOnly&&e(ae,{id:"clientScopes","data-testid":"clientScopesTab",title:e(ie,{children:n("clientScopes")}),...k,children:o(Ht,{defaultLocation:on({realm:t,clientId:P,tab:"setup"}),children:[e(ae,{id:"setup","data-testid":"clientScopesSetupTab",title:e(ie,{children:n("setup")}),...J,children:e(Rs,{clientName:T.clientId,clientId:P,protocol:T.protocol,fineGrainedAccess:T.access?.manage})}),e(ae,{id:"evaluate","data-testid":"clientScopesEvaluateTab",title:e(ie,{children:n("evaluate")}),...de,children:e(ws,{clientId:P,protocol:T.protocol})})]})}),T.authorizationServicesEnabled&&(r||d)&&e(ae,{id:"authorization","data-testid":"authorizationTab",title:e(ie,{children:n("authorization")}),...U,children:o(Ht,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:cn({realm:t,clientId:P,tab:"settings"}),children:[e(ae,{id:"settings","data-testid":"authorizationSettings",title:e(ie,{children:n("settings")}),...pt,children:e(ds,{clientId:P})}),e(ae,{id:"resources","data-testid":"authorizationResources",title:e(ie,{children:n("resources")}),...xe,children:e(rs,{clientId:P,isDisabled:!r})}),e(ae,{id:"scopes","data-testid":"authorizationScopes",title:e(ie,{children:n("scopes")}),...ht,children:e(os,{clientId:P,isDisabled:!r})}),e(ae,{id:"policies","data-testid":"authorizationPolicies",title:e(ie,{children:n("policies")}),...mt,children:e(is,{clientId:P,isDisabled:!r})}),e(ae,{id:"permissions","data-testid":"authorizationPermissions",title:e(ie,{children:n("permissions")}),...Ze,children:e(ns,{clientId:P,isDisabled:!r})}),f&&e(ae,{id:"evaluate","data-testid":"authorizationEvaluate",title:e(ie,{children:n("evaluate")}),...he,children:e(Qi,{client:T,save:Fe})}),i("manage-authorization")&&e(ae,{id:"export","data-testid":"authorizationExport",title:e(ie,{children:n("export")}),...Ke,children:e(Xi,{})})]})}),T.serviceAccountsEnabled&&f&&e(ae,{id:"serviceAccount","data-testid":"serviceAccountTab",title:e(ie,{children:n("serviceAccount")}),...O,children:e(Os,{client:T})}),e(ae,{id:"sessions","data-testid":"sessionsTab",title:e(ie,{children:n("sessions")}),...K,children:e(Hi,{client:T})}),g&&(c||T.access?.manage)&&e(ae,{id:"permissions","data-testid":"permissionsTab",title:e(ie,{children:n("permissions")}),...se,children:e(Ua,{id:T.id,type:"clients"})}),e(ae,{id:"advanced","data-testid":"advancedTab",title:e(ie,{children:n("advanced")}),...ve,children:e(Ki,{save:Fe,client:T})})]})})})]}):e(Le,{})}export{Ul as default};
//# sourceMappingURL=ClientDetails-B7mrRo1P.js.map
