{"version":3,"file":"AddSamlConnect-DA0KmHW2.js","sources":["../../src/identity-providers/add/SamlConnectSettings.tsx","../../src/identity-providers/add/AddSamlConnect.tsx"],"sourcesContent":["import { fetchWithError } from \"@keycloak/keycloak-admin-client\";\nimport type IdentityProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/identityProviderRepresentation\";\nimport { FormGroup, Title } from \"@patternfly/react-core\";\nimport { useFormContext } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { HelpItem } from \"ui-shared\";\n\nimport { adminClient } from \"../../admin-client\";\nimport { FileUploadForm } from \"../../components/json-file-upload/FileUploadForm\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport environment from \"../../environment\";\nimport { addTrailingSlash } from \"../../util\";\nimport { getAuthorizationHeaders } from \"../../utils/getAuthorizationHeaders\";\nimport { DiscoveryEndpointField } from \"../component/DiscoveryEndpointField\";\nimport { DescriptorSettings } from \"./DescriptorSettings\";\n\ntype FormFields = IdentityProviderRepresentation & {\n  discoveryError: string;\n};\n\nexport const SamlConnectSettings = () => {\n  const { t } = useTranslation();\n  const id = \"saml\";\n\n  const { realm } = useRealm();\n  const {\n    setValue,\n    register,\n    setError,\n    clearErrors,\n    formState: { errors },\n  } = useFormContext<FormFields>();\n\n  const setupForm = (result: IdentityProviderRepresentation) => {\n    Object.entries(result).map(([key, value]) =>\n      setValue(`config.${key}`, value),\n    );\n  };\n\n  const fileUpload = async (xml: string) => {\n    clearErrors(\"discoveryError\");\n    if (!xml) {\n      return;\n    }\n    const formData = new FormData();\n    formData.append(\"providerId\", id);\n    formData.append(\"file\", new Blob([xml]));\n\n    try {\n      const response = await fetchWithError(\n        `${addTrailingSlash(\n          adminClient.baseUrl,\n        )}admin/realms/${realm}/identity-provider/import-config`,\n        {\n          method: \"POST\",\n          body: formData,\n          headers: getAuthorizationHeaders(await adminClient.getAccessToken()),\n        },\n      );\n      if (response.ok) {\n        const result = await response.json();\n        setupForm(result);\n      } else {\n        setError(\"discoveryError\", {\n          type: \"manual\",\n          message: response.statusText,\n        });\n      }\n    } catch (error) {\n      setError(\"discoveryError\", {\n        type: \"manual\",\n        message: (error as Error).message,\n      });\n    }\n  };\n\n  return (\n    <>\n      <Title headingLevel=\"h2\" size=\"xl\" className=\"kc-form-panel__title\">\n        {t(\"samlSettings\")}\n      </Title>\n\n      <FormGroup\n        label={t(\"serviceProviderEntityId\")}\n        fieldId=\"kc-service-provider-entity-id\"\n        labelIcon={\n          <HelpItem\n            helpText={t(\"serviceProviderEntityIdHelp\")}\n            fieldLabelId=\"serviceProviderEntityId\"\n          />\n        }\n        isRequired\n        helperTextInvalid={t(\"required\")}\n        validated={errors.config?.entityId ? \"error\" : \"default\"}\n      >\n        <KeycloakTextInput\n          data-testid=\"serviceProviderEntityId\"\n          id=\"kc-service-provider-entity-id\"\n          validated={errors.config?.entityId ? \"error\" : \"default\"}\n          defaultValue={`${environment.authServerUrl}/realms/${realm}`}\n          {...register(\"config.entityId\", { required: true })}\n        />\n      </FormGroup>\n\n      <DiscoveryEndpointField\n        id=\"saml\"\n        fileUpload={\n          <FormGroup\n            label={t(\"importConfig\")}\n            fieldId=\"kc-import-config\"\n            labelIcon={\n              <HelpItem\n                helpText={t(\"importConfigHelp\")}\n                fieldLabelId=\"importConfig\"\n              />\n            }\n            validated={errors.discoveryError ? \"error\" : \"default\"}\n            helperTextInvalid={errors.discoveryError?.message}\n          >\n            <FileUploadForm\n              id=\"kc-import-config\"\n              extension=\".xml\"\n              hideDefaultPreview\n              unWrap\n              validated={errors.discoveryError ? \"error\" : \"default\"}\n              onChange={(value) => fileUpload(value)}\n            />\n          </FormGroup>\n        }\n      >\n        {(readonly) => <DescriptorSettings readOnly={readonly} />}\n      </DiscoveryEndpointField>\n    </>\n  );\n};\n","import type IdentityProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/identityProviderRepresentation\";\nimport {\n  ActionGroup,\n  AlertVariant,\n  Button,\n  PageSection,\n} from \"@patternfly/react-core\";\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate } from \"react-router-dom\";\n\nimport { adminClient } from \"../../admin-client\";\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { FormAccess } from \"../../components/form/FormAccess\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { toIdentityProvider } from \"../routes/IdentityProvider\";\nimport { toIdentityProviders } from \"../routes/IdentityProviders\";\nimport { SamlConnectSettings } from \"./SamlConnectSettings\";\nimport { SamlGeneralSettings } from \"./SamlGeneralSettings\";\n\ntype DiscoveryIdentityProvider = IdentityProviderRepresentation & {\n  discoveryEndpoint?: string;\n};\n\nexport default function AddSamlConnect() {\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const id = \"saml\";\n\n  const form = useForm<DiscoveryIdentityProvider>({\n    defaultValues: { alias: id, config: { allowCreate: \"true\" } },\n  });\n  const {\n    handleSubmit,\n    formState: { isDirty },\n  } = form;\n\n  const { addAlert, addError } = useAlerts();\n  const { realm } = useRealm();\n\n  const onSubmit = async (provider: DiscoveryIdentityProvider) => {\n    delete provider.discoveryEndpoint;\n    try {\n      await adminClient.identityProviders.create({\n        ...provider,\n        providerId: id,\n      });\n      addAlert(t(\"createIdentityProviderSuccess\"), AlertVariant.success);\n      navigate(\n        toIdentityProvider({\n          realm,\n          providerId: id,\n          alias: provider.alias!,\n          tab: \"settings\",\n        }),\n      );\n    } catch (error: any) {\n      addError(\"createIdentityProviderError\", error);\n    }\n  };\n\n  return (\n    <>\n      <ViewHeader titleKey={t(\"addSamlProvider\")} />\n      <PageSection variant=\"light\">\n        <FormProvider {...form}>\n          <FormAccess\n            role=\"manage-identity-providers\"\n            isHorizontal\n            onSubmit={handleSubmit(onSubmit)}\n          >\n            <SamlGeneralSettings />\n            <SamlConnectSettings />\n            <ActionGroup>\n              <Button\n                isDisabled={!isDirty}\n                variant=\"primary\"\n                type=\"submit\"\n                data-testid=\"createProvider\"\n              >\n                {t(\"add\")}\n              </Button>\n              <Button\n                variant=\"link\"\n                data-testid=\"cancel\"\n                component={(props) => (\n                  <Link {...props} to={toIdentityProviders({ realm })} />\n                )}\n              >\n                {t(\"cancel\")}\n              </Button>\n            </ActionGroup>\n          </FormAccess>\n        </FormProvider>\n      </PageSection>\n    </>\n  );\n}\n"],"names":["SamlConnectSettings","useTranslation","id","realm","useRealm","setValue","register","setError","clearErrors","errors","useFormContext","setupForm","result","key","value","fileUpload","xml","formData","response","fetchWithError","addTrailingSlash","adminClient","getAuthorizationHeaders","error","jsxs","Fragment","jsx","Title","FormGroup","HelpItem","KeycloakTextInput","environment","DiscoveryEndpointField","FileUploadForm","readonly","DescriptorSettings","AddSamlConnect","navigate","useNavigate","form","useForm","handleSubmit","isDirty","addAlert","addError","useAlerts","onSubmit","provider","AlertVariant","toIdentityProvider","ViewHeader","PageSection","FormProvider","FormAccess","SamlGeneralSettings","ActionGroup","Button","props","Link","toIdentityProviders"],"mappings":"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"}