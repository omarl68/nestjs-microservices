import{jsx as e,Fragment as w,jsxs as y}from"react/jsx-runtime";import*as A from"react";import{useState as O,useCallback as dt,useMemo as Ye}from"react";import{aD as G,_ as ut,bA as pt,aY as mt,k as se,bB as ht,aX as ft,bC as gt,m as Ct,bD as Tt,bE as De,bF as It,u as $,Z as L,q as ee,f as E,a0 as k,a1 as D,a3 as N,J as Z,I as me,S as te,R as de,b as vt,c as Je,B as ne,b2 as yt,h as q,a6 as St,a7 as bt,L as Xe,aV as Qe,b5 as xt,O as ve,bG as Ot,Q as ye,aA as Ne,D as Pe,p as Ze,r as et,bz as he,ac as Re,a2 as H,a9 as tt,aa as ie,ab as kt,g as Dt,e as Pt,U as $t,P as Rt,F as At,bi as we,A as Le,Y as Mt,G as Ve,H as Et}from"./index-C9t2UlUN.js";import{u as nt}from"./ConfirmDialog-BDkqxnFL.js";import{F as Nt}from"./FormAccess-DnQCcStE.js";import{V as wt}from"./ViewHeader-cxZm8XhN.js";import{u as it}from"./useParams-DL8-63Ov.js";import{M as at,a as rt}from"./Modal-Bgkd26UL.js";import{a1 as Lt,a3 as fe,a4 as ge,a5 as Y,a6 as K,a7 as Ce,a8 as B}from"./KeycloakDataTable-2rLFZPhG.js";import{u as ue}from"./useToggle-K3Kx99tM.js";import{h as Vt}from"./ClientScopeTypes-43MQv2_N.js";import{L as Ft}from"./PaginatingTableToolbar-oQUfBy2J.js";import{g as _t}from"./utils-DeGqqWSp.js";import{F as Fe}from"./filter-icon-C8nM2k1N.js";import{G as Ht}from"./GroupPickerDialog-tI6XV7Ln.js";import{K as pe}from"./KeycloakTextInput-DrlF32nr.js";import{C as qt,L as Ut}from"./CodeEditor-Cp4g17EF.js";import{K as Gt}from"./KeycloakTextArea-DChmurIP.js";import{A as Kt,S as Bt}from"./AddRoleMappingModal-BWNuJU0W.js";import{d as le,D as jt}from"./DatePicker-D83L1Ym_.js";import{m as Se,M as zt,a as Wt,b as Yt,c as Jt}from"./MenuList-Br-Zu33q.js";import{F as Xt,a as _e}from"./FlexItem-BEayPdRt.js";import{A as Qt}from"./Form-Cdw1qhWG.js";const z=" AM",W=" PM",Zt=(t,i,r,s,d,u)=>{const c=[],p=new Date(new Date().setHours(0,0,0,0)),f=p.getDay();for(;p.getDay()===f;){let m=p.getHours(),n=z;i&&(m===0?m=12:m>=12&&(n=W),m>12&&(m%=12)),m=i?m.toString():m.toString().padStart(2,"0");const o=p.getMinutes().toString().padStart(2,"0"),a=`${m}${r}${o}${i?n:""}`;st(s,d,a,r,u)&&c.push(a),p.setMinutes(p.getMinutes()+t)}return c},j=(t,i,r,s,d)=>{const u=new Date(t);if(!isNaN(u.getDate())&&(t instanceof Date||t.includes("T"))){const c=s?`${u.getHours()>12?u.getHours()-12:u.getHours()}`:`${u.getHours()}`.padStart(2,"0"),p=`${u.getMinutes()}`.padStart(2,"0"),f=d?`${u.getSeconds()}`.padStart(2,"0"):"",m=f?`${r}${f}`:"";let n="";return s&&u.getHours()>11?n=W:s&&(n=z),`${c}${r}${p}${m}${n}`}else if(typeof t=="string"&&(t=t.trim(),t!==""&&ot(t,i,r,s))){const[,c,p,f,m=""]=i.exec(t),n=d?`${r}${f??"00"}`:"";let o="";if(s){const a=m.toUpperCase();a===z.toUpperCase().trim()?o=z:a===W.toUpperCase().trim()?o=W:o=new Date().getHours()>11?W:z}return`${c}${r}${p}${n}${o}`}return t.toString()},ot=(t,i,r,s)=>{const d=new Date(t);if(!isNaN(d.getDate())&&t.includes("T"))return!0;const u=parseInt(t.split(r)[0]),c=u>=(s?1:0)&&u<=(s?12:23);return t===""||i.test(t)&&c},He=(t,i)=>{const r=t.match(i);return r&&r.length?/pm/i.test(r[4])?parseInt(r[1])===12?parseInt(r[1]):parseInt(r[1])+12:/am/i.test(r[4])&&parseInt(r[1])===12?0:parseInt(r[1]):null},qe=(t,i)=>{const r=t.match(i);return r&&r.length?parseInt(r[2]):null},Ue=(t,i)=>{var r;const s=(r=t.match(i))===null||r===void 0?void 0:r[3];return s?parseInt(s):null},st=(t,i,r,s,d)=>{if(r.trim()==="")return!0;const u=be(t,s,d),c=be(r,s,d),p=be(i,s,d);return u<=c&&c<=p},be=(t,i,r)=>{const d=new RegExp(`^\\s*(\\d\\d?)${i}([0-5]\\d)${i}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(t);if(!d||!d.length)return;let u=d[1].padStart(2,"0");const c=d[2];let p=d[3]?`${i}${d[3]}`:"";!p&&r&&(p=`${i}00`);const f=d[4]||"";return f.toUpperCase()==="PM"&&u!=="12"?u=`${parseInt(u)+12}`:f.toUpperCase()==="AM"&&u==="12"&&(u="00"),`${u}${i}${c}${p}`};class Ae extends A.Component{constructor(i){super(i),this.baseComponentRef=A.createRef(),this.toggleRef=A.createRef(),this.inputRef=A.createRef(),this.menuRef=A.createRef(),this.onDocClick=n=>{var o,a,l,h;const C=(a=(o=this.toggleRef)===null||o===void 0?void 0:o.current)===null||a===void 0?void 0:a.contains(n.target),S=(h=(l=this.menuRef)===null||l===void 0?void 0:l.current)===null||h===void 0?void 0:h.contains(n.target);this.state.isTimeOptionsOpen&&!(C||S)&&this.onToggle(!1)},this.handleGlobalKeys=n=>{var o,a,l,h;const{isTimeOptionsOpen:C,focusedIndex:S,scrollIndex:x}=this.state;!((a=(o=this.inputRef)===null||o===void 0?void 0:o.current)===null||a===void 0)&&a.contains(n.target)?!C&&n.key!==G.Tab&&n.key!==G.Escape?this.onToggle(!0):C&&(n.key===G.Escape||n.key===G.Tab?this.onToggle(!1):n.key===G.Enter?S!==null?(this.focusSelection(S),n.stopPropagation()):this.onToggle(!1):(n.key===G.ArrowDown||n.key===G.ArrowUp)&&(this.focusSelection(x),this.updateFocusedIndex(0),n.preventDefault())):!((h=(l=this.menuRef)===null||l===void 0?void 0:l.current)===null||h===void 0)&&h.contains(n.target)&&(n.key===G.ArrowDown?(this.updateFocusedIndex(1),n.preventDefault()):n.key===G.ArrowUp?(this.updateFocusedIndex(-1),n.preventDefault()):(n.key===G.Escape||n.key===G.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=n=>{this.setState(o=>{const a=this.getOptions().length-1;let l=o.focusedIndex!==null?o.focusedIndex+n:o.scrollIndex+n;return l<0?l=a:l>a&&(l=0),this.scrollToIndex(l),{focusedIndex:l}})},this.getIndexToScroll=n=>this.props.menuAppendTo==="inline"?n>0?n-1:0:n,this.scrollToIndex=n=>{this.getOptions()[n].closest(`.${Se.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(n)].offsetTop},this.focusSelection=n=>{var o;const a=n!==-1?n:0;!((o=this.menuRef)===null||o===void 0)&&o.current&&this.getOptions()[a].querySelector(`.${Se.menuItem}`).focus()},this.scrollToSelection=n=>{const{delimiter:o,is24Hour:a}=this.props;let l=n.split(this.props.delimiter),h=null;if(l.length<2?(n=`${n}${o}00`,l=n.split(o)):l.length>2&&(n=j(n,this.state.timeRegex,o,!a,!1),l=n.split(o)),!a&&l.length>1&&l[1].length<2){const S=l[1].length===0?"00":l[1]+"0";n=`${l[0]}${o}${S}${new Date().getHours()>11?W:z}`}else!a&&l.length>1&&l[1].length===2&&!n.toUpperCase().includes(z.toUpperCase().trim())&&!n.toUpperCase().includes(W.toUpperCase().trim())&&(n=`${n}${new Date().getHours()>11?W:z}`);let C=this.getOptions().findIndex(S=>S.textContent===n);if(C!==-1)this.scrollToIndex(C),h=C;else if(l.length===2){let S="";a||(l[1].toUpperCase().includes("P")?S=W:l[1].toUpperCase().includes("A")&&(S=z)),n=`${l[0]}${o}00${S}`,C=this.getOptions().findIndex(x=>x.textContent===n),C!==-1&&this.scrollToIndex(C)}this.setState({focusedIndex:h,scrollIndex:C})},this.getRegExp=(n=!0)=>{const{is24Hour:o,delimiter:a}=this.props;let l=`\\s*(\\d\\d?)${a}([0-5]\\d)`;return n&&(l+=`${a}?([0-5]\\d)?`),new RegExp(`^${l}${o?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var n;return!((n=this.menuRef)===null||n===void 0)&&n.current?Array.from(this.menuRef.current.querySelectorAll(`.${Se.menuListItem}`)):[]},this.isValidFormat=n=>{if(this.props.validateTime)return this.props.validateTime(n);const{delimiter:o,is24Hour:a,includeSeconds:l}=this.props;return ot(n,this.getRegExp(l),o,!a)},this.isValidTime=n=>{const{delimiter:o,includeSeconds:a}=this.props,{minTimeState:l,maxTimeState:h}=this.state;return st(l,h,n,o,a)},this.isValid=n=>this.isValidFormat(n)&&this.isValidTime(n),this.onToggle=n=>{this.setState(o=>{const{timeRegex:a,isInvalid:l,timeState:h}=o,{delimiter:C,is24Hour:S,includeSeconds:x,onChange:M}=this.props,g=j(h,a,C,!S,x);return M&&!n&&g!==h&&M(null,g,He(g,a),qe(g,a),Ue(g,a),this.isValid(g)),{isTimeOptionsOpen:n,timeState:g,isInvalid:n?l:!this.isValid(g)}}),this.props.setIsOpen(n),n||this.inputRef.current.focus()},this.onSelect=n=>{const{timeRegex:o,timeState:a}=this.state,{delimiter:l,is24Hour:h,includeSeconds:C,setIsOpen:S}=this.props,x=j(n.target.textContent,o,l,!h,C);x!==a&&this.onInputChange(x,n),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),S(!1)},this.onInputClick=n=>{this.state.isTimeOptionsOpen||this.onToggle(!0),n.stopPropagation()},this.onInputChange=(n,o)=>{const{onChange:a}=this.props,{timeRegex:l}=this.state;a&&a(o,n,He(n,l),qe(n,l),Ue(n,l),this.isValid(n)),this.scrollToSelection(n),this.setState({timeState:n})};const{is24Hour:r,delimiter:s,time:d,includeSeconds:u,isOpen:c}=this.props;let{minTime:p,maxTime:f}=this.props;if(p===""){const n=u?`${s}00`:"";p=r?`00${s}00${n}`:`12${s}00${n} AM`}if(f===""){const n=u?`${s}59`:"";f=r?`23${s}59${n}`:`11${s}59${n} PM`}const m=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:c,timeState:j(d,m,s,!r,u),focusedIndex:null,scrollIndex:0,timeRegex:m,minTimeState:j(p,m,s,!r,u),maxTimeState:j(f,m,s,!r,u)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(i,r){const{timeState:s,isTimeOptionsOpen:d,isInvalid:u,timeRegex:c}=this.state,{time:p,is24Hour:f,delimiter:m,includeSeconds:n,isOpen:o,minTime:a,maxTime:l}=this.props;if(i.isOpen!==o&&this.onToggle(o),d&&!r.isTimeOptionsOpen&&s&&!u&&this.scrollToSelection(s),m!==i.delimiter&&this.setState({timeRegex:this.getRegExp()}),p!==""&&p!==i.time){const h=j(p,c,m,!f,n);this.setState({timeState:h,isInvalid:!this.isValid(h)})}a!==""&&a!==i.minTime&&this.setState({minTimeState:j(a,c,m,!f,n)}),l!==""&&l!==i.maxTime&&this.setState({maxTimeState:j(l,c,m,!f,n)})}render(){const i=this.props,{"aria-label":r,isDisabled:s,className:d,placeholder:u,id:c,menuAppendTo:p,is24Hour:f,invalidFormatErrorMessage:m,invalidMinMaxErrorMessage:n,stepMinutes:o,width:a,delimiter:l,inputProps:h,onChange:C,setIsOpen:S,isOpen:x,time:M,validateTime:g,minTime:I,maxTime:V,includeSeconds:b,removeFindDomNode:R,zIndex:v}=i,_=ut(i,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","removeFindDomNode","zIndex"]),{timeState:J,isTimeOptionsOpen:Te,isInvalid:ae,minTimeState:re,maxTimeState:Ie}=this.state,T={"--pf-c-date-picker__input--c-form-control--Width":a},X=Zt(o,!f,l,re,Ie,b),P=this.isValidFormat(J),F=c||pt("time-picker"),U=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,Q=A.createElement(zt,{ref:this.menuRef,isScrollable:!0},A.createElement(Wt,{maxMenuHeight:"200px"},A.createElement(Yt,{"aria-label":r},X.map((Ee,ct)=>A.createElement(Jt,{onClick:this.onSelect,key:Ee,id:`${F}-option-${ct}`},Ee))))),lt=A.createElement(mt,Object.assign({"aria-haspopup":"menu",className:se(ht.formControl),id:`${F}-input`,"aria-label":r,validated:ae?"error":"default",placeholder:u,value:J||"",type:"text",iconVariant:"clock",onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:s,ref:this.inputRef},h));let oe;switch(p){case"inline":oe=()=>this.toggleRef.current;break;case"parent":oe=U;break;default:oe=p}return A.createElement("div",{ref:this.baseComponentRef,className:se(le.datePicker,d)},A.createElement("div",Object.assign({className:se(le.datePickerInput),style:T},_),A.createElement(ft,null,A.createElement("div",{id:F},A.createElement("div",{ref:this.toggleRef,style:{paddingLeft:"0"}},A.createElement(gt,{appendTo:oe,trigger:lt,popper:Q,isVisible:Te,removeFindDomNode:R,zIndex:v})))),ae&&A.createElement("div",{className:se(le.datePickerHelperText,le.modifiers.error)},P?n:m)))}}Ae.displayName="TimePicker";Ae.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},removeFindDomNode:!1,zIndex:9999};const en={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},tn=Ct(en);var nn=/\s/;function an(t){for(var i=t.length;i--&&nn.test(t.charAt(i)););return i}var rn=/^\s+/;function on(t){return t&&t.slice(0,an(t)+1).replace(rn,"")}var Ge=NaN,sn=/^[-+]0x[0-9a-f]+$/i,ln=/^0b[01]+$/i,cn=/^0o[0-7]+$/i,dn=parseInt;function Ke(t){if(typeof t=="number")return t;if(Tt(t))return Ge;if(De(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=De(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=on(t);var r=ln.test(t);return r||cn.test(t)?dn(t.slice(2),r?2:8):sn.test(t)?Ge:+t}var xe=function(){return It.Date.now()},un="Expected a function",pn=Math.max,mn=Math.min;function hn(t,i,r){var s,d,u,c,p,f,m=0,n=!1,o=!1,a=!0;if(typeof t!="function")throw new TypeError(un);i=Ke(i)||0,De(r)&&(n=!!r.leading,o="maxWait"in r,u=o?pn(Ke(r.maxWait)||0,i):u,a="trailing"in r?!!r.trailing:a);function l(b){var R=s,v=d;return s=d=void 0,m=b,c=t.apply(v,R),c}function h(b){return m=b,p=setTimeout(x,i),n?l(b):c}function C(b){var R=b-f,v=b-m,_=i-R;return o?mn(_,u-v):_}function S(b){var R=b-f,v=b-m;return f===void 0||R>=i||R<0||o&&v>=u}function x(){var b=xe();if(S(b))return M(b);p=setTimeout(x,C(b))}function M(b){return p=void 0,a&&s?l(b):(s=d=void 0,c)}function g(){p!==void 0&&clearTimeout(p),m=0,s=f=d=p=void 0}function I(){return p===void 0?c:M(xe())}function V(){var b=xe(),R=S(b);if(s=arguments,d=this,f=b,R){if(p===void 0)return h(f);if(o)return clearTimeout(p),p=setTimeout(x,i),l(f)}return p===void 0&&(p=setTimeout(x,i)),c}return V.cancel=g,V.flush=I,V}const fn=({name:t,label:i,helpText:r,defaultValue:s,isRequired:d,variant:u=Z.typeaheadMulti})=>{const{t:c}=$(),{control:p,getValues:f,formState:{errors:m}}=L(),n=f(t),[o,a]=ue(),[l,h]=O([]),[C,S]=O(""),x=dt(hn(S,1e3),[]);ee(()=>{const g={max:20};return C&&(g.username=C),n?.length&&!C?Promise.all(n.map(I=>E.users.findOne({id:I}))):E.users.find(g)},h,[C]);const M=g=>g.filter(I=>I!==void 0).map(I=>e(te,{value:I.id,selected:n?.includes(I.id),children:I.username},I.id));return e(k,{label:c(i),isRequired:d,labelIcon:e(D,{helpText:r,fieldLabelId:i}),fieldId:t,validated:m[t]?"error":"default",helperTextInvalid:c("required"),children:e(N,{name:t,defaultValue:s,control:p,rules:d&&u===Z.typeaheadMulti?{validate:g=>g.length>0}:{required:d},render:({field:g})=>e(me,{toggleId:t,variant:u,placeholderText:c("selectAUser"),onToggle:a,isOpen:o,selections:g.value,onFilter:(I,V)=>(x(V),M(l)),onSelect:(I,V)=>{const b=V.toString();if(u!==Z.typeaheadMulti)g.value.includes(b)?g.onChange([]):g.onChange([b]);else{const R=g.value.find(v=>v===b)?g.value.filter(v=>v!==b):[...g.value,b];g.onChange(R)}a()},"aria-label":c(t),children:M(l)})})})},Oe=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],gn=({helpLabel:t,isDisabled:i=!1,isLimited:r=!1})=>{const{t:s}=$(),{control:d}=L();return e(k,{label:s("decisionStrategy"),labelIcon:e(D,{helpText:s(`${t||"decisionStrategyHelp"}`),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(N,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:Oe[0],control:d,render:({field:u})=>e(w,{children:(r?Oe.slice(0,2):Oe).map(c=>e(de,{id:c,"data-testid":c,isChecked:u.value===c,isDisabled:i,name:"decisionStrategy",onChange:()=>u.onChange(c),label:s(`decisionStrategies.${c}`),className:"pf-u-mb-md"},c))})})})},Cn={resources:{searchFunction:"listResources",fetchFunction:"getAssociatedResources"},policies:{searchFunction:"listPolicies",fetchFunction:"getAssociatedPolicies"}},Tn=({name:t,clientId:i,permissionId:r,variant:s=Z.typeaheadMulti,preSelected:d,isRequired:u=!1})=>{const{realm:c}=vt(),{t:p}=$(),f=Je(),{control:m,formState:{errors:n,isDirty:o}}=L(),[a,l]=O([]),[h,C]=O(""),[S,x]=O(!1),[M,g]=ue(),[I,V]=O(),[b,R]=O(),v=Cn[t],_=T=>({id:"_id"in T?T._id:"id"in T?T.id:void 0,name:T.name,type:T.type});ee(async()=>{const T=Object.assign({id:i,first:0,max:10,permission:"false"},h===""?null:{name:h});return await Promise.all([E.clients.listPolicyProviders({id:i}),E.clients[v.searchFunction](T),r?E.clients[v.fetchFunction]({id:i,permissionId:r}):Promise.resolve([])])},([T,...X])=>{V(T.filter(P=>P.type!=="resource"&&P.type!=="scope")),l(X.flat().filter(P=>typeof P!="string").map(_).filter(({id:P},F,U)=>F===U.findIndex(({id:Q})=>P===Q)))},[h]);const[J,Te]=nt({titleKey:p("unsavedChangesTitle"),messageKey:p("unsavedChangesConfirm"),continueButtonLabel:p("continue"),continueButtonVariant:ne.danger,onConfirm:()=>b?.()}),ae=T=>t==="policies"?Qe({realm:c,id:i,policyId:T.id,policyType:T.type}):xt({realm:c,id:i,resourceId:T.id}),re=()=>a.map(T=>e(te,{value:T.id,children:T.name},T.id)),Ie=T=>e(St,{children:T.value?.map(X=>{const P=a.find(U=>U.id===X);if(!P)return;const F=ae(P);return e(bt,{onClick:()=>{T.onChange(T.value?.filter(U=>U!==P.id))},children:e(Xe,{to:F,onClick:U=>{o&&(U.preventDefault(),R(()=>()=>f(F)),J())},children:P.name})},P.id)})});return y(w,{children:[e(Te,{}),M&&e(Mn,{policyProviders:I,onSelect:T=>{f(yt({id:i,realm:c,policyType:T.type}))},toggleDialog:g}),e(N,{name:t,defaultValue:d?[d]:[],control:m,rules:{validate:T=>!u||T.length>0},render:({field:T})=>e(me,{toggleId:t,variant:s,onToggle:x,onFilter:(X,P)=>(C(P),re()),onClear:()=>{T.onChange([]),C("")},selections:T.value,onSelect:(X,P)=>{const F=P.toString();if(s===Z.typeaheadMulti){const U=T.value?.find(Q=>Q===F)?T.value.filter(Q=>Q!==F):[...T.value,F];T.onChange(U)}else T.onChange([F]);C("")},isOpen:S,"aria-label":p(t),isDisabled:!!d,validated:n[t]?"error":"default",typeAheadAriaLabel:p(t),chipGroupComponent:Ie(T),footer:t==="policies"?e(q,{variant:"link",isInline:!0,onClick:()=>{o?(x(!1),R(()=>g),J()):g()},children:p("createPolicy")}):void 0,children:re()})})]})},In=()=>{const{t}=$(),{id:i}=it();return y(w,{children:[e(k,{label:t("applyPolicy"),fieldId:"policies",labelIcon:e(D,{helpText:t("applyPolicyHelp"),fieldLabelId:"policies"}),children:e(Tn,{name:"policies",clientId:i})}),e(gn,{helpLabel:"policyDecisionStagey"})]})},vn=()=>{const{t}=$(),{control:i,getValues:r,formState:{errors:s}}=L(),d=r("clients"),[u,c]=O(!1),[p,f]=O([]),[m,n]=O("");ee(async()=>{const a={max:20};return m&&(a.clientId=m,a.search=!0),d?.length&&!m?await Promise.all(d.map(l=>E.clients.findOne({id:l}))):await E.clients.find(a)},f,[m]);const o=a=>a.map(l=>e(te,{value:l.id,selected:d?.includes(l.id),children:l.clientId},l.id));return e(k,{label:t("clients"),labelIcon:e(D,{helpText:t("policyClientHelp"),fieldLabelId:"client"}),fieldId:"clients",helperTextInvalid:t("requiredClient"),validated:s.clients?"error":"default",isRequired:!0,children:e(N,{name:"clients",defaultValue:[],control:i,rules:{validate:a=>a.length>0},render:({field:a})=>e(me,{toggleId:"clients",variant:Z.typeaheadMulti,typeAheadAriaLabel:t("clients"),onToggle:l=>c(l),isOpen:u,selections:a.value,"aria-label":t("selectClients"),onFilter:(l,h)=>(n(h),o(p)),onSelect:(l,h)=>{const C=h.toString();a.value.includes(C)?a.onChange(a.value.filter(S=>S!==C)):a.onChange([...a.value,C]),c(!1)},children:o(p)})})})},yn=({clientScopes:t,clientName:i,open:r,toggleDialog:s,onAdd:d,isClientScopesConditionType:u})=>{const{t:c}=$(),[p,f]=O(!1),[m,n]=O([]),[o,a]=O("Name"),[l,h]=O("All"),[C,S]=ue(),[x,M]=ue(!1),g=Ye(()=>l==="OpenID Connect"?t.filter(v=>v.protocol==="openid-connect"):l==="SAML"?t.filter(v=>v.protocol==="saml"):t,[t,o,l]),I=v=>{const _=m.map(J=>({scope:J,type:v}));d(_),f(!1),s()},V=v=>{v==="Name"?a("Protocol"):v==="Protocol"&&(a("Name"),h("All")),S()},b=v=>{v==="SAML"?h("SAML"):v==="OpenID Connect"?h("OpenID Connect"):v==="All"&&h("All"),M()},R=[e(te,{value:"SAML",children:c("protocolTypes.saml")},1),e(te,{value:"OpenID Connect",children:c("protocolTypes.openid-connect")},2),e(te,{value:"All",isPlaceholder:!0,children:c("protocolTypes.all")},3)];return e(at,{variant:rt.medium,title:u?c("addClientScope"):c("addClientScopesTo",{clientName:i}),isOpen:r,onClose:s,actions:u?[e(q,{id:"modal-add","data-testid":"confirm",variant:ne.primary,onClick:()=>{const v=m.map(_=>({scope:_}));d(v),s()},isDisabled:m.length===0,children:c("add")},"add"),e(q,{id:"modal-cancel","data-testid":"cancel",variant:ne.link,onClick:()=>{n([]),s()},children:c("cancel")},"cancel")]:[e(ve,{className:"keycloak__client-scopes-add__add-dropdown",id:"add-dropdown",direction:Ot.up,isOpen:p,toggle:e(ye,{isDisabled:m.length===0,onToggle:()=>f(!p),isPrimary:!0,toggleIndicator:tn,id:"add-scope-toggle",children:c("add")}),dropdownItems:Vt(c,I)},"add-dropdown"),e(q,{id:"modal-cancel",variant:ne.link,onClick:()=>{n([]),s()},children:c("cancel")},"cancel")],children:e(Lt,{loader:g,ariaLabelKey:"chooseAMapperType",searchPlaceholderKey:o==="Name"?"searchForClientScope":void 0,isSearching:o!=="Name",searchTypeComponent:e(ve,{onSelect:()=>{V(o)},"data-testid":"filter-type-dropdown",toggle:e(ye,{id:"toggle-id-9",onToggle:S,toggleIndicator:Ne,icon:e(Fe,{}),children:o}),isOpen:C,dropdownItems:[e(Pe,{"data-testid":"filter-type-dropdown-item",children:c(o==="Name"?"protocol":"name")},"filter-type")]}),toolbarItem:o==="Protocol"&&y(w,{children:[e(ve,{onSelect:()=>{V(o)},"data-testid":"filter-type-dropdown",toggle:e(ye,{id:"toggle-id-9",onToggle:S,toggleIndicator:Ne,icon:e(Fe,{}),children:o}),isOpen:C,dropdownItems:[e(Pe,{"data-testid":"filter-type-dropdown-item",children:c("name")},"filter-type")]}),e(me,{variant:Z.single,className:"kc-protocolType-select","aria-label":c("selectOne"),onToggle:M,onSelect:(v,_)=>b(_.toString()),selections:l,isOpen:x,children:R})]}),canSelectAll:!0,onSelect:v=>n(v),columns:[{name:"name"},{name:"protocol",displayKey:"protocol",cellRenderer:v=>_t(c,v.protocol??"openid-connect")},{name:"description"}],emptyState:e(Ft,{message:c("emptyAddClientScopes"),instructions:c("emptyAddClientScopesInstructions")})})})},Sn=()=>{const{t}=$(),{control:i,getValues:r,setValue:s,formState:{errors:d}}=L(),[u,c]=O(!1),[p,f]=O([]),[m,n]=O([]),o=Ze();return ee(()=>E.clientScopes.find(),a=>{n(r("clientScopes").map(l=>a.find(h=>h.id===l.id))),f(o(a,et("name")))},[]),y(k,{label:t("clientScopes"),labelIcon:e(D,{helpText:t("clientsClientScopesHelp"),fieldLabelId:"clientScopes"}),fieldId:"clientScopes",helperTextInvalid:t("requiredClientScope"),validated:d.clientScopes?"error":"default",isRequired:!0,children:[e(N,{name:"clientScopes",control:i,defaultValue:[],rules:{validate:a=>a.filter(l=>l.id).length>0},render:({field:a})=>y(w,{children:[u&&e(yn,{clientScopes:p.filter(l=>!a.value.map(h=>h.id).includes(l.id)),isClientScopesConditionType:!0,open:u,toggleDialog:()=>c(!u),onAdd:l=>{n([...m,...l.map(h=>h.scope)]),a.onChange([...a.value,...l.map(h=>h.scope).map(h=>({id:h.id,required:!1}))])}}),e(q,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{c(!0)},children:t("addClientScopes")})]})}),m.length>0&&y(fe,{variant:"compact",children:[e(ge,{children:y(Y,{children:[e(K,{children:t("clientScopeTitle")}),e(K,{children:t("required")}),e(K,{"aria-hidden":"true"})]})}),e(Ce,{children:m.map((a,l)=>y(Y,{children:[e(B,{children:a.name}),e(B,{children:e(N,{name:`clientScopes.${l}.required`,defaultValue:!1,control:i,render:({field:h})=>e(he,{id:"required","data-testid":"standard",name:"required",isChecked:h.value,onChange:h.onChange})})}),e(B,{children:e(q,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Re,{}),onClick:()=>{s("clientScopes",[...r("clientScopes").filter(h=>h.id!==a.id)]),n([...m.filter(h=>h.id!==a.id)])}})})]},a.id))})]})]})},bn=()=>{const{t}=$(),{control:i,register:r,getValues:s,setValue:d,formState:{errors:u}}=L(),c=s("groups"),[p,f]=O(!1),[m,n]=O([]);return ee(()=>c&&c.length>0?Promise.all(c.map(o=>E.groups.findOne({id:o.id}))):Promise.resolve([]),o=>{const a=o.filter(l=>l);n(a)},[]),y(w,{children:[e(k,{label:t("groupsClaim"),labelIcon:e(D,{helpText:t("groupsClaimHelp"),fieldLabelId:"groupsClaim"}),fieldId:"groups",children:e(pe,{type:"text",id:"groupsClaim","data-testid":"groupsClaim",...r("groupsClaim")})}),y(k,{label:t("groups"),labelIcon:e(D,{helpText:t("policyGroupsHelp"),fieldLabelId:"groups"}),fieldId:"groups",helperTextInvalid:t("requiredGroups"),validated:u.groups?"error":"default",isRequired:!0,children:[e(N,{name:"groups",control:i,defaultValue:[],rules:{validate:o=>o&&o.filter(({id:a})=>a).length>0},render:({field:o})=>y(w,{children:[p&&e(Ht,{type:"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:a=>{o.onChange([...o.value||[],...(a||[]).map(({id:l})=>({id:l}))]),n([...m,...a||[]]),f(!1)},onClose:()=>{f(!1)},filterGroups:m}),e(q,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{f(!0)},children:t("addGroups")})]})}),m.length>0&&y(fe,{variant:"compact",children:[e(ge,{children:y(Y,{children:[e(K,{children:t("groups")}),e(K,{children:t("extendToChildren")}),e(K,{"aria-hidden":"true"})]})}),e(Ce,{children:m.map((o,a)=>y(Y,{children:[e(B,{children:o.path}),e(B,{children:e(N,{name:`groups.${a}.extendChildren`,defaultValue:!1,control:i,render:({field:l})=>e(he,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:l.value,onChange:l.onChange,isDisabled:o.subGroupCount===0})})}),e(B,{children:e(q,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Re,{}),onClick:()=>{d("groups",[...(c||[]).filter(({id:l})=>l!==o.id)]),n([...m.filter(({id:l})=>l!==o.id)])}})})]},o.id))})]})]})]})},xn=()=>{const{t}=$(),{control:i}=L();return e(k,{label:t("code"),labelIcon:e(D,{helpText:t("policyCodeHelp"),fieldLabelId:"code"}),fieldId:"code",isRequired:!0,children:e(N,{name:"code",defaultValue:"",control:i,render:({field:r})=>e(qt,{id:"code","data-testid":"code",onChange:r.onChange,code:r.value,height:"600px",language:Ut.javascript,isReadOnly:!0})})})},Be=["POSITIVE","NEGATIVE"],On=({isDisabled:t})=>{const{t:i}=$(),{control:r}=L();return e(k,{label:i("logic"),labelIcon:e(D,{helpText:i("logicHelp"),fieldLabelId:"logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(N,{name:"logic","data-testid":"logic",defaultValue:Be[0],control:r,render:({field:s})=>e(w,{children:Be.map(d=>e(de,{id:d,"data-testid":d,isChecked:s.value===d,name:"logic",onChange:()=>s.onChange(d),label:i(`logicType.${d.toLowerCase()}`),className:"pf-u-mb-md",isDisabled:t},d))})})})},kn=({prefix:t,isDisabled:i})=>{const{t:r}=$(),{register:s,formState:{errors:d}}=L();return y(w,{children:[e(k,{label:r("name"),fieldId:"kc-name",helperTextInvalid:r("required"),validated:d.name?H.error:H.default,isRequired:!0,labelIcon:e(D,{helpText:r(`${t}-nameHelp`),fieldLabelId:"name"}),children:e(pe,{isDisabled:i,id:"kc-name","data-testid":"name",validated:d.name?H.error:H.default,...s("name",{required:!0})})}),e(k,{label:r("description"),fieldId:"kc-description",labelIcon:e(D,{helpText:r(`${t}-descriptionHelp`),fieldLabelId:"description"}),validated:d.description?H.error:H.default,helperTextInvalid:r("maxLength",{length:255}),children:e(Gt,{isDisabled:i,id:"kc-description","data-testid":"description",validated:d.description?H.error:H.default,...s("description",{maxLength:255})})})]})},Dn=()=>{const{t}=$(),{control:i,register:r,formState:{errors:s}}=L();return y(w,{children:[e(k,{label:t("targetClaim"),fieldId:"targetClaim",helperTextInvalid:t("required"),validated:s.targetClaim?"error":"default",isRequired:!0,labelIcon:e(D,{helpText:t("targetClaimHelp"),fieldLabelId:"targetClaim"}),children:e(pe,{id:"targetClaim","data-testid":"targetClaim",validated:s.targetClaim?"error":"default",...r("targetClaim",{required:!0})})}),e(k,{label:t("regexPattern"),fieldId:"pattern",labelIcon:e(D,{helpText:t("regexPatternHelp"),fieldLabelId:"regexPattern"}),isRequired:!0,validated:s.pattern?"error":"default",helperTextInvalid:t("required"),children:e(pe,{id:"pattern","data-testid":"regexPattern",validated:s.pattern?"error":"default",...r("pattern",{required:!0})})}),e(k,{label:t("targetContextAttributes"),fieldId:"targetContextAttributes",labelIcon:e(D,{helpText:t("targetContextAttributesHelp"),fieldLabelId:"targetContextAttributes"}),children:e(N,{name:"targetContextAttributes",defaultValue:!1,control:i,render:({field:d})=>e(he,{id:"targetContextAttributes",isChecked:d.value,onChange:d.onChange})})})]})},Pn=()=>{const{t}=$(),{control:i,getValues:r,setValue:s,formState:{errors:d}}=L(),u=r("roles"),[c,p]=O(!1),[f,m]=O([]);return ee(async()=>{if(u&&u.length>0){const n=await Promise.all(u.map(o=>E.roles.findOneById({id:o.id})));return Promise.all(n.map(async o=>({role:o,client:o.clientRole?await E.clients.findOne({id:o?.containerId}):void 0})))}return Promise.resolve([])},m,[]),y(k,{label:t("roles"),labelIcon:e(D,{helpText:t("policyRolesHelp"),fieldLabelId:"roles"}),fieldId:"roles",helperTextInvalid:t("requiredRoles"),validated:d.roles?"error":"default",isRequired:!0,children:[e(N,{name:"roles",control:i,defaultValue:[],rules:{validate:n=>n&&n.filter(o=>o.id).length>0},render:({field:n})=>y(w,{children:[c&&e(Kt,{id:"role",type:"roles",onAssign:o=>{n.onChange([...n.value||[],...o.map(a=>({id:a.role.id}))]),m([...f,...o]),p(!1)},onClose:()=>{p(!1)},isLDAPmapper:!0}),e(q,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{p(!0)},children:t("addRoles")})]})}),f.length>0&&y(fe,{variant:"compact",children:[e(ge,{children:y(Y,{children:[e(K,{children:t("roles")}),e(K,{children:t("required")}),e(K,{"aria-hidden":"true"})]})}),e(Ce,{children:f.map((n,o)=>y(Y,{children:[e(B,{children:e(Bt,{role:n.role,client:n.client})}),e(B,{children:e(N,{name:`roles.${o}.required`,defaultValue:!1,control:i,render:({field:a})=>e(he,{id:"required","data-testid":"standard",name:"required",isChecked:a.value,onChange:a.onChange})})}),e(B,{children:e(q,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Re,{}),onClick:()=>{s("roles",[...(u||[]).filter(a=>a.id!==n.role.id)]),m([...f.filter(a=>a.role.id!==n.role.id)])}})})]},n.role.id))})]})]})},ke=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,je=t=>t.toString().padStart(2,"0"),ze=({name:t})=>{const{control:i}=L(),r=(d,u)=>{if(!u)return d;const c=d.match(ke);return`${[u.getFullYear(),je(u.getMonth()+1),je(u.getDate())].join("-")} ${c?c[2]:"00"}:${c?c[3]:"00"}:00`},s=(d,u,c)=>{const p=d.match(ke);return c!=null?`${p?p[1]:""} ${u}:${c<10?`0${c}`:c}:00`:d};return e(N,{name:t,defaultValue:"",control:i,rules:{required:!0},render:({field:d})=>{const u=d.value.match(ke)||["","","0","00"];return y(tt,{hasGutter:!0,id:t,children:[e(ie,{children:e(jt,{value:u[1],onChange:(c,p,f)=>{d.onChange(r(d.value,f))}})}),e(ie,{children:e(Ae,{time:`${u[2]}:${u[3]}`,onChange:(c,p,f,m)=>d.onChange(s(d.value,f,m)),is24Hour:!0})})]})}})},We=({name:t,min:i,max:r})=>{const{control:s}=L(),d=u=>Math.min(u,r);return e(N,{name:t,defaultValue:"",control:s,render:({field:u})=>e(kt,{id:t,value:u.value,min:i,max:r,onPlus:()=>u.onChange(Number(u.value)+1),onMinus:()=>u.onChange(Number(u.value)-1),onChange:c=>{const p=Number(c.currentTarget.value);u.onChange(d(isNaN(p)?0:p))}})})},ce=({name:t,...i})=>{const{t:r}=$();return e(k,{label:r(t),fieldId:t,labelIcon:e(D,{helpText:r(`${t}Help`),fieldLabelId:t}),children:y(tt,{hasGutter:!0,children:[e(ie,{children:e(We,{name:t,...i})}),e(ie,{children:r("to")}),e(ie,{children:e(We,{name:`${t}End`,...i})})]})})},$n=()=>{const{t}=$(),{getValues:i,formState:{errors:r}}=L(),[s,d]=O(i("month"));return y(w,{children:[e(k,{label:t("repeat"),fieldId:"repeat",labelIcon:e(D,{helpText:t("repeatHelp"),fieldLabelId:"repeat"}),children:y(Xt,{children:[e(_e,{children:e(de,{id:"notRepeat","data-testid":"notRepeat",isChecked:!s,name:"repeat",onChange:()=>d(!1),label:t("notRepeat"),className:"pf-u-mb-md"})}),e(_e,{children:e(de,{id:"repeat","data-testid":"repeat",isChecked:s,name:"repeat",onChange:()=>d(!0),label:t("repeat"),className:"pf-u-mb-md"})})]})}),s&&y(w,{children:[e(ce,{name:"month",min:1,max:12}),e(ce,{name:"dayMonth",min:1,max:31}),e(ce,{name:"hour",min:0,max:23}),e(ce,{name:"minute",min:0,max:59})]}),e(k,{label:t("startTime"),fieldId:"notBefore",labelIcon:e(D,{helpText:t("startTimeHelp"),fieldLabelId:"startTime"}),isRequired:!0,helperTextInvalid:t("required"),validated:r.notBefore?H.error:H.default,children:e(ze,{name:"notBefore"})}),e(k,{label:t("expireTime"),fieldId:"notOnOrAfter",labelIcon:e(D,{helpText:t("expireTimeHelp"),fieldLabelId:"expireTime"}),isRequired:!0,helperTextInvalid:t("required"),validated:r.notOnOrAfter?H.error:H.default,children:e(ze,{name:"notOnOrAfter"})})]})},Rn=()=>{const{t}=$();return e(fn,{name:"users",label:"users",helpText:t("policyUsers"),defaultValue:[],isRequired:!0})},$e={aggregate:In,client:vn,user:Rn,"client-scope":Sn,group:bn,regex:Dn,role:Pn,time:$n,js:xn},Me=t=>t in $e;function An(){const{t}=$(),{id:i,realm:r,policyId:s,policyType:d}=it(),u=Je(),c=Dt(),{reset:p,handleSubmit:f}=c,{addAlert:m,addError:n}=Pt(),[o,a]=O(),l=d==="js";ee(async()=>{if(s){const g=await Promise.all([E.clients.findOnePolicy({id:i,type:d,policyId:s}),E.clients.getAssociatedPolicies({id:i,permissionId:s})]);if(!g[0])throw new Error(t("notFound"));return{policy:g[0],policies:g[1].map(I=>I.id)}}return{}},({policy:g,policies:I})=>{p({...g,policies:I}),a(g)},[i,d,s]);const h=async g=>{g.groups=g.groups?.filter(I=>I.id),g.clientScopes=g.clientScopes?.filter(I=>I.id),g.roles=g.roles?.filter(I=>I.id).map(I=>({...I,required:I.required||!1}));try{if(s)await E.clients.updatePolicy({id:i,type:d,policyId:s},g);else{const I=await E.clients.createPolicy({id:i,type:d},g);u(Qe({realm:r,id:i,policyType:d,policyId:I.id}))}m(t((s?"update":"create")+"PolicySuccess"),Le.success)}catch(I){n("policySaveError",I)}},[C,S]=nt({titleKey:"deletePolicy",messageKey:"deletePolicyConfirm",continueButtonLabel:"confirm",onConfirm:async()=>{try{await E.clients.delPolicy({id:i,policyId:s}),m(t("policyDeletedSuccess"),Le.success),u(we({realm:r,clientId:i,tab:"policies"}))}catch(g){n("policyDeletedError",g)}}});if(s&&!o)return e($t,{});function x(){return Me(d)?$e[d]:$e.js}const M=x();return y(w,{children:[e(S,{}),e(wt,{titleKey:s?o?.name:t("createPolicyOfType",{policyType:d}),dropdownItems:s?[e(Pe,{"data-testid":"delete-policy",onClick:()=>C(),children:t("delete")},"delete")]:void 0}),e(Rt,{variant:"light",children:y(Nt,{isHorizontal:!0,onSubmit:f(h),role:"anyone",children:[y(At,{...c,children:[e(kn,{isDisabled:l,prefix:"policy"}),e(M,{}),e(On,{isDisabled:l})]}),e(Qt,{children:y("div",{className:"pf-u-mt-md",children:[e(q,{isDisabled:l,variant:ne.primary,className:"pf-u-mr-md",type:"submit","data-testid":"save",children:t("save")}),e(q,{variant:"link","data-testid":"cancel",component:g=>e(Xe,{...g,to:we({realm:r,clientId:i,tab:"policies"})}),children:t("cancel")})]})})]})})]})}const ni=Object.freeze(Object.defineProperty({__proto__:null,default:An,isValidComponentType:Me},Symbol.toStringTag,{value:"Module"})),Mn=({policyProviders:t,onSelect:i,toggleDialog:r})=>{const{t:s}=$(),d=Ze(),u=Ye(()=>t?d(t,et("name")):[],[t]);return e(at,{"aria-label":s("createPolicy"),variant:rt.medium,header:y(Mt,{children:[e(Ve,{component:Et.h1,children:s("chooseAPolicyType")}),e(Ve,{children:s("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:r,children:y(fe,{"aria-label":s("policies"),variant:"compact",children:[e(ge,{children:y(Y,{children:[e(K,{children:s("name")}),e(K,{children:s("description")})]})}),e(Ce,{children:u.map(c=>y(Y,{"data-testid":c.type,onRowClick:()=>i(c),isHoverable:!0,children:[e(B,{children:c.name}),e(B,{children:Me(c.type)&&s(`policyProvider.${c.type}`)})]},c.type))})]})})};export{yn as A,gn as D,Mn as N,ni as P,Tn as R,fn as U};
//# sourceMappingURL=NewPolicyDialog-Q18nUkuT.js.map
