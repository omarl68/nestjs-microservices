import{jsxs as h,Fragment as N,jsx as e}from"react/jsx-runtime";import{useState as S,useMemo as Pe}from"react";import{u as L,Z as U,a4 as A,a3 as w,V as re,a0 as P,a1 as R,a2 as k,I as J,J as _,S as B,q as ee,f as I,ab as Re,g as Me,a as De,e as me,c as Ne,b as ue,B as ne,A as O,bY as Oe,bZ as oe,U as Le,ad as Ve,F as Ke,P as Ee,aP as Ae,b_ as ie,h as Be,L as fe,aQ as Ue,D as j,b1 as He,b$ as qe}from"./index-C9t2UlUN.js";import{u as Q}from"./ConfirmDialog-BDkqxnFL.js";import{D as Ge}from"./DynamicComponents-D5DD9CFr.js";import{F as $,a as Je}from"./FormAccess-DnQCcStE.js";import{L as _e}from"./PaginatingTableToolbar-oQUfBy2J.js";import{P as ze}from"./PermissionTab-Cqx0kVF9.js";import{R as je,u as $e}from"./RoutableTabs-vx5wTdby.js";import{a1 as We}from"./KeycloakDataTable-2rLFZPhG.js";import{V as Ze}from"./ViewHeader-cxZm8XhN.js";import{u as ge,F as ye}from"./useIsFeatureEnabled-CkHhuO9z.js";import{u as te}from"./useParams-DL8-63Ov.js";import{T as Y,S as m,F as X}from"./discovery-settings-sewf1As9.js";import{K as se}from"./KeycloakTextInput-DrlF32nr.js";import{S as Qe,D as Ye}from"./SamlGeneralSettings-CdfgS81L.js";import{O as Xe,D as et,a as tt}from"./OIDCGeneralSettings-DSZraG0A.js";import{E as at}from"./ExpandableSection-DjAskWMd.js";import{F as be}from"./Form-Cdw1qhWG.js";import{G as rt}from"./GeneralSettings-Dq0wvNi4.js";import{M as le}from"./MultiLineInput-DibC-IV_.js";import{a as W,b as Z}from"./Tabs-CjrDEqsl.js";import{b as nt}from"./ToolbarContent-D6TJq6fk.js";import"react-dom";import"./Modal-Bgkd26UL.js";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./copy-icon-CYSS18Ce.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./useToggle-K3Kx99tM.js";import"./DataListItemRow-Bimi62Tu.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./FlexItem-BEayPdRt.js";import"./KeySelect-CPI9XGq0.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";import"./Trans-DcN6j3pV.js";import"./PageHandler-TK8xnd8P.js";import"./PageList-59HC89eh.js";import"./DisplayOrder-Dong-iTt.js";import"./ClientIdSecret-4ICGdsMs.js";import"./MenuList-Br-Zu33q.js";const de=({field:t,label:a,defaultValue:r,labelForEmpty:d="none"})=>{const{t:n}=L(),{control:l}=U(),[i,c]=S(),[s,y]=S(!1);return ee(()=>I.authenticationManagement.getFlows(),b=>c(b.filter(f=>f.providerId==="basic-flow")),[]),e(P,{label:n(a),labelIcon:e(R,{helpText:n(`${a}Help`),fieldLabelId:a}),fieldId:a,children:e(w,{name:t,defaultValue:r,control:l,render:({field:b})=>e(J,{toggleId:a,required:!0,onToggle:()=>y(!s),onSelect:(f,v)=>{b.onChange(v),y(!1)},selections:b.value||n(d),variant:_.single,"aria-label":n(a),isOpen:s,children:[...r===""?[e(B,{value:"",children:n(d)},"empty")]:[],...i?.map(f=>e(B,{selected:f.alias===b.value,value:f.alias,children:f.alias},f.id))||[]]})})})},ce=["import","legacy","force"],ot=({isOIDC:t,isSAML:a})=>{const{t:r}=L(),{control:d,register:n,setValue:l,formState:{errors:i}}=U(),[c,s]=S(!1),b=A({control:d,name:"config.filteredByClaim",defaultValue:"false"})==="true",v=ge()(ye.TransientUsers),x=A({control:d,name:"config.doNotStoreUsers",defaultValue:"false"})==="false";return h(N,{children:[!t&&!a&&e(Y,{field:"config.defaultScope",label:"scopes"}),e(m,{field:"storeToken",label:"storeTokens",fieldType:"boolean"}),(a||t)&&e(m,{field:"addReadTokenRoleOnCreate",label:"storedTokensReadable",fieldType:"boolean"}),!t&&!a&&h(N,{children:[e(m,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(m,{field:"config.disableUserInfo",label:"disableUserInfo"})]}),t&&e(m,{field:"config.isAccessTokenJWT",label:"isAccessTokenJWT"}),e(m,{field:"trustEmail",label:"trustEmail",fieldType:"boolean"}),e(m,{field:"linkOnly",label:"accountLinkingOnly",fieldType:"boolean"}),e(m,{field:"config.hideOnLoginPage",label:"hideOnLoginPage"}),(!a||t)&&e(X,{label:"filteredByClaim",children:e(w,{name:"config.filteredByClaim",defaultValue:"false",control:d,render:({field:p})=>e(re,{id:"filteredByClaim",label:r("on"),labelOff:r("off"),isChecked:p.value==="true",onChange:u=>{p.onChange(u.toString())}})})}),(!a||t)&&b&&h(N,{children:[e(P,{label:r("claimFilterName"),labelIcon:e(R,{helpText:r("claimFilterNameHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-name",isRequired:!0,validated:i.config?.claimFilterName?k.error:k.default,helperTextInvalid:r("required"),children:e(se,{isRequired:!0,id:"kc-claim-filter-name","data-testid":"claimFilterName",validated:i.config?.claimFilterName?k.error:k.default,...n("config.claimFilterName",{required:!0})})}),e(P,{label:r("claimFilterValue"),labelIcon:e(R,{helpText:r("claimFilterValueHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-value",isRequired:!0,validated:i.config?.claimFilterValue?k.error:k.default,helperTextInvalid:r("required"),children:e(se,{isRequired:!0,id:"kc-claim-filter-value","data-testid":"claimFilterValue",validated:i.config?.claimFilterValue?k.error:k.default,...n("config.claimFilterValue",{required:!0})})})]}),e(de,{field:"firstBrokerLoginFlowAlias",label:"firstBrokerLoginFlowAliasOverride",defaultValue:"",labelForEmpty:""}),e(de,{field:"postBrokerLoginFlowAlias",label:"postBrokerLoginFlowAlias",defaultValue:""}),v&&e(X,{label:"doNotStoreUsers",children:e(w,{name:"config.doNotStoreUsers",defaultValue:"false",control:d,render:({field:p})=>e(re,{id:"doNotStoreUsers",label:r("on"),labelOff:r("off"),isChecked:p.value==="true",onChange:u=>{p.onChange(u.toString()),u&&l("config.syncMode","IMPORT")}})})}),x&&e(P,{className:"pf-u-pb-3xl",label:r("syncMode"),labelIcon:e(R,{helpText:r("syncModeHelp"),fieldLabelId:"syncMode"}),fieldId:"syncMode",children:e(w,{name:"config.syncMode",defaultValue:ce[0].toUpperCase(),control:d,render:({field:p})=>e(J,{toggleId:"syncMode",required:!0,direction:"up",onToggle:()=>s(!c),onSelect:(u,T)=>{p.onChange(T),s(!1)},selections:r(`syncModes.${p.value.toLowerCase()}`),variant:_.single,"aria-label":r("syncMode"),isOpen:c,children:ce.map(u=>e(B,{selected:u===p.value,value:u.toUpperCase(),children:r(`syncModes.${u}`)},u))})})})]})},it={unspecified:"",none:"none",consent:"consent",login:"login",select_account:"select_account"},st=()=>{const{t}=L(),{control:a}=U(),[r,d]=S(!1),[n,l]=S(!1);return e(at,{toggleText:t("advanced"),onToggle:()=>d(!r),isExpanded:r,children:h(be,{isHorizontal:!0,children:[e(m,{label:"passLoginHint",field:"config.loginHint"}),e(m,{label:"passMaxAge",field:"config.passMaxAge"}),e(m,{label:"passCurrentLocale",field:"config.uiLocales"}),e(m,{field:"config.backchannelSupported",label:"backchannelLogout"}),e(m,{field:"config.sendIdTokenOnLogout",label:"sendIdTokenOnLogout",defaultValue:"true"}),e(m,{field:"config.sendClientIdOnLogout",label:"sendClientIdOnLogout"}),e(m,{field:"config.disableUserInfo",label:"disableUserInfo"}),e(m,{field:"config.disableNonce",label:"disableNonce"}),e(Y,{field:"config.defaultScope",label:"scopes"}),e(X,{label:"prompt",children:e(w,{name:"config.prompt",defaultValue:"",control:a,render:({field:i})=>e(J,{toggleId:"prompt",required:!0,onToggle:()=>l(!n),onSelect:(c,s)=>{i.onChange(s),l(!1)},selections:i.value||t("prompts.unspecified"),variant:_.single,"aria-label":t("prompt"),isOpen:n,children:Object.entries(it).map(([c,s])=>e(B,{selected:s===i.value,value:s,children:t(`prompts.${c}`)},c))})})}),e(m,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(P,{label:t("allowedClockSkew"),labelIcon:e(R,{helpText:t("allowedClockSkewHelp"),fieldLabelId:"allowedClockSkew"}),fieldId:"allowedClockSkew",children:e(w,{name:"config.allowedClockSkew",defaultValue:0,control:a,render:({field:i})=>{const c=Number(i.value);return e(Re,{"data-testid":"allowedClockSkew",inputName:"allowedClockSkew",min:0,max:2147483,value:c,readOnly:!0,onPlus:()=>i.onChange(c+1),onMinus:()=>i.onChange(c-1),onChange:s=>{const y=Number(s.target.value);i.onChange(y<0?0:y)}})}})}),e(Y,{field:"config.forwardParameters",label:"forwardParameters"})]})})},pe=["exact","minimum","maximum","better"],lt=()=>{const{t}=L(),{control:a}=U(),[r,d]=S(!1);return h(N,{children:[e(P,{label:t("comparison"),labelIcon:e(R,{helpText:t("comparisonHelp"),fieldLabelId:"comparison"}),fieldId:"comparison",children:e(w,{name:"config.authnContextComparisonType",defaultValue:pe[0],control:a,render:({field:n})=>e(J,{toggleId:"comparison",required:!0,direction:"up",onToggle:l=>d(l),onSelect:(l,i)=>{n.onChange(i.toString()),d(!1)},selections:n.value,variant:_.single,"aria-label":t("comparison"),isOpen:r,children:pe.map(l=>e(B,{selected:l===n.value,value:l,children:t(l)},l))})})}),e(P,{label:t("authnContextClassRefs"),fieldId:"kc-authnContextClassRefs",labelIcon:e(R,{helpText:t("authnContextClassRefsHelp"),fieldLabelId:"authnContextClassRefs"}),children:e(le,{name:"config.authnContextClassRefs","aria-label":t("identify-providers:authnContextClassRefs"),addButtonLabel:"addAuthnContextClassRef","data-testid":"classref-field"})}),e(P,{label:t("authnContextDeclRefs"),fieldId:"kc-authnContextDeclRefs",labelIcon:e(R,{helpText:t("authnContextDeclRefsHelp"),fieldLabelId:"authnContextDeclRefs"}),children:e(le,{name:"config.authnContextDeclRefs","aria-label":t("identify-providers:authnContextDeclRefs"),addButtonLabel:"addAuthnContextDeclRef","data-testid":"declref-field"})})]})},dt=({onChange:t,value:a,save:r,toggleDeleteDialog:d})=>{const{t:n}=L(),{alias:l}=te(),[i,c]=S(),{addAlert:s,addError:y}=me(),{setValue:b,formState:f,control:v}=U(),D=A({control:v,name:"config.validateSignature"}),x=A({control:v,name:"config.useMetadataDescriptorUrl"}),p=A({control:v,name:"config.metadataDescriptorUrl"});ee(()=>I.identityProviders.findOne({alias:l}),C=>{if(!C)throw new Error(n("notFound"));c(C)},[]);const[u,T]=Q({titleKey:"disableProvider",messageKey:n("disableConfirmIdentityProvider",{provider:l}),continueButtonLabel:"disable",onConfirm:()=>{t(!a),r()}}),H=async(C,M)=>{try{const F=await I.identityProviders.importFromUrl({providerId:C,fromUrl:M});F.signingCertificate?(b("config.signingCertificate",F.signingCertificate),s(n("importKeysSuccess"),O.success)):y("importKeysError",n("importKeysErrorNoSigningCertificate"))}catch(F){y("importKeysError",F)}},z=async C=>{try{await I.identityProviders.reloadKeys({alias:C})?s(n("reloadKeysSuccess"),O.success):s(n("reloadKeysSuccessButFalse"),O.warning)}catch(M){y("reloadKeysError",M)}};return h(N,{children:[e(T,{}),e(Ze,{titleKey:Ue(i?i.displayName?i.displayName:i.providerId:""),divider:!1,dropdownItems:[...i?.providerId?.includes("saml")&&D==="true"&&x==="true"&&p&&!f.isDirty&&a?[e(j,{onClick:()=>z(i.alias),children:n("reloadKeys")},"reloadKeys")]:i?.providerId?.includes("saml")&&D==="true"&&x!=="true"&&p&&!f.isDirty?[e(j,{onClick:()=>H(i.providerId,p),children:n("importKeys")},"importKeys")]:[],e(He,{},"separator"),e(j,{onClick:()=>d(),children:n("delete")},"delete")],isEnabled:a,onToggle:C=>{C?(t(C),r()):u()}})]})},ct=({name:t,mapperId:a,provider:r})=>{const{realm:d}=ue(),{alias:n}=te();return e(fe,{to:qe({realm:d,alias:n,providerId:r?.providerId,id:a}),children:t})};function oa(){const{t}=L(),{alias:a,providerId:r}=te(),d=ge(),n=Me(),{handleSubmit:l,getValues:i,reset:c}=n,[s,y]=S(),[b,f]=S(),v=De(),D=Pe(()=>{const o=["org.keycloak.broker.social.SocialIdentityProvider","org.keycloak.broker.provider.IdentityProvider"];for(const g of o){const K=v.componentTypes?.[g]?.find(({id:E})=>E===r);if(K)return K}},[v,r]),{addAlert:x,addError:p}=me(),u=Ne(),{realm:T}=ue(),[H,z]=S(0),C=()=>z(H+1);ee(()=>I.identityProviders.findOne({alias:a}),o=>{if(!o)throw new Error(t("notFound"));c(o),y(o),o.config.authnContextClassRefs&&n.setValue("config.authnContextClassRefs",JSON.parse(o.config?.authnContextClassRefs)),o.config.authnContextDeclRefs&&n.setValue("config.authnContextDeclRefs",JSON.parse(o.config?.authnContextDeclRefs))},[]);const M=o=>oe({realm:T,alias:a,providerId:r,tab:o}),F=o=>$e(M(o)),he=F("settings"),Ce=F("mappers"),ve=F("permissions"),q=async o=>{const g=o||i();g.config?.authnContextClassRefs&&(g.config.authnContextClassRefs=JSON.stringify(g.config.authnContextClassRefs)),g.config?.authnContextDeclRefs&&(g.config.authnContextDeclRefs=JSON.stringify(g.config.authnContextDeclRefs));try{await I.identityProviders.update({alias:a},{...g,config:{...s?.config,...g.config},alias:a,providerId:r}),c(g),x(t("updateSuccessIdentityProvider"),O.success)}catch(K){p("updateErrorIdentityProvider",K)}},[Ie,Se]=Q({titleKey:"deleteProvider",messageKey:t("deleteConfirmIdentityProvider",{provider:a}),continueButtonLabel:"delete",continueButtonVariant:ne.danger,onConfirm:async()=>{try{await I.identityProviders.del({alias:a}),x(t("deletedSuccessIdentityProvider"),O.success),u(Oe({realm:T}))}catch(o){p("deleteErrorIdentityProvider",o)}}}),[Te,xe]=Q({titleKey:"deleteProviderMapper",messageKey:t("deleteMapperConfirm",{mapper:b?.name}),continueButtonLabel:"delete",continueButtonVariant:ne.danger,onConfirm:async()=>{try{await I.identityProviders.delMapper({alias:a,id:b?.mapperId}),x(t("deleteMapperSuccess"),O.success),C(),u(oe({providerId:r,alias:a,tab:"mappers",realm:T}))}catch(o){p("deleteErrorIdentityProvider",o)}}});if(!s)return e(Le,{});const G=s.providerId.includes("oidc"),V=s.providerId.includes("saml"),Fe=async()=>{const[o,g]=await Promise.all([I.identityProviders.findMappers({alias:a}),I.identityProviders.findMapperTypes({alias:a})]);return o.map(E=>{const ae=Object.values(g).find(we=>E.identityProviderMapper===we.id);return{...ae,name:E.name,type:ae?.name,mapperId:E.id}})},ke=[{title:t("generalSettings"),panel:h($,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:l(q),children:[!G&&!V&&e(rt,{create:!1,id:a}),G&&e(Xe,{}),V&&e(Qe,{isAliasReadonly:!0}),D&&e(Ge,{stringify:!0,properties:D.properties})]})},{title:t("oidcSettings"),isHidden:!G,panel:h(N,{children:[e(et,{readOnly:!1}),h(be,{isHorizontal:!0,className:"pf-u-py-lg",children:[e(Ve,{}),e(tt,{create:!1})]}),e(st,{})]})},{title:t("samlSettings"),isHidden:!V,panel:e(Ye,{readOnly:!1})},{title:t("reqAuthnConstraints"),isHidden:!V,panel:e($,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:l(q),children:e(lt,{})})},{title:t("advancedSettings"),panel:h($,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:l(q),children:[e(ot,{isOIDC:G,isSAML:V}),e(Je,{name:"idp-details",isSubmit:!0,reset:c})]})}];return h(Ke,{...n,children:[e(Se,{}),e(xe,{}),e(w,{name:"enabled",control:n.control,defaultValue:!0,render:({field:o})=>e(dt,{value:o.value||!1,onChange:o.onChange,save:q,toggleDeleteDialog:Ie})}),e(Ee,{variant:"light",className:"pf-u-p-0",children:h(je,{isBox:!0,defaultLocation:M("settings"),children:[e(W,{id:"settings",title:e(Z,{children:t("settings")}),...he,children:e(Ae,{label:t("jumpToSection"),className:"pf-u-px-lg",sections:ke})}),e(W,{id:"mappers","data-testid":"mappers-tab",title:e(Z,{children:t("mappers")}),...Ce,children:e(We,{emptyState:e(_e,{message:t("noMappers"),instructions:t("noMappersInstructions"),primaryActionText:t("addMapper"),onPrimaryAction:()=>u(ie({realm:T,alias:a,providerId:s.providerId,tab:"mappers"}))}),loader:Fe,ariaLabelKey:"mappersList",searchPlaceholderKey:"searchForMapper",toolbarItem:e(nt,{children:e(Be,{id:"add-mapper-button",component:o=>e(fe,{...o,to:ie({realm:T,alias:a,providerId:s.providerId,tab:"mappers"})}),"data-testid":"addMapper",children:t("addMapper")})}),columns:[{name:"name",displayKey:"name",cellRenderer:o=>e(ct,{...o,provider:s})},{name:"category",displayKey:"category"},{name:"type",displayKey:"type"}],actions:[{title:t("delete"),onRowClick:o=>{f(o),Te()}}]},H)}),d(ye.AdminFineGrainedAuthz)&&e(W,{id:"permissions","data-testid":"permissionsTab",title:e(Z,{children:t("permissions")}),...ve,children:e(ze,{id:a,type:"identityProviders"})})]})})]})}export{oa as default};
//# sourceMappingURL=DetailSettings-CjNsDRxK.js.map
