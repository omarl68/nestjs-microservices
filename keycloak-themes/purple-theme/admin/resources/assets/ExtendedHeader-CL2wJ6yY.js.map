{"version":3,"file":"ExtendedHeader-CL2wJ6yY.js","sources":["../../src/user-federation/shared/ExtendedHeader.tsx"],"sourcesContent":["import {\n  AlertVariant,\n  DropdownItem,\n  DropdownSeparator,\n} from \"@patternfly/react-core\";\nimport { useFormContext, useWatch } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { useParams } from \"react-router-dom\";\n\nimport { adminClient } from \"../../admin-client\";\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\nimport { Header } from \"./Header\";\n\ntype ExtendedHeaderProps = {\n  provider: string;\n  editMode?: string | string[];\n  save: () => void;\n  noDivider?: boolean;\n};\n\nexport const ExtendedHeader = ({\n  provider,\n  editMode,\n  save,\n  noDivider = false,\n}: ExtendedHeaderProps) => {\n  const { t } = useTranslation();\n  const { id } = useParams<{ id: string }>();\n  const { addAlert, addError } = useAlerts();\n\n  const { control } = useFormContext();\n  const hasImportUsers = useWatch({\n    name: \"config.importEnabled\",\n    control,\n    defaultValue: [\"true\"],\n  })[0];\n\n  const [toggleUnlinkUsersDialog, UnlinkUsersDialog] = useConfirmDialog({\n    titleKey: \"userFedUnlinkUsersConfirmTitle\",\n    messageKey: \"userFedUnlinkUsersConfirm\",\n    continueButtonLabel: \"unlinkUsers\",\n    onConfirm: () => unlinkUsers(),\n  });\n\n  const [toggleRemoveUsersDialog, RemoveUsersConfirm] = useConfirmDialog({\n    titleKey: t(\"removeImportedUsers\"),\n    messageKey: t(\"removeImportedUsersMessage\"),\n    continueButtonLabel: \"remove\",\n    onConfirm: async () => {\n      try {\n        removeImportedUsers();\n        addAlert(t(\"removeImportedUsersSuccess\"), AlertVariant.success);\n      } catch (error) {\n        addError(\"removeImportedUsersError\", error);\n      }\n    },\n  });\n\n  const removeImportedUsers = async () => {\n    try {\n      if (id) {\n        await adminClient.userStorageProvider.removeImportedUsers({ id });\n      }\n      addAlert(t(\"removeImportedUsersSuccess\"), AlertVariant.success);\n    } catch (error) {\n      addError(\"removeImportedUsersError\", error);\n    }\n  };\n\n  const syncChangedUsers = async () => {\n    try {\n      if (id) {\n        const response = await adminClient.userStorageProvider.sync({\n          id: id,\n          action: \"triggerChangedUsersSync\",\n        });\n        if (response.ignored) {\n          addAlert(`${response.status}.`, AlertVariant.warning);\n        } else {\n          addAlert(\n            t(\"syncUsersSuccess\") +\n              `${response.added} users added, ${response.updated} users updated, ${response.removed} users removed, ${response.failed} users failed.`,\n            AlertVariant.success,\n          );\n        }\n      }\n    } catch (error) {\n      addError(\"syncUsersError\", error);\n    }\n  };\n\n  const syncAllUsers = async () => {\n    try {\n      if (id) {\n        const response = await adminClient.userStorageProvider.sync({\n          id: id,\n          action: \"triggerFullSync\",\n        });\n        if (response.ignored) {\n          addAlert(`${response.status}.`, AlertVariant.warning);\n        } else {\n          addAlert(\n            t(\"syncUsersSuccess\") +\n              `${response.added} users added, ${response.updated} users updated, ${response.removed} users removed, ${response.failed} users failed.`,\n            AlertVariant.success,\n          );\n        }\n      }\n    } catch (error) {\n      addError(\"syncUsersError\", error);\n    }\n  };\n\n  const unlinkUsers = async () => {\n    try {\n      if (id) {\n        await adminClient.userStorageProvider.unlinkUsers({ id });\n      }\n      addAlert(t(\"unlinkUsersSuccess\"), AlertVariant.success);\n    } catch (error) {\n      addError(\"unlinkUsersError\", error);\n    }\n  };\n\n  return (\n    <>\n      <UnlinkUsersDialog />\n      <RemoveUsersConfirm />\n      <Header\n        provider={provider}\n        noDivider={noDivider}\n        save={save}\n        dropdownItems={[\n          <DropdownItem\n            key=\"sync\"\n            onClick={syncChangedUsers}\n            isDisabled={hasImportUsers === \"false\"}\n          >\n            {t(\"syncChangedUsers\")}\n          </DropdownItem>,\n          <DropdownItem\n            key=\"syncall\"\n            onClick={syncAllUsers}\n            isDisabled={hasImportUsers === \"false\"}\n          >\n            {t(\"syncAllUsers\")}\n          </DropdownItem>,\n          <DropdownItem\n            key=\"unlink\"\n            isDisabled={editMode ? editMode.includes(\"UNSYNCED\") : false}\n            onClick={toggleUnlinkUsersDialog}\n          >\n            {t(\"unlinkUsers\")}\n          </DropdownItem>,\n          <DropdownItem key=\"remove\" onClick={toggleRemoveUsersDialog}>\n            {t(\"removeImported\")}\n          </DropdownItem>,\n          <DropdownSeparator key=\"separator\" />,\n        ]}\n      />\n    </>\n  );\n};\n"],"names":["ExtendedHeader","provider","editMode","save","noDivider","t","useTranslation","id","useParams","addAlert","addError","useAlerts","control","useFormContext","hasImportUsers","useWatch","toggleUnlinkUsersDialog","UnlinkUsersDialog","useConfirmDialog","unlinkUsers","toggleRemoveUsersDialog","RemoveUsersConfirm","removeImportedUsers","AlertVariant","error","adminClient","syncChangedUsers","response","syncAllUsers","jsxs","Fragment","jsx","Header","DropdownItem","DropdownSeparator"],"mappings":"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"}