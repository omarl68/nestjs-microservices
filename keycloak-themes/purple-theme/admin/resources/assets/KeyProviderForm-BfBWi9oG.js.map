{"version":3,"file":"KeyProviderForm-BfBWi9oG.js","sources":["../../src/realm-settings/keys/key-providers/KeyProviderForm.tsx"],"sourcesContent":["import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\nimport {\n  ActionGroup,\n  AlertVariant,\n  Button,\n  FormGroup,\n  PageSection,\n  TextInput,\n  ValidatedOptions,\n} from \"@patternfly/react-core\";\nimport { Controller, FormProvider, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { useNavigate } from \"react-router-dom\";\nimport { HelpItem } from \"ui-shared\";\n\nimport { adminClient } from \"../../../admin-client\";\nimport { useAlerts } from \"../../../components/alert/Alerts\";\nimport { DynamicComponents } from \"../../../components/dynamic/DynamicComponents\";\nimport { FormAccess } from \"../../../components/form/FormAccess\";\nimport { KeycloakTextInput } from \"../../../components/keycloak-text-input/KeycloakTextInput\";\nimport { ViewHeader } from \"../../../components/view-header/ViewHeader\";\nimport { useServerInfo } from \"../../../context/server-info/ServerInfoProvider\";\nimport { KEY_PROVIDER_TYPE } from \"../../../util\";\nimport { useFetch } from \"../../../utils/useFetch\";\nimport { useParams } from \"../../../utils/useParams\";\nimport { KeyProviderParams, ProviderType } from \"../../routes/KeyProvider\";\nimport { toKeysTab } from \"../../routes/KeysTab\";\n\ntype KeyProviderFormProps = {\n  id?: string;\n  providerType: ProviderType;\n  onClose?: () => void;\n};\n\nexport const KeyProviderForm = ({\n  providerType,\n  onClose,\n}: KeyProviderFormProps) => {\n  const { t } = useTranslation();\n  const { id } = useParams<{ id: string }>();\n  const { addAlert, addError } = useAlerts();\n\n  const serverInfo = useServerInfo();\n  const allComponentTypes =\n    serverInfo.componentTypes?.[KEY_PROVIDER_TYPE] ?? [];\n\n  const form = useForm<ComponentRepresentation>({\n    mode: \"onChange\",\n  });\n  const {\n    register,\n    control,\n    handleSubmit,\n    formState: { errors },\n    reset,\n  } = form;\n\n  const save = async (component: ComponentRepresentation) => {\n    if (component.config)\n      Object.entries(component.config).forEach(\n        ([key, value]) =>\n          (component.config![key] = Array.isArray(value) ? value : [value]),\n      );\n    try {\n      if (id) {\n        await adminClient.components.update(\n          { id },\n          {\n            ...component,\n            providerType: KEY_PROVIDER_TYPE,\n          },\n        );\n        addAlert(t(\"saveProviderSuccess\"), AlertVariant.success);\n      } else {\n        await adminClient.components.create({\n          ...component,\n          providerId: providerType,\n          providerType: KEY_PROVIDER_TYPE,\n        });\n        addAlert(t(\"saveProviderSuccess\"), AlertVariant.success);\n        onClose?.();\n      }\n    } catch (error) {\n      addError(\"saveProviderError\", error);\n    }\n  };\n\n  useFetch(\n    async () => {\n      if (id) return await adminClient.components.findOne({ id });\n    },\n    (result) => {\n      if (result) {\n        reset({ ...result });\n      }\n    },\n    [],\n  );\n\n  return (\n    <FormAccess isHorizontal role=\"manage-realm\" onSubmit={handleSubmit(save)}>\n      {id && (\n        <FormGroup\n          label={t(\"providerId\")}\n          labelIcon={\n            <HelpItem\n              helpText={t(\"mapperNameHelp\")}\n              fieldLabelId=\"providerId\"\n            />\n          }\n          fieldId=\"providerId\"\n          isRequired\n        >\n          <KeycloakTextInput\n            id=\"providerId\"\n            data-testid=\"providerId-input\"\n            isReadOnly\n            {...register(\"id\")}\n          />\n        </FormGroup>\n      )}\n      <FormGroup\n        label={t(\"name\")}\n        labelIcon={\n          <HelpItem helpText={t(\"mapperNameHelp\")} fieldLabelId=\"name\" />\n        }\n        fieldId=\"name\"\n        isRequired\n        validated={\n          errors.name ? ValidatedOptions.error : ValidatedOptions.default\n        }\n        helperTextInvalid={t(\"required\")}\n      >\n        <Controller\n          name=\"name\"\n          control={control}\n          rules={{ required: true }}\n          defaultValue={providerType}\n          render={({ field }) => (\n            <TextInput\n              id=\"name\"\n              value={field.value}\n              onChange={field.onChange}\n              data-testid=\"name-input\"\n            />\n          )}\n        />\n      </FormGroup>\n      <FormProvider {...form}>\n        <DynamicComponents\n          properties={\n            allComponentTypes.find((type) => type.id === providerType)\n              ?.properties || []\n          }\n        />\n      </FormProvider>\n      <ActionGroup>\n        <Button\n          data-testid=\"add-provider-button\"\n          variant=\"primary\"\n          type=\"submit\"\n        >\n          {t(\"save\")}\n        </Button>\n        <Button onClick={() => onClose?.()} variant=\"link\">\n          {t(\"cancel\")}\n        </Button>\n      </ActionGroup>\n    </FormAccess>\n  );\n};\n\nexport default function KeyProviderFormPage() {\n  const { t } = useTranslation();\n  const params = useParams<KeyProviderParams>();\n  const navigate = useNavigate();\n\n  return (\n    <>\n      <ViewHeader titleKey={t(\"editProvider\")} subKey={params.providerType} />\n      <PageSection variant=\"light\">\n        <KeyProviderForm\n          {...params}\n          onClose={() =>\n            navigate(toKeysTab({ realm: params.realm, tab: \"providers\" }))\n          }\n        />\n      </PageSection>\n    </>\n  );\n}\n"],"names":["KeyProviderForm","providerType","onClose","useTranslation","id","useParams","addAlert","addError","useAlerts","allComponentTypes","useServerInfo","KEY_PROVIDER_TYPE","form","useForm","register","control","handleSubmit","errors","reset","save","component","key","value","adminClient","AlertVariant","error","useFetch","result","jsxs","FormAccess","jsx","FormGroup","HelpItem","KeycloakTextInput","ValidatedOptions","Controller","field","TextInput","FormProvider","DynamicComponents","type","ActionGroup","Button","KeyProviderFormPage","t","params","navigate","useNavigate","Fragment","ViewHeader","PageSection","toKeysTab"],"mappings":"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"}