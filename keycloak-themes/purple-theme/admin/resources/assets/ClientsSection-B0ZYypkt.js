import{jsxs as l,Fragment as K,jsx as t}from"react/jsx-runtime";import{useState as L,useMemo as se}from"react";import{bm as $,u as g,e as M,b as f,c as Q,B as F,f as h,A as U,h as P,L as I,bn as O,a as oe,p as re,r as le,d as X,q as ce,aH as Y,aG as W,a1 as j,aR as Z,ag as de,P as me,aE as H,bj as ue,aF as pe,bo as ye,ar as ee,bp as he,bq as ge}from"./index-C9t2UlUN.js";import{u as N}from"./ConfirmDialog-BDkqxnFL.js";import{V as fe,F as be}from"./ViewHeader-cxZm8XhN.js";import{R as te,u as ie}from"./RoutableTabs-vx5wTdby.js";import{aa as Ce,a1 as V,a2 as A,ab as ne}from"./KeycloakDataTable-2rLFZPhG.js";import{L as Te}from"./PaginatingTableToolbar-oQUfBy2J.js";import{u as De,F as _}from"./useFormatDate-Yp0qEhJS.js";import{u as Ae}from"./useToggle-K3Kx99tM.js";import{M as Re,a as ke}from"./Modal-Bgkd26UL.js";import{e as Le,D as q,a as G,c as z,d as S}from"./DataListItemRow-Bimi62Tu.js";import{b as E}from"./ToolbarContent-D6TJq6fk.js";import{a as R,b as k}from"./Tabs-CjrDEqsl.js";import{i as Ie,g as Pe}from"./utils-DeGqqWSp.js";import"react-dom";import"./PageHandler-TK8xnd8P.js";import"./DynamicComponents-D5DD9CFr.js";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./copy-icon-CYSS18Ce.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./KeycloakTextInput-DrlF32nr.js";import"./Form-Cdw1qhWG.js";import"./_baseFlatten-BQ8y46Zj.js";import"./FlexItem-BEayPdRt.js";import"./KeySelect-CPI9XGq0.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";import"./PageList-59HC89eh.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./MenuList-Br-Zu33q.js";const Ke=()=>({className:Ce.modifiers.wrap}),ve=({rootUrl:e,baseUrl:i},n)=>i?.startsWith("http")?i:(e==="${authBaseUrl}"||e==="${authAdminUrl}")&&i?e.replace(/\$\{(authAdminUrl|authBaseUrl)\}/,$(n,i)):e?.startsWith("http")?i?$(e,i):e:i,we=()=>{const{t:e}=g(),{addAlert:i,addError:n}=M(),{realm:s}=f(),o=De(),c=Q(),[d,m]=L(),a=async()=>{try{return await h.realms.getClientsInitialAccess({realm:s})}catch{return[]}},[y,b]=N({titleKey:"tokenDeleteConfirmTitle",messageKey:e("tokenDeleteConfirm",{id:d?.id}),continueButtonLabel:"delete",continueButtonVariant:F.danger,onConfirm:async()=>{try{await h.realms.delClientsInitialAccess({realm:s,id:d.id}),i(e("tokenDeleteSuccess"),U.success),m(void 0)}catch(r){n("tokenDeleteError",r)}}});return l(K,{children:[t(b,{}),t(V,{ariaLabelKey:"initialAccessToken",searchPlaceholderKey:"searchInitialAccessToken",loader:a,toolbarItem:t(P,{component:r=>t(I,{...r,to:O({realm:s})}),children:e("create")}),actions:[{title:e("delete"),onRowClick:r=>{m(r),y()}}],columns:[{name:"id",displayKey:"id"},{name:"timestamp",displayKey:"timestamp",cellRenderer:r=>o(new Date(r.timestamp*1e3),_)},{name:"expiration",displayKey:"expires",cellRenderer:r=>o(new Date(r.timestamp*1e3+r.expiration*1e3),_)},{name:"count",displayKey:"count"},{name:"remainingCount",displayKey:"remainingCount",transforms:[Ke]}],emptyState:t(Te,{message:e("noTokens"),instructions:e("noTokensInstructions"),primaryActionText:e("create"),onPrimaryAction:()=>c(O({realm:s}))})},d?.id)]})},xe=({onConfirm:e,toggleDialog:i})=>{const{t:n}=g(),s=oe(),o=Object.keys(s.providers?.["client-registration-policy"].providers||[]),c=s.componentTypes?.["org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"],d=re(),m=se(()=>d(c?.filter(a=>o.includes(a.id))||[],le("id")),[o,c]);return t(Re,{variant:ke.medium,title:n("chooseAPolicyProvider"),isOpen:!0,onClose:i,children:l(Le,{onSelectDataListItem:a=>{e(a),i()},"aria-label":n("addPredefinedMappers"),isCompact:!0,children:[t(q,{"aria-label":n("headerName"),id:"header",children:t(G,{children:t(z,{dataListCells:[n("name"),n("description")].map(a=>t(S,{style:{fontWeight:700},children:a},a))})})}),m.map(a=>t(q,{"aria-label":a.id,"data-testid":a.id,id:a.id,children:t(G,{children:t(z,{dataListCells:[t(S,{width:2,children:a.id},`name-${a.id}`),t(S,{width:4,children:a.helpText},`description-${a.id}`)]})})},a.id))]})})},Be=e=>{const{realm:i}=f(),{subTab:n}=X();return t(I,{to:Y({realm:i,subTab:n||"anonymous",providerId:e.providerId,id:e.id}),children:e.name},e.id)},J=({subType:e})=>{const{t:i}=g(),{subTab:n}=X(),s=Q(),{addAlert:o,addError:c}=M(),{realm:d}=f(),[m,a]=L([]),[y,b]=L(),[r,C]=Ae();ce(()=>h.components.find({type:"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"}),u=>a(u.filter(x=>x.subType===e)),[y]);const[v,w]=N({titleKey:"clientRegisterPolicyDeleteConfirmTitle",messageKey:i("clientRegisterPolicyDeleteConfirm",{name:y?.name}),continueButtonLabel:"delete",continueButtonVariant:F.danger,onConfirm:async()=>{try{await h.components.del({realm:d,id:y?.id}),o(i("clientRegisterPolicyDeleteSuccess")),b(void 0)}catch(u){c("clientRegisterPolicyDeleteError",u)}}});return l(K,{children:[r&&t(xe,{onConfirm:u=>s(Y({realm:d,subTab:n||"anonymous",providerId:u})),toggleDialog:C}),t(w,{}),t(V,{ariaLabelKey:"clientRegistration",searchPlaceholderKey:i("searchClientRegistration"),"data-testid":`clientRegistration-${e}`,loader:m,toolbarItem:t(E,{children:t(P,{"data-testid":`createPolicy-${e}`,onClick:C,children:i("createPolicy")})}),actions:[{title:i("delete"),onRowClick:u=>{b(u),v()}}],columns:[{name:"name",displayKey:"name",cellRenderer:Be},{name:"providerId",displayKey:"providerId"}]})]})},Se=()=>{const{t:e}=g(),{realm:i}=f(),n=c=>ie(W({realm:i,subTab:c})),s=n("anonymous"),o=n("authenticated");return l(te,{defaultLocation:W({realm:i,subTab:"anonymous"}),mountOnEnter:!0,children:[t(R,{"data-testid":"anonymous",title:l(k,{children:[e("anonymousAccessPolicies")," ",t(j,{fieldLabelId:"",helpText:e("anonymousAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...s,children:t(J,{subType:"anonymous"})}),t(R,{"data-testid":"authenticated",title:l(k,{children:[e("authenticatedAccessPolicies")," ",t(j,{fieldLabelId:"",helpText:e("authenticatedAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...o,children:t(J,{subType:"authenticated"})})]})},Ee=e=>{const{t:i}=g(),{realm:n}=f();return l(I,{to:pe({realm:n,clientId:e.id,tab:"settings"}),children:[e.clientId,!e.enabled&&t(ye,{isRead:!0,className:"pf-u-ml-sm",children:i("disabled")},`${e.id}-disabled`)]},e.id)},Me=e=>t(ne,{wrapModifier:"truncate",children:ee()(e.name)}),Fe=e=>t(ne,{wrapModifier:"truncate",children:ee()(e.description)}),Ne=e=>{const i=ve(e,h.baseUrl);return i?t(be,{href:i}):"â€”"},Ve=()=>{const{t:e}=g(),{realm:i}=f(),{hasAccess:n}=Z();return n("manage-clients")?l(K,{children:[t(E,{children:t(P,{component:o=>t(I,{...o,to:he({realm:i})}),children:e("createClient")})}),t(E,{children:t(P,{component:o=>t(I,{...o,to:ge({realm:i})}),variant:"link","data-testid":"importClient",children:e("importClient")})})]}):t("span",{})};function At(){const{t:e}=g(),{addAlert:i,addError:n}=M(),{realm:s}=f(),[o,c]=L(0),d=()=>c(new Date().getTime()),[m,a]=L(),{hasAccess:y}=Z(),b=y("manage-clients"),r=async(p,T,D)=>{const B={first:p,max:T};return D&&(B.clientId=D,B.search=!0),await h.clients.find({...B})},C=p=>ie(H({realm:s,tab:p})),v=C("list"),w=C("initial-access-token"),u=C("client-registration"),[x,ae]=N({titleKey:e("clientDelete",{clientId:m?.clientId}),messageKey:"clientDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:F.danger,onConfirm:async()=>{try{await h.clients.del({id:m.id}),i(e("clientDeletedSuccess"),U.success),d()}catch(p){n("clientDeleteError",p)}}});return l(K,{children:[t(fe,{titleKey:"clientList",subKey:"clientsExplain",helpUrl:de.clientsUrl,divider:!1}),t(me,{variant:"light",className:"pf-u-p-0",children:l(te,{mountOnEnter:!0,isBox:!0,defaultLocation:H({realm:s,tab:"list"}),children:[l(R,{"data-testid":"list",title:t(k,{children:e("clientsList")}),...v,children:[t(ae,{}),t(V,{loader:r,isPaginated:!0,ariaLabelKey:"clientList",searchPlaceholderKey:"searchForClient",toolbarItem:t(Ve,{}),actionResolver:p=>{const T=p.data,D=[{title:e("export"),onClick(){ue(T)}}];return!Ie(T)&&(b||T.access?.configure)&&D.push({title:e("delete"),onClick(){a(T),x()}}),D},columns:[{name:"clientId",displayKey:"clientId",transforms:[A(20)],cellRenderer:Ee},{name:"clientName",displayKey:"clientName",transforms:[A(20)],cellRenderer:Me},{name:"protocol",displayKey:"type",transforms:[A(10)],cellRenderer:p=>Pe(e,p.protocol??"openid-connect")},{name:"description",displayKey:"description",transforms:[A(30)],cellRenderer:Fe},{name:"baseUrl",displayKey:"homeURL",transforms:[A(20)],cellRenderer:Ne}]},o)]}),t(R,{"data-testid":"initialAccessToken",title:t(k,{children:e("initialAccessToken")}),...w,children:t(we,{})}),t(R,{"data-testid":"registration",title:t(k,{children:e("clientRegistration")}),...u,children:t(Se,{})})]})})]})}export{At as default};
//# sourceMappingURL=ClientsSection-B0ZYypkt.js.map
