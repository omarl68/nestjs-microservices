import{jsx as e,jsxs as o,Fragment as p}from"react/jsx-runtime";import{useState as x,useMemo as X,Fragment as Y}from"react";import{u as Z,c as _,g as ee,aT as te,e as ie,a as re,q as ae,B as oe,f as h,A as v,dI as F,dG as y,U as le,n as se,D as ne,P as ce,a0 as w,a2 as L,h as d,L as P,G as V,H as A,a1 as S,dU as de,ae as me,dV as ue,ad as fe}from"./index-C9t2UlUN.js";import{u as pe}from"./ConfirmDialog-BDkqxnFL.js";import{F as xe}from"./FormAccess-DnQCcStE.js";import{K as he}from"./KeycloakTextArea-DChmurIP.js";import{K as Pe}from"./KeycloakTextInput-DrlF32nr.js";import{V as Ce}from"./ViewHeader-cxZm8XhN.js";import{u as be}from"./useParams-DL8-63Ov.js";/* empty css                               */import{A as ge}from"./Form-Cdw1qhWG.js";import{F as ke,a as K}from"./FlexItem-BEayPdRt.js";import{e as Te,D as ve,a as ye,c as Ee,d as De}from"./DataListItemRow-Bimi62Tu.js";import{T as Ie}from"./trash-icon-ByiQCzIH.js";import"react-dom";import"./Modal-Bgkd26UL.js";import"./copy-icon-CYSS18Ce.js";import"./ToolbarContent-D6TJq6fk.js";import"./grip-vertical-icon-B_ub3hpF.js";const Ne={name:"",description:"",executors:[]};function Qe(){const{t}=Z(),C=_(),{handleSubmit:G,setValue:b,getValues:H,register:E,formState:{isDirty:D,errors:B},control:R}=ee({defaultValues:Ne,mode:"onChange"}),{fields:g,remove:q}=te({name:"executors",control:R}),{addAlert:k,addError:T}=ie(),[m,O]=x(),[a,j]=x(!1),{realm:n,profileName:l}=be(),M=re(),U=X(()=>M.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,$]=x(),c=!!l,[I,z]=x(0),J=()=>z(I+1);ae(()=>h.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{O({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(f=>f.name!==l)});const s=i.globalProfiles?.find(f=>f.name===l),r=i.profiles?.find(f=>f.name===l);j(s!==void 0),b("name",s?.name??r?.name??""),b("description",s?.description??r?.description??""),b("executors",s?.executors??r?.executors??[])},[I]);const Q=async i=>{const s=i;try{await h.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),k(t(c?"updateClientProfileSuccess":"createClientProfileSuccess"),v.success),C(F({realm:n,profileName:i.name}))}catch(r){T(c?"updateClientProfileError":"createClientProfileError",r)}},[N,W]=pe({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:oe.danger,onConfirm:async()=>{if(u?.name){q(u.idx);try{await h.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],H()]}),k(t("deleteExecutorSuccess"),v.success),C(F({realm:n,profileName:l}))}catch(i){T(t("deleteExecutorError"),i)}}else try{await h.clientPolicies.createProfiles(m),k(t("deleteClientSuccess"),v.success),C(y({realm:n,tab:"profiles"}))}catch(i){T(t("deleteClientError"),i)}}});return m?o(p,{children:[e(W,{}),e(Ce,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:a?e(se,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!a?[e(ne,{value:"delete",onClick:N,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(ce,{variant:"light",children:o(xe,{isHorizontal:!0,role:"view-realm",className:"pf-u-mt-lg",children:[e(w,{label:t("newClientProfileName"),fieldId:"kc-name",helperText:t("createClientProfileNameHelperText"),isRequired:!0,helperTextInvalid:t("required"),validated:B.name?L.error:L.default,children:e(Pe,{id:"kc-name","data-testid":"client-profile-name",isReadOnly:a,...E("name",{required:!0})})}),e(w,{label:t("description"),fieldId:"kc-description",children:e(he,{id:"kc-description","data-testid":"client-profile-description",isReadOnly:a,...E("description")})}),o(ge,{children:[!a&&e(d,{variant:"primary",onClick:()=>G(Q)(),"data-testid":"saveCreateProfile",isDisabled:!D,children:t("save")}),c&&!a&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!D,onClick:J,children:t("reload")}),!c&&!a&&e(d,{id:"cancelCreateProfile",variant:"link",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("cancel")})]}),c&&o(p,{children:[o(ke,{children:[e(K,{children:o(V,{className:"kc-executors",component:A.h1,children:[t("executors"),e(S,{helpText:t("executorsHelpText"),fieldLabelId:"executors"})]})}),!a&&e(K,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:i=>e(P,{...i,to:de({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(me,{}),children:t("addExecutor")})})]}),g.length>0&&o(p,{children:[e(Te,{"aria-label":t("executors"),isCompact:!0,children:g.map((i,s)=>e(ve,{"aria-labelledby":"executors-list-item",id:i.executor,children:e(ye,{"data-testid":"executors-list-row",children:e(Ee,{dataListCells:[o(De,{"data-testid":"executor-type",children:[i.configuration?e(d,{component:r=>e(P,{...r,to:ue({realm:n,profileName:l,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e("span",{className:"kc-unclickable-executor",children:i.executor}),U?.filter(r=>r.id===i.executor).map(r=>o(Y,{children:[e(S,{helpText:r.helpText,fieldLabelId:"executorTypeTextHelpText"},r.id),!a&&e(d,{variant:"link",isInline:!0,icon:e(Ie,{className:"kc-executor-trash-icon","data-testid":"deleteExecutor"},`executorType-trash-icon-${r.id}`),onClick:()=>{N(),$({idx:s,name:r.id})},"aria-label":t("remove")})]},r.id))]},"executor")]})})},i.executor))}),a&&e(d,{id:"backToClientPolicies",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("back")})]}),g.length===0&&o(p,{children:[e(fe,{}),e(V,{className:"kc-emptyExecutors",component:A.h2,children:t("emptyExecutors")})]})]})]})})]}):e(le,{})}export{Qe as default};
//# sourceMappingURL=ClientProfileForm-DGd8Zzke.js.map
