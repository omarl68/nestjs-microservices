import{jsx as e,jsxs as w,Fragment as F}from"react/jsx-runtime";import{useState as m}from"react";import{u as V,Z as q,q as k,a0 as i,a1 as l,a3 as O,I as E,J as j,f as u,S as G,e as J,g as W,c as Z,aR as Q,an as X,A as D,bi as H,U as Y,D as $,P as ee,F as ae,a2 as S,V as re,h as M,B as te,L as se,N as oe,b5 as ne,M as ie}from"./index-C9t2UlUN.js";import{u as le}from"./ConfirmDialog-BDkqxnFL.js";import{F as ce}from"./FormAccess-DnQCcStE.js";import{K as de}from"./KeyValueInput-BJlDoGlu.js";import{K as y}from"./KeycloakTextInput-DrlF32nr.js";import{M as ue}from"./MultiLineInput-DibC-IV_.js";import{V as pe}from"./ViewHeader-cxZm8XhN.js";import{u as me}from"./useParams-DL8-63Ov.js";import{A as he}from"./Form-Cdw1qhWG.js";import"react-dom";import"./Modal-Bgkd26UL.js";import"./copy-icon-CYSS18Ce.js";import"./KeySelect-CPI9XGq0.js";import"./useToggle-K3Kx99tM.js";import"./EmptyStateBody-CyIhnUop.js";import"./ToolbarContent-D6TJq6fk.js";const fe=({clientId:a})=>{const{t:c}=V(),{control:T}=q(),[x,v]=m(!1),[h,C]=m(),[f,b]=m("");k(()=>{const t={id:a,first:0,max:20,deep:!1,name:f};return u.clients.listAllScopes(t)},C,[f]);const I=t=>t?.map(o=>e(G,{value:o,children:o.name},o.id));return e(i,{label:c("authorizationScopes"),labelIcon:e(l,{helpText:c("clientScopesHelp"),fieldLabelId:"scopes"}),fieldId:"scopes",children:e(O,{name:"scopes",defaultValue:[],control:T,render:({field:t})=>e(E,{toggleId:"scopes",variant:j.typeaheadMulti,chipGroupProps:{numChips:3,expandedText:c("hide"),collapsedText:c("showRemaining")},onToggle:v,isOpen:x,selections:t.value.map(o=>o.name),onFilter:(o,d)=>(b(d),I(h)),onSelect:(o,d)=>{const A=typeof d=="string"?d:d.name,R=t.value.find(s=>s.name===A)?t.value.filter(s=>s.name!==A):[...t.value,d];t.onChange(R)},onClear:o=>{o.stopPropagation(),b(""),t.onChange([])},typeAheadAriaLabel:c("authorizationScopes"),children:I(h)})})})};function Me(){const{t:a}=V(),[c,T]=m(),[x,v]=m(),[h,C]=m(),{addAlert:f,addError:b}=J(),I=W({mode:"onChange"}),{register:t,formState:{errors:o},control:d,setValue:A,handleSubmit:R}=I,{id:s,resourceId:n,realm:L}=me(),N=Z(),_=(r={})=>{ie(r,A)},{hasAccess:K}=Q(),P=!K("manage-authorization");k(()=>Promise.all([u.clients.findOne({id:s}),n?u.clients.getResource({id:s,resourceId:n}):Promise.resolve(void 0),n?u.clients.listPermissionsByResource({id:s,resourceId:n}):Promise.resolve(void 0)]),([r,p,g])=>{if(!r)throw new Error(a("notFound"));T(r),C(g),v(p),_(p)},[]);const U=async r=>{const p=oe(r);try{if(n)await u.clients.updateResource({id:s,resourceId:n},p);else{const g=await u.clients.createResource({id:s},p);v(p),N(ne({realm:L,id:s,resourceId:g._id}))}f(a((n?"update":"create")+"ResourceSuccess"),D.success)}catch(g){b("resourceSaveError",g)}},[z,B]=le({titleKey:"deleteResource",children:w(F,{children:[a("deleteResourceConfirm"),h?.length!==0&&e(X,{variant:"warning",isInline:!0,isPlain:!0,title:a("deleteResourceWarning"),className:"pf-u-pt-lg",children:e("p",{className:"pf-u-pt-xs",children:h?.map(r=>e("strong",{className:"pf-u-pr-md",children:r.name},r.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await u.clients.delResource({id:s,resourceId:n}),f(a("resourceDeletedSuccess"),D.success),N(H({realm:L,clientId:s,tab:"resources"}))}catch(r){b("resourceDeletedError",r)}}});return c?w(F,{children:[e(B,{}),e(pe,{titleKey:n?x?.name:"createResource",dropdownItems:n?[e($,{"data-testid":"delete-resource",isDisabled:P,onClick:()=>z(),children:a("delete")},"delete")]:void 0}),e(ee,{variant:"light",children:e(ae,{...I,children:w(ce,{isHorizontal:!0,role:"manage-authorization",className:"keycloak__resource-details__form",onSubmit:R(U),children:[e(i,{label:a("owner"),fieldId:"owner",labelIcon:e(l,{helpText:a("ownerHelp"),fieldLabelId:"owner"}),children:e(y,{id:"owner",value:c.clientId,isReadOnly:!0})}),e(i,{label:a("name"),fieldId:"name",labelIcon:e(l,{helpText:a("resourceNameHelp"),fieldLabelId:"name"}),helperTextInvalid:a("required"),validated:o.name?S.error:S.default,isRequired:!0,children:e(y,{id:"name",validated:o.name?S.error:S.default,...t("name",{required:!0})})}),e(i,{label:a("displayName"),fieldId:"displayName",labelIcon:e(l,{helpText:a("displayNameHelp"),fieldLabelId:"name"}),children:e(y,{id:"displayName",...t("displayName")})}),e(i,{label:a("type"),fieldId:"type",labelIcon:e(l,{helpText:a("resourceDetailsTypeHelp"),fieldLabelId:"type"}),children:e(y,{id:"type",...t("type")})}),e(i,{label:a("uris"),fieldId:"uris",labelIcon:e(l,{helpText:a("urisHelp"),fieldLabelId:"uris"}),children:e(ue,{name:"uris",type:"url","aria-label":a("uris"),addButtonLabel:"addUri"})}),e(fe,{clientId:s}),e(i,{label:a("iconUri"),fieldId:"iconUri",labelIcon:e(l,{helpText:a("iconUriHelp"),fieldLabelId:"iconUri"}),children:e(y,{id:"iconUri",type:"url",...t("icon_uri")})}),e(i,{hasNoPaddingTop:!0,label:a("ownerManagedAccess"),labelIcon:e(l,{helpText:a("ownerManagedAccessHelp"),fieldLabelId:"ownerManagedAccess"}),fieldId:"ownerManagedAccess",children:e(O,{name:"ownerManagedAccess",control:d,defaultValue:!1,render:({field:r})=>e(re,{id:"ownerManagedAccess",label:a("on"),labelOff:a("off"),isChecked:r.value,onChange:r.onChange,"aria-label":a("ownerManagedAccess")})})}),e(i,{hasNoPaddingTop:!0,label:a("resourceAttribute"),labelIcon:e(l,{helpText:a("resourceAttributeHelp"),fieldLabelId:"resourceAttribute"}),fieldId:"resourceAttribute",children:e(de,{name:"attributes",isDisabled:P})}),e(he,{children:w("div",{className:"pf-u-mt-md",children:[e(M,{variant:te.primary,type:"submit","data-testid":"save",children:a("save")}),e(M,{variant:"link","data-testid":"cancel",component:r=>e(se,{...r,to:H({realm:L,clientId:s,tab:"resources"})}),children:a("cancel")})]})})]})})})]}):e(Y,{})}export{Me as default};
//# sourceMappingURL=ResourceDetails-XwudVCjZ.js.map
