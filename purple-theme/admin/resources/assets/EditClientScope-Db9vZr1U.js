import{jsx as t,jsxs as S,Fragment as k}from"react/jsx-runtime";import{useState as w}from"react";import{u as j,c as L,b as N,e as U,af as q,q as H,B as _,f as s,A as l,al as z,U as G,D as J,P as f,am as T,an as Q,ao as W,N as X}from"./index-C9t2UlUN.js";import{c as Y,C as D,A as Z}from"./ClientScopeTypes-43MQv2_N.js";import{u as $}from"./ConfirmDialog-BDkqxnFL.js";import{R as ee}from"./AddRoleMappingModal-BWNuJU0W.js";import{R as te,u as oe}from"./RoutableTabs-vx5wTdby.js";import{V as ae}from"./ViewHeader-cxZm8XhN.js";import{u as ie}from"./useParams-DL8-63Ov.js";import{M as re}from"./MapperList-Caj0zikG.js";import{S as se}from"./ScopeForm-DuabtLW4.js";import{a as g,b as h}from"./Tabs-CjrDEqsl.js";import"react-dom";import"./Modal-Bgkd26UL.js";import"./PaginatingTableToolbar-oQUfBy2J.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./ToolbarContent-D6TJq6fk.js";import"./Form-Cdw1qhWG.js";import"./KeycloakDataTable-2rLFZPhG.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./filter-icon-C8nM2k1N.js";import"./PageHandler-TK8xnd8P.js";import"./DynamicComponents-D5DD9CFr.js";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./copy-icon-CYSS18Ce.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./useToggle-K3Kx99tM.js";import"./KeycloakTextInput-DrlF32nr.js";import"./DataListItemRow-Bimi62Tu.js";import"./FlexItem-BEayPdRt.js";import"./KeySelect-CPI9XGq0.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./KeycloakTextArea-DChmurIP.js";import"./PageList-59HC89eh.js";import"./utils-DeGqqWSp.js";import"./SwitchControl-KjYluOpZ.js";import"./FormAccess-DnQCcStE.js";import"./useIsFeatureEnabled-CkHhuO9z.js";import"./MenuList-Br-Zu33q.js";function Ze(){const{t:a}=j(),y=L(),{realm:m}=N(),{id:n}=ie(),{addAlert:c,addError:p}=U(),{enabled:M}=q(),[i,v]=w(),[C,A]=w(0),b=()=>A(C+1);H(async()=>{const e=await s.clientScopes.findOne({id:n});if(!e)throw new Error(a("notFound"));return{...e,type:await R(e)}},e=>{v(e)},[C,n]);async function R(e){return(await s.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?D.default:(await s.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?D.optional:Z.none}const d=e=>oe(W({realm:m,id:n,tab:e})),E=d("settings"),x=d("mappers"),I=d("scope"),P=async e=>{const o=X({...e,name:e.name?.trim().replace(/ /g,"_")});try{await s.clientScopes.update({id:n},o),await Y({...o,id:n},o.type),c(a("updateSuccessClientScope"),l.success)}catch(r){p("updateErrorClientScope",r)}},[V,B]=$({titleKey:a("deleteClientScope",{count:1,name:i?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:_.danger,onConfirm:async()=>{try{await s.clientScopes.del({id:n}),c(a("deletedSuccessClientScope"),l.success),y(z({realm:m}))}catch(e){p("deleteErrorClientScope",e)}}}),F=async e=>{try{const o=e.filter(r=>r.client===void 0).map(r=>r.role).flat();await s.clientScopes.addRealmScopeMappings({id:n},o),await Promise.all(e.filter(r=>r.client!==void 0).map(r=>s.clientScopes.addClientScopeMappings({id:n,client:r.client.id},[r.role]))),c(a("roleMappingUpdatedSuccess"),l.success)}catch(o){p("roleMappingUpdatedError",o)}},K=async e=>{if(Array.isArray(e))try{await s.clientScopes.addMultipleProtocolMappers({id:i.id},e),b(),c(a("mappingCreatedSuccess"),l.success)}catch(o){p("mappingCreatedError",o)}else{const o=e;y(T({realm:m,id:i.id,mapperId:o.id}))}},O=async e=>{try{await s.clientScopes.delProtocolMapper({id:i.id,mapperId:e.id}),c(a("mappingDeletedSuccess"),l.success),b()}catch(o){p("mappingDeletedError",o)}return!0};return i?S(k,{children:[t(B,{}),t(ae,{titleKey:i.name,dropdownItems:[t(J,{onClick:V,children:a("delete")},"delete")],badges:[{text:i.protocol}],divider:!1}),t(f,{variant:"light",className:"pf-u-p-0",children:S(te,{isBox:!0,children:[t(g,{id:"settings","data-testid":"settings",title:t(h,{children:a("settings")}),...E,children:t(f,{variant:"light",children:t(se,{save:P,clientScope:i})})}),t(g,{id:"mappers","data-testid":"mappers",title:t(h,{children:a("mappers")}),...x,children:t(re,{model:i,onAdd:K,onDelete:O,detailLink:e=>T({realm:m,id:i.id,mapperId:e})})}),S(g,{id:"scope","data-testid":"scopeTab",title:t(h,{children:a("scope")}),...I,children:[M&&t(f,{children:t(Q,{variant:"info",isInline:!0,title:a("clientScopesRolesScope"),component:"h2"})}),t(ee,{id:i.id,name:i.name,type:"clientScopes",save:F})]})]})})]}):t(G,{})}export{Ze as default};
//# sourceMappingURL=EditClientScope-Db9vZr1U.js.map
