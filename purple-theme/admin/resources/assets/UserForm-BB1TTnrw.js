import{jsx as e,jsxs as b,Fragment as G}from"react/jsx-runtime";import{useState as g,useEffect as ae}from"react";import{aR as E,b as te,q as D,f as I,h as T,L as M,d$ as ie,aS as re,bx as ne,a$ as U,e5 as se,u as H,a0 as o,a1 as A,a3 as q,I as le,J as de,S as oe,e as ce,V,e6 as ue,dz as me,aX as pe,a6 as fe,a7 as he,dk as be,A as j}from"./index-C9t2UlUN.js";import{F as ke}from"./FormAccess-DnQCcStE.js";import{G as Ae}from"./GroupPickerDialog-tI6XV7Ln.js";import{K as k}from"./KeycloakTextInput-DrlF32nr.js";import{u as ge}from"./useFormatDate-Yp0qEhJS.js";import{A as ve}from"./Form-Cdw1qhWG.js";const ye=({user:r})=>{const n=E(),{realm:t}=te(),[l,s]=g();return D(()=>n.hasAccess("view-realm")?I.components.findOne({id:r.federationLink||r.origin}):I.userStorageProvider.name({id:r.federationLink||r.origin}),s,[]),l?n.hasAccess("view-realm")?e(T,{variant:"link",component:u=>e(M,{...u,to:ie({id:l.id,providerId:l.providerId,realm:t})}),children:l.name}):e("span",{children:l.name}):null};function Ie(r){const n={};Object.entries(r.attributes||{}).forEach(([l,s])=>n[re(l)]=s);const t=ne(r.unmanagedAttributes);return{...r,attributes:n,unmanagedAttributes:t}}function Fe(r){const n=r.username?.trim(),t=Array.isArray(r.attributes)?U(r.attributes):Object.fromEntries(Object.entries(r.attributes||{}).map(([s,u])=>[se(s),u])),l=Array.isArray(r.unmanagedAttributes)?U(r.unmanagedAttributes):r.unmanagedAttributes;for(const s in l)if(t&&Object.hasOwn(t,s))throw Error(`Attribute ${s} is a managed attribute and is already available from the user details.`);return{...r,username:n,attributes:{...l,...t},unmanagedAttributes:void 0}}function Ne(r={},n={}){return Object.fromEntries(Object.entries(r).filter(([t])=>!Object.hasOwn(n,t)))}const Le=({control:r,name:n,label:t,help:l})=>{const{t:s}=H(),[u,w]=g(!1),[L,a]=g([]);return D(()=>I.authenticationManagement.getRequiredActions(),m=>{const d=m.filter(c=>c.enabled);a(d)},[]),e(o,{label:s(t),labelIcon:e(A,{helpText:s(l),fieldLabelId:"resetAction"}),fieldId:"actions",children:e(q,{name:n,defaultValue:[],control:r,render:({field:m})=>e(le,{maxHeight:375,toggleId:`${n}-actions`,variant:de.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:s("requiredActionPlaceholder"),menuAppendTo:"parent",onToggle:d=>w(d),isOpen:u,selections:m.value,onSelect:(d,c)=>{const f=m.value;m.onChange(f.find(v=>v===c)?f.filter(v=>v!==c):[...f,c])},onClear:d=>{d.stopPropagation(),m.onChange([])},typeAheadAriaLabel:s("resetAction"),children:L.map(({alias:d,name:c})=>e(oe,{value:d,"data-testid":`${d}-option`,children:c},d))})})})},Re=({form:r,realm:n,user:t,bruteForce:{isBruteForceProtected:l,isLocked:s}={isBruteForceProtected:!1,isLocked:!1},userProfileMetadata:u,save:w,onGroupsUpdate:L})=>{const{t:a}=H(),m=ge(),{addAlert:d,addError:c}=ce(),{hasAccess:f}=E(),v=f("manage-users"),P=f("view-realm"),{handleSubmit:$,register:x,setValue:F,watch:z,control:C,reset:B,formState:{errors:y}}=r,K=z("username"),[h,N]=g([]),[R,O]=g(!1),[S,J]=g(s);ae(()=>{F("requiredActions",t?.requiredActions||[])},[t,F]);const X=async()=>{try{await I.attackDetection.del({id:t.id}),d(a("unlockSuccess"),j.success)}catch(i){c("unlockError",i)}},_=i=>{N(h.filter(p=>p.name!==i)),L?.(h)},Q=async i=>{N([...h,...i]),L?.([...h,...i])},W=async i=>{i.forEach(async Z=>{try{await I.users.addToGroup({id:t.id,groupId:Z.id}),d(a("addedGroupMembership"),j.success)}catch(ee){c("addedGroupMembershipError",ee)}})},Y=()=>{O(!R)};return b(ke,{isHorizontal:!0,onSubmit:$(w),role:"query-users",fineGrainedAccess:t?.access?.manage,className:"pf-u-mt-lg",children:[R&&e(Ae,{type:"selectMany",text:{title:"selectGroups",ok:"join"},canBrowse:v,onConfirm:i=>{t?.id?W(i||[]):Q(i||[]),O(!1)},onClose:()=>O(!1),filterGroups:h}),t?.id&&b(G,{children:[e(o,{label:a("id"),fieldId:"kc-id",isRequired:!0,children:e(k,{id:t.id,"aria-label":a("userID"),value:t.id,type:"text",isReadOnly:!0})}),e(o,{label:a("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:e(k,{value:m(new Date(t.createdTimestamp)),type:"text",id:"kc-created-at","aria-label":a("createdAt"),name:"createdTimestamp",isReadOnly:!0})})]}),e(Le,{control:C,name:"requiredActions",label:"requiredUserActions",help:"requiredUserActionsHelp"}),(t?.federationLink||t?.origin)&&P&&e(o,{label:a("federationLink"),labelIcon:e(A,{helpText:a("federationLinkHelp"),fieldLabelId:"federationLink"}),children:e(ye,{user:t})}),u?b(G,{children:[e(o,{label:a("emailVerified"),fieldId:"kc-email-verified",helperTextInvalid:a("required"),labelIcon:e(A,{helpText:a("emailVerifiedHelp"),fieldLabelId:"emailVerified"}),children:e(q,{name:"emailVerified",defaultValue:!1,control:C,render:({field:i})=>e(V,{"data-testid":"email-verified-switch",id:"kc-user-email-verified",onChange:p=>i.onChange(p),isChecked:i.value,label:a("yes"),labelOff:a("no")})})}),e(ue,{form:r,userProfileMetadata:u,hideReadOnly:!t,supportedLocales:n.supportedLocales||[],t:(i,p)=>a(i,p)})]}):b(G,{children:[!n.registrationEmailAsUsername&&e(o,{label:a("username"),fieldId:"kc-username",isRequired:!0,validated:y.username?"error":"default",helperTextInvalid:a("required"),children:e(k,{id:"kc-username",isReadOnly:!!t?.id&&!n.editUsernameAllowed&&n.editUsernameAllowed!==void 0,...x("username")})}),e(o,{label:a("email"),fieldId:"kc-email",validated:y.email?"error":"default",helperTextInvalid:a("emailInvalid"),children:e(k,{type:"email",id:"kc-email","data-testid":"email-input",...x("email",{pattern:me})})}),e(o,{label:a("emailVerified"),fieldId:"kc-email-verified",helperTextInvalid:a("required"),labelIcon:e(A,{helpText:a("emailVerifiedHelp"),fieldLabelId:"emailVerified"}),children:e(q,{name:"emailVerified",defaultValue:!1,control:C,render:({field:i})=>e(V,{"data-testid":"email-verified-switch",id:"kc-user-email-verified",onChange:p=>i.onChange(p),isChecked:i.value,label:a("yes"),labelOff:a("no")})})}),e(o,{label:a("firstName"),fieldId:"kc-firstName",validated:y.firstName?"error":"default",helperTextInvalid:a("required"),children:e(k,{"data-testid":"firstName-input",id:"kc-firstName",...x("firstName")})}),e(o,{label:a("lastName"),fieldId:"kc-lastName",validated:y.lastName?"error":"default",children:e(k,{"data-testid":"lastName-input",id:"kc-lastName","aria-label":a("lastName"),...x("lastName")})})]}),l&&e(o,{label:a("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:e(A,{helpText:a("temporaryLockedHelp"),fieldLabelId:"temporaryLocked"}),children:e(V,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:i=>{X(),J(i)},isChecked:S,isDisabled:!S,label:a("on"),labelOff:a("off")})}),!t?.id&&e(o,{label:a("groups"),fieldId:"kc-groups",validated:y.requiredActions?"error":"default",helperTextInvalid:a("required"),labelIcon:e(A,{helpText:a("groups"),fieldLabelId:"groups"}),children:e(q,{name:"groups",defaultValue:[],control:C,render:()=>b(pe,{children:[e(fe,{categoryName:" ",children:h.map(i=>e(he,{onClick:()=>_(i.name),children:i.path},i.id))}),e(T,{id:"kc-join-groups-button",onClick:Y,variant:"secondary","data-testid":"join-groups-button",children:a("joinGroups")})]})})}),b(ve,{children:[e(T,{"data-testid":t?.id?"save-user":"create-user",isDisabled:!t?.id&&!K&&n.registrationEmailAsUsername===!1,variant:"primary",type:"submit",children:t?.id?a("save"):a("create")}),e(T,{"data-testid":"cancel-create-user",variant:"link",onClick:t?.id?()=>B(Ie(t)):void 0,component:t?.id?void 0:i=>e(M,{...i,to:be({realm:n.realm})}),children:t?.id?a("revert"):a("cancel")})]})]})};export{ye as F,Le as R,Re as U,Ie as a,Ne as f,Fe as t};
//# sourceMappingURL=UserForm-BB1TTnrw.js.map
