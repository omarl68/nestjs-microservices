import{jsx as e,jsxs as p,Fragment as O}from"react/jsx-runtime";import{u as q,a0 as b,bb as ee,bc as B,Z as M,a4 as H,q as U,f as G,U as re,F as z,a1 as S,a3 as A,I as D,J as W,S as P,ad as F,R,V as oe,bz as J,a as ae,g as te,h as L,B as se,ae as de,G as ue,H as ce,c as pe,e as me,P as he,aP as be,L as ve,dP as le,A as ge,M as fe,dY as ye}from"./index-C9t2UlUN.js";import{useState as T,useMemo as ke,useEffect as Ce}from"react";import{F as _,a as Te}from"./FormAccess-DnQCcStE.js";import{V as qe}from"./ViewHeader-cxZm8XhN.js";import{u as $}from"./useParams-DL8-63Ov.js";import{U as Se}from"./UserProfileContext-BGkDcTK6.js";import{K as Ve}from"./KeyValueInput-BJlDoGlu.js";/* empty css                               */import{D as Ne}from"./SwitchControl-KjYluOpZ.js";import{K as Q}from"./KeycloakTextInput-DrlF32nr.js";import{u as Ie}from"./ConfirmDialog-BDkqxnFL.js";import{u as ie}from"./useToggle-K3Kx99tM.js";import{D as Ae}from"./DynamicComponents-D5DD9CFr.js";import{M as xe,a as we}from"./Modal-Bgkd26UL.js";import{F as ne}from"./Form-Cdw1qhWG.js";import{a3 as Re,a4 as Pe,a5 as Y,a6 as K,a7 as Oe,a8 as j}from"./KeycloakDataTable-2rLFZPhG.js";import{i as Le}from"./isEqual-CVfl2lzU.js";import"react-dom";import"./copy-icon-CYSS18Ce.js";import"./ToolbarContent-D6TJq6fk.js";import"./KeySelect-CPI9XGq0.js";import"./EmptyStateBody-CyIhnUop.js";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./PaginatingTableToolbar-oQUfBy2J.js";import"./DataListItemRow-Bimi62Tu.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./FlexItem-BEayPdRt.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";const He=()=>{const{t:a}=q();return e(_,{role:"manage-realm",isHorizontal:!0,children:e(b,{hasNoPaddingTop:!0,label:a("annotations"),fieldId:"kc-annotations",className:"kc-annotations-label",children:e(ee,{className:"kc-annotations",children:e(B,{children:e(Ve,{name:"annotations",label:a("annotations"),defaultKeyValue:[{key:"inputType",label:a("inputType"),values:["text","textarea","select","select-radiobuttons","multiselect","multiselect-checkboxes","html5-email","html5-tel","html5-url","html5-number","html5-range","html5-datetime-local","html5-date","html5-month","html5-week","html5-time"]},{key:"inputHelperTextBefore",label:a("inputHelperTextBefore")},{key:"inputHelperTextAfter",label:a("inputHelperTextAfter")},{key:"inputOptionLabelsI18nPrefix",label:a("inputOptionLabelsI18nPrefix")},{key:"inputTypePlaceholder",label:a("inputTypePlaceholder")},{key:"inputTypeSize",label:a("inputTypeSize")},{key:"inputTypeCols",label:a("inputTypeCols")},{key:"inputTypeRows",label:a("inputTypeRows")},{key:"inputTypeStep",label:a("inputTypeStep")},{key:"kcNumberFormat",label:a("kcNumberFormat")},{key:"kcNumberUnFormat",label:a("kcNumberUnFormat")}]})})})})})},Z=[{label:"requiredForLabel.both",value:["admin","user"]},{label:"requiredForLabel.users",value:["user"]},{label:"requiredForLabel.admins",value:["admin"]}],De=()=>{const{t:a}=q(),l=M(),[o,r]=T(),[d,c]=T(),[m,h]=T(!1),[y,s]=T(!1),[v,g]=T(!1),{attributeName:u}=$(),n=!!u,f=H({control:l.control,name:"hasSelector"}),k=H({control:l.control,name:"hasRequiredScopes"}),N=H({control:l.control,name:"isRequired",defaultValue:!1});if(U(()=>G.clientScopes.find(),r,[]),U(()=>G.users.getProfile(),c,[]),!o)return e(re,{});function x(t){l.setValue("hasSelector",t)}function I(t){l.setValue("hasRequiredScopes",t)}return e(_,{role:"manage-realm",isHorizontal:!0,children:p(z,{...l,children:[e(b,{label:a("attributeName"),labelIcon:e(S,{helpText:a("upAttributeNameHelp"),fieldLabelId:"attributeName"}),fieldId:"kc-attribute-name",isRequired:!0,validated:l.formState.errors.name?"error":"default",helperTextInvalid:a("validateAttributeName"),children:e(Q,{isRequired:!0,id:"kc-attribute-name",defaultValue:"","data-testid":"attribute-name",isDisabled:n,validated:l.formState.errors.name?"error":"default",...l.register("name",{required:!0})})}),e(b,{label:a("attributeDisplayName"),labelIcon:e(S,{helpText:a("attributeDisplayNameHelp"),fieldLabelId:"attributeDisplayName"}),fieldId:"kc-attribute-display-name",children:e(Q,{id:"kc-attribute-display-name",defaultValue:"","data-testid":"attribute-display-name",...l.register("displayName")})}),e(Ne,{name:"multivalued",label:a("multivalued"),labelIcon:a("multivaluedHelp")}),e(b,{label:a("attributeGroup"),labelIcon:e(S,{helpText:a("attributeGroupHelp"),fieldLabelId:"realm-setting:attributeGroup"}),fieldId:"kc-attributeGroup",children:e(A,{name:"group",defaultValue:"",control:l.control,render:({field:t})=>e(D,{toggleId:"kc-attributeGroup","aria-label":a("attributeGroup"),onToggle:()=>g(!v),isOpen:v,onSelect:(i,w)=>{t.onChange(w.toString()),g(!1)},selections:[t.value||a("none")],variant:W.single,children:[e(P,{value:"",children:a("none")},"empty"),...d?.groups?.map(i=>e(P,{value:i.name,children:i.name},i.name))||[]]})})}),!Ke.includes(u)&&p(O,{children:[e(F,{}),p(b,{label:a("enabledWhen"),labelIcon:e(S,{helpText:a("enabledWhenTooltip"),fieldLabelId:"enabled-when"}),fieldId:"enabledWhen",hasNoPaddingTop:!0,children:[e(R,{id:"always","data-testid":"always",isChecked:!f,name:"enabledWhen",label:a("always"),onChange:()=>x(!1),className:"pf-u-mb-md"}),e(R,{id:"scopesAsRequested","data-testid":"scopesAsRequested",isChecked:f,name:"enabledWhen",label:a("scopesAsRequested"),onChange:()=>x(!0),className:"pf-u-mb-md"})]}),f&&e(b,{fieldId:"kc-scope-enabled-when",children:e(A,{name:"selector.scopes",control:l.control,defaultValue:[],render:({field:t})=>e(D,{name:"scopes","data-testid":"enabled-when-scope-field",variant:W.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:i=>h(i),selections:t.value,onSelect:(i,w)=>{const C=w.toString();let V=[""];t.value?V=t.value.includes(C)?t.value.filter(E=>E!==C):[...t.value,C]:V=[C],t.onChange(V)},onClear:i=>{i.stopPropagation(),t.onChange([])},isOpen:m,"aria-labelledby":"scope",children:o.map(i=>e(P,{value:i.name},i.name))})})})]}),u!=="username"&&p(O,{children:[e(F,{}),e(b,{label:a("required"),labelIcon:e(S,{helpText:a("requiredHelp"),fieldLabelId:"required"}),fieldId:"kc-required",hasNoPaddingTop:!0,children:e(A,{name:"isRequired","data-testid":"required",defaultValue:!1,control:l.control,render:({field:t})=>e(oe,{id:"kc-required",onChange:t.onChange,isChecked:t.value,label:a("on"),labelOff:a("off"),"aria-label":a("required")})})}),N&&p(O,{children:[e(b,{label:a("requiredFor"),fieldId:"requiredFor",hasNoPaddingTop:!0,children:e(A,{name:"required.roles","data-testid":"requiredFor",defaultValue:Z[0].value,control:l.control,render:({field:t})=>e("div",{className:"kc-requiredFor",children:Z.map(i=>e(R,{id:i.label,"data-testid":i.label,isChecked:Le(t.value,i.value),name:"roles",onChange:()=>{t.onChange(i.value)},label:a(i.label),className:"kc-requiredFor-option"},i.label))})})}),p(b,{label:a("requiredWhen"),labelIcon:e(S,{helpText:a("requiredWhenTooltip"),fieldLabelId:"required-when"}),fieldId:"requiredWhen",hasNoPaddingTop:!0,children:[e(R,{id:"requiredAlways","data-testid":"requiredAlways",isChecked:!k,name:"requiredWhen",label:a("always"),onChange:()=>I(!1),className:"pf-u-mb-md"}),e(R,{id:"requiredScopesAsRequested","data-testid":"requiredScopesAsRequested",isChecked:k,name:"requiredWhen",label:a("scopesAsRequested"),onChange:()=>I(!0),className:"pf-u-mb-md"})]}),k&&e(b,{fieldId:"kc-scope-required-when",children:e(A,{name:"required.scopes",control:l.control,defaultValue:[],render:({field:t})=>e(D,{name:"scopeRequired","data-testid":"required-when-scope-field",variant:W.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:i=>s(i),selections:t.value,onSelect:(i,w)=>{const C=w.toString();let V=[""];t.value?V=t.value.includes(C)?t.value.filter(E=>E!==C):[...t.value,C]:V=[C],t.onChange(V)},onClear:i=>{i.stopPropagation(),t.onChange([])},isOpen:y,"aria-labelledby":"scope",children:o.map(i=>e(P,{value:i.name},i.name))})})})]})]})]})})},X=({name:a})=>{const{t:l}=q(),{control:o}=M();return e(ee,{children:e(A,{name:`permissions.${a}`,control:o,defaultValue:[],render:({field:r})=>p(O,{children:[e(B,{lg:4,sm:6,children:e(J,{id:`user-${a}`,label:l("user"),value:"user","data-testid":`user-${a}`,isChecked:r.value.includes("user"),onChange:()=>{const d="user",c=r.value.includes(d)?r.value.filter(m=>m!==d):[...r.value,d];r.onChange(c)}})}),e(B,{lg:8,sm:6,children:e(J,{id:`admin-${a}`,label:l("admin"),value:"admin","data-testid":`admin-${a}`,isChecked:r.value.includes("admin"),onChange:()=>{const d="admin",c=r.value.includes(d)?r.value.filter(m=>m!==d):[...r.value,d];r.onChange(c)}})})]})})})},Ge=()=>{const{t:a}=q();return p(_,{role:"manage-realm",isHorizontal:!0,children:[e(b,{hasNoPaddingTop:!0,label:a("whoCanEdit"),labelIcon:e(S,{helpText:a("whoCanEditHelp"),fieldLabelId:"whoCanEdit"}),fieldId:"kc-who-can-edit",children:e(X,{name:"edit"})}),e(b,{hasNoPaddingTop:!0,label:a("whoCanView"),labelIcon:e(S,{helpText:a("whoCanViewHelp"),fieldLabelId:"whoCanView"}),fieldId:"kc-who-can-view",children:e(X,{name:"view"})})]})},Me=({selectedValidators:a,onChange:l})=>{const{t:o}=q(),r=ae().componentTypes?.["org.keycloak.validate.Validator"]||[],d=ke(()=>r.filter(({id:s})=>!a.includes(s)),[a]),[c,m]=ie(),[h,y]=T();return e(b,{label:o("validatorType"),fieldId:"validator",children:e(D,{toggleId:"validator",onToggle:m,onSelect:(s,v)=>{const g=v;l(g),y(g),m()},selections:h?.id,variant:"single","aria-label":o("selectOne"),isOpen:c,placeholderText:o("choose"),menuAppendTo:"parent",maxHeight:300,children:d.map(s=>e(P,{selected:h?.id===s.id,value:s,description:s.helpText,children:s.id},s.id))})})},Ee=({selectedValidators:a,toggleDialog:l,onConfirm:o})=>{const{t:r}=q(),[d,c]=T(),m=ae().componentTypes?.["org.keycloak.validate.Validator"].length===a.length,h=te(),{handleSubmit:y}=h,s=v=>{o({...v,id:d?.id}),l()};return e(xe,{variant:we.small,title:r("addValidator"),isOpen:!0,onClose:l,actions:[e(L,{"data-testid":"save-validator-role-button",variant:"primary",type:"submit",form:"add-validator",children:r("save")},"save"),e(L,{"data-testid":"cancel-validator-role-button",variant:"link",onClick:l,children:r("cancel")},"cancel")],children:m?r("emptyValidators"):p(ne,{id:"add-validator",onSubmit:y(s),children:[e(Me,{selectedValidators:a.map(v=>v.key),onChange:c}),d&&e(z,{...h,children:e(Ae,{properties:d.properties})})]})})},We=()=>{const{t:a}=q(),[l,o]=ie(),[r,d]=T(),{setValue:c,control:m,register:h,getValues:y}=M(),s=H({name:"validations",control:m,defaultValue:[]});Ce(()=>{h("validations")},[h]);const[v,g]=Ie({titleKey:a("deleteValidatorConfirmTitle"),messageKey:a("deleteValidatorConfirmMsg",{validatorName:r}),continueButtonLabel:"delete",continueButtonVariant:se.danger,onConfirm:async()=>{const u=s.filter(n=>n.key!==r);c("validations",[...u])}});return p(O,{children:[l&&e(Ee,{selectedValidators:s,onConfirm:u=>{const n=y("annotations");u.id==="options"&&!n.find(f=>f.key==="inputType")&&c("annotations",[...n,{key:"inputType",value:"select"}]),c("validations",[...s,{key:u.id,value:u.config}])},toggleDialog:o}),e(g,{}),p("div",{className:"kc-attributes-validations",children:[e(L,{id:"addValidator",onClick:()=>o(),variant:"link","data-testid":"addValidator",className:"kc--attributes-validations--add-validation-button",icon:e(de,{}),children:a("addValidator")}),e(F,{}),s.length!==0?p(Re,{children:[e(Pe,{children:p(Y,{children:[e(K,{children:a("validatorColNames.colName")}),e(K,{children:a("validatorColNames.colConfig")}),e(K,{"aria-hidden":"true"})]})}),e(Oe,{children:s.map(u=>p(Y,{children:[e(j,{dataLabel:a("validatorColNames.colName"),children:u.key}),e(j,{dataLabel:a("validatorColNames.colConfig"),children:JSON.stringify(u.value)}),e(j,{className:"kc--attributes-validations--action-cell",children:e(L,{variant:"link","data-testid":"deleteValidator",onClick:()=>{v(),d(u.key)},children:a("delete")},"validator")})]},u.key))})]}):e(ue,{className:"kc-emptyValidators",component:ce.p,children:a("emptyValidators")})]})]})},Ke=["username","email"],je=({save:a})=>{const{t:l}=q(),o=M(),{realm:r,attributeName:d}=$(),c=!!d;return p(Se,{children:[e(be,{label:l("jumpToSection"),sections:[{title:l("generalSettings"),panel:e(De,{})},{title:l("permission"),panel:e(Ge,{})},{title:l("validations"),panel:e(We,{})},{title:l("annotations"),panel:e(He,{})}]}),e(ne,{onSubmit:o.handleSubmit(a),children:p(Te,{name:"attribute-settings",children:[e(L,{variant:"primary",type:"submit","data-testid":"attribute-create",children:l(c?"save":"create")}),e(ve,{to:le({realm:r,tab:"attributes"}),"data-testid":"attribute-cancel",className:"kc-attributeCancel",children:l("cancel")})]})})]})};function Na(){const{realm:a,attributeName:l}=$(),o=te(),{t:r}=q(),d=pe(),{addAlert:c,addError:m}=me(),[h,y]=T(null),s=!!l;U(()=>G.users.getProfile(),g=>{y(g);const{annotations:u,validations:n,permissions:f,selector:k,required:N,multivalued:x,...I}=g.attributes.find(t=>t.name===l)||{permissions:{edit:["admin"]}};fe({...I,hasSelector:typeof k<"u",hasRequiredScopes:typeof N?.scopes<"u"},o.setValue),Object.entries(ye({permissions:f,selector:k,required:N},{safe:!0})).map(([t,i])=>o.setValue(t,i)),o.setValue("annotations",Object.entries(u||{}).map(([t,i])=>({key:t,value:i}))),o.setValue("validations",Object.entries(n||{}).map(([t,i])=>({key:t,value:i}))),o.setValue("isRequired",N!==void 0),o.setValue("multivalued",x===!0)},[]);const v=async({hasSelector:g,hasRequiredScopes:u,...n})=>{g||delete n.selector,u||delete n.required?.scopes;const f=n.validations.reduce((t,i)=>(t[i.key]=i.value||{},t),{}),k=n.annotations.reduce((t,i)=>Object.assign(t,{[i.key]:i.value}),{}),I=s?h?.attributes.map(t=>t.name!==l?t:(delete t.required,Object.assign({...t,name:l,displayName:n.displayName,selector:n.selector,permissions:n.permissions,multivalued:n.multivalued,annotations:k,validations:f},n.isRequired?{required:n.required}:void 0,n.group?{group:n.group}:{group:null}))):h?.attributes.concat([Object.assign({name:n.name,displayName:n.displayName,required:n.isRequired?n.required:void 0,selector:n.selector,permissions:n.permissions,multivalued:n.multivalued,annotations:k,validations:f},n.isRequired?{required:n.required}:void 0,n.group?{group:n.group}:void 0)]);try{await G.users.updateProfile({...h,attributes:I,realm:a}),d(le({realm:a,tab:"attributes"})),c(r("createAttributeSuccess"),ge.success)}catch(t){m("createAttributeError",t)}};return p(z,{...o,children:[e(qe,{titleKey:s?l:r("createAttribute"),subKey:s?"":r("createAttributeSubTitle")}),e(he,{variant:"light",children:e(je,{save:()=>o.handleSubmit(v)()})})]})}export{Ke as USERNAME_EMAIL,Na as default};
//# sourceMappingURL=NewAttributeSettings-7-pY9D_a.js.map
