{"version":3,"file":"CustomProviderSettings-Bi_IzEZW.js","sources":["../../src/user-federation/custom/SyncSettings.tsx","../../src/user-federation/custom/CustomProviderSettings.tsx"],"sourcesContent":["import { FormGroup, Switch } from \"@patternfly/react-core\";\nimport { Controller, useFormContext } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { HelpItem } from \"ui-shared\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\n\nexport const SyncSettings = () => {\n  const { t } = useTranslation();\n  const { control, register, watch } = useFormContext();\n  const watchPeriodicSync = watch(\"config.fullSyncPeriod\", \"-1\");\n  const watchChangedSync = watch(\"config.changedSyncPeriod\", \"-1\");\n\n  return (\n    <>\n      <FormGroup\n        label={t(\"periodicFullSync\")}\n        labelIcon={\n          <HelpItem\n            helpText={t(\"periodicFullSyncHelp\")}\n            fieldLabelId=\"periodicFullSync\"\n          />\n        }\n        fieldId=\"kc-periodic-full-sync\"\n        hasNoPaddingTop\n      >\n        <Controller\n          name=\"config.fullSyncPeriod\"\n          defaultValue=\"-1\"\n          control={control}\n          render={({ field }) => (\n            <Switch\n              id=\"kc-periodic-full-sync\"\n              data-testid=\"periodic-full-sync\"\n              onChange={(value) => {\n                field.onChange(value ? \"604800\" : \"-1\");\n              }}\n              isChecked={field.value !== \"-1\"}\n              label={t(\"on\")}\n              labelOff={t(\"off\")}\n              aria-label={t(\"periodicFullSync\")}\n            />\n          )}\n        />\n      </FormGroup>\n      {watchPeriodicSync !== \"-1\" && (\n        <FormGroup\n          hasNoPaddingTop\n          label={t(\"fullSyncPeriod\")}\n          labelIcon={\n            <HelpItem\n              helpText={t(\"fullSyncPeriodHelp\")}\n              fieldLabelId=\"fullSyncPeriod\"\n            />\n          }\n          fieldId=\"kc-full-sync-period\"\n        >\n          <KeycloakTextInput\n            type=\"number\"\n            min={-1}\n            defaultValue=\"604800\"\n            id=\"kc-full-sync-period\"\n            data-testid=\"full-sync-period\"\n            {...register(\"config.fullSyncPeriod\")}\n          />\n        </FormGroup>\n      )}\n      <FormGroup\n        label={t(\"periodicChangedUsersSync\")}\n        labelIcon={\n          <HelpItem\n            helpText={t(\"periodicChangedUsersSyncHelp\")}\n            fieldLabelId=\"periodicChangedUsersSync\"\n          />\n        }\n        fieldId=\"kc-periodic-changed-users-sync\"\n        hasNoPaddingTop\n      >\n        <Controller\n          name=\"config.changedSyncPeriod\"\n          defaultValue=\"-1\"\n          control={control}\n          render={({ field }) => (\n            <Switch\n              id=\"kc-periodic-changed-users-sync\"\n              data-testid=\"periodic-changed-users-sync\"\n              onChange={(value) => {\n                field.onChange(value ? \"86400\" : \"-1\");\n              }}\n              isChecked={field.value !== \"-1\"}\n              label={t(\"on\")}\n              labelOff={t(\"off\")}\n              aria-label={t(\"periodicChangedUsersSync\")}\n            />\n          )}\n        />\n      </FormGroup>\n      {watchChangedSync !== \"-1\" && (\n        <FormGroup\n          label={t(\"changedUsersSyncPeriod\")}\n          labelIcon={\n            <HelpItem\n              helpText={t(\"changedUsersSyncHelp\")}\n              fieldLabelId=\"changedUsersSyncPeriod\"\n            />\n          }\n          fieldId=\"kc-changed-users-sync-period\"\n          hasNoPaddingTop\n        >\n          <KeycloakTextInput\n            type=\"number\"\n            min={-1}\n            defaultValue=\"86400\"\n            id=\"kc-changed-users-sync-period\"\n            data-testid=\"changed-users-sync-period\"\n            {...register(\"config.changedSyncPeriod\")}\n          />\n        </FormGroup>\n      )}\n    </>\n  );\n};\n","import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\nimport {\n  ActionGroup,\n  AlertVariant,\n  Button,\n  FormGroup,\n  PageSection,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { HelpItem } from \"ui-shared\";\n\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { DynamicComponents } from \"../../components/dynamic/DynamicComponents\";\nimport { FormAccess } from \"../../components/form/FormAccess\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { useServerInfo } from \"../../context/server-info/ServerInfoProvider\";\nimport { convertFormValuesToObject, convertToFormValues } from \"../../util\";\nimport { useFetch } from \"../../utils/useFetch\";\nimport { useParams } from \"../../utils/useParams\";\nimport type { CustomUserFederationRouteParams } from \"../routes/CustomUserFederation\";\nimport { toUserFederation } from \"../routes/UserFederation\";\nimport { ExtendedHeader } from \"../shared/ExtendedHeader\";\nimport { SettingsCache } from \"../shared/SettingsCache\";\nimport { SyncSettings } from \"./SyncSettings\";\n\nimport { adminClient } from \"../../admin-client\";\nimport \"./custom-provider-settings.css\";\n\nexport default function CustomProviderSettings() {\n  const { t } = useTranslation();\n  const { id, providerId } = useParams<CustomUserFederationRouteParams>();\n  const navigate = useNavigate();\n  const form = useForm<ComponentRepresentation>({\n    mode: \"onChange\",\n  });\n  const {\n    register,\n    reset,\n    setValue,\n    handleSubmit,\n    formState: { errors, isDirty },\n  } = form;\n\n  const { addAlert, addError } = useAlerts();\n  const { realm: realmName } = useRealm();\n  const [parentId, setParentId] = useState(\"\");\n\n  const provider = (\n    useServerInfo().componentTypes?.[\n      \"org.keycloak.storage.UserStorageProvider\"\n    ] || []\n  ).find((p) => p.id === providerId);\n\n  useFetch(\n    async () => {\n      if (id) {\n        return await adminClient.components.findOne({ id });\n      }\n      return undefined;\n    },\n    (fetchedComponent) => {\n      if (fetchedComponent) {\n        convertToFormValues(fetchedComponent, setValue);\n      } else if (id) {\n        throw new Error(t(\"notFound\"));\n      }\n    },\n    [],\n  );\n\n  useFetch(\n    () =>\n      adminClient.realms.findOne({\n        realm: realmName,\n      }),\n    (realm) => setParentId(realm?.id!),\n    [],\n  );\n\n  const save = async (component: ComponentRepresentation) => {\n    const saveComponent = convertFormValuesToObject({\n      ...component,\n      config: Object.fromEntries(\n        Object.entries(component.config || {}).map(([key, value]) => [\n          key,\n          Array.isArray(value) ? value : [value],\n        ]),\n      ),\n      providerId,\n      providerType: \"org.keycloak.storage.UserStorageProvider\",\n      parentId,\n    });\n\n    try {\n      if (!id) {\n        await adminClient.components.create(saveComponent);\n        navigate(toUserFederation({ realm: realmName }));\n      } else {\n        await adminClient.components.update({ id }, saveComponent);\n      }\n      reset({ ...component });\n      addAlert(\n        t(!id ? \"createUserProviderSuccess\" : \"userProviderSaveSuccess\"),\n        AlertVariant.success,\n      );\n    } catch (error) {\n      addError(\n        `${!id ? \"createUserProviderError\" : \"userProviderSaveError\"}`,\n        error,\n      );\n    }\n  };\n\n  return (\n    <FormProvider {...form}>\n      <ExtendedHeader provider={providerId} save={() => handleSubmit(save)()} />\n      <PageSection variant=\"light\">\n        <FormAccess\n          role=\"manage-realm\"\n          isHorizontal\n          className=\"keycloak__user-federation__custom-form\"\n          onSubmit={handleSubmit(save)}\n        >\n          <FormGroup\n            label={t(\"uiDisplayName\")}\n            labelIcon={\n              <HelpItem\n                helpText={t(\"uiDisplayNameHelp\")}\n                fieldLabelId=\"uiDisplayName\"\n              />\n            }\n            helperTextInvalid={t(\"validateName\")}\n            validated={errors.name ? \"error\" : \"default\"}\n            fieldId=\"kc-ui-display-name\"\n            isRequired\n          >\n            <KeycloakTextInput\n              isRequired\n              id=\"kc-ui-display-name\"\n              data-testid=\"ui-name\"\n              validated={errors.name ? \"error\" : \"default\"}\n              {...register(\"name\", {\n                required: true,\n              })}\n            />\n          </FormGroup>\n          <FormProvider {...form}>\n            <DynamicComponents properties={provider?.properties || []} />\n            {provider?.metadata.synchronizable && <SyncSettings />}\n          </FormProvider>\n          <SettingsCache form={form} unWrap />\n          <ActionGroup>\n            <Button\n              isDisabled={!isDirty}\n              variant=\"primary\"\n              type=\"submit\"\n              data-testid=\"custom-save\"\n            >\n              {t(\"save\")}\n            </Button>\n            <Button\n              variant=\"link\"\n              component={(props) => (\n                <Link {...props} to={toUserFederation({ realm: realmName })} />\n              )}\n              data-testid=\"custom-cancel\"\n            >\n              {t(\"cancel\")}\n            </Button>\n          </ActionGroup>\n        </FormAccess>\n      </PageSection>\n    </FormProvider>\n  );\n}\n"],"names":["SyncSettings","t","useTranslation","control","register","watch","useFormContext","watchPeriodicSync","watchChangedSync","jsxs","Fragment","jsx","FormGroup","HelpItem","Controller","field","Switch","value","KeycloakTextInput","CustomProviderSettings","id","providerId","useParams","navigate","useNavigate","form","useForm","reset","setValue","handleSubmit","errors","isDirty","addAlert","addError","useAlerts","realmName","useRealm","parentId","setParentId","useState","provider","useServerInfo","p","useFetch","adminClient","fetchedComponent","convertToFormValues","realm","save","component","saveComponent","convertFormValuesToObject","key","toUserFederation","AlertVariant","error","FormProvider","ExtendedHeader","PageSection","FormAccess","DynamicComponents","SettingsCache","ActionGroup","Button","props","Link"],"mappings":"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"}