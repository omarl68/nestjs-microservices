import{jsx as e,jsxs as m,Fragment as G}from"react/jsx-runtime";import{useState as g}from"react";import{g as U,c as $,b as z,u as J,e as W,q as _,B as Q,f as c,A as x,e1 as M,a4 as X,U as Y,D,P as Z,a0 as h,a1 as w,a2 as K,a3 as ee,I as ae,J as re,S as te,F as pe,h as O,M as oe,N as ie}from"./index-C9t2UlUN.js";import{u as ne}from"./ConfirmDialog-BDkqxnFL.js";import{c as se,D as de}from"./DynamicComponents-D5DD9CFr.js";import{F as le}from"./FormAccess-DnQCcStE.js";import{K as u}from"./KeycloakTextInput-DrlF32nr.js";import{V as ce}from"./ViewHeader-cxZm8XhN.js";import{u as me}from"./useParams-DL8-63Ov.js";import{F as ue,A as ye}from"./Form-Cdw1qhWG.js";import"react-dom";import"./Modal-Bgkd26UL.js";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./copy-icon-CYSS18Ce.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./PaginatingTableToolbar-oQUfBy2J.js";import"./ToolbarContent-D6TJq6fk.js";import"./useToggle-K3Kx99tM.js";import"./DataListItemRow-Bimi62Tu.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./FlexItem-BEayPdRt.js";import"./KeySelect-CPI9XGq0.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./KeycloakDataTable-2rLFZPhG.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";function Je(){const p=U(),[s,P]=g(),[y,q]=g(),{id:k,mapperId:i}=me(),f=$(),{realm:I}=z(),{t:a}=J(),{addAlert:T,addError:S}=W(),[F,A]=g(!1),[C,E]=g(0),R=()=>E(C+1);_(async()=>{const r=await c.components.listSubComponents({id:k,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(i&&i!=="new"){const t=await c.components.findOne({id:i});return{components:r,fetchedMapper:t}}return{components:r}},({components:r,fetchedMapper:t})=>{if(P(t),q(r),i!=="new"&&!t)throw new Error(a("notFound"));t&&b(t)},[]);const b=r=>{oe(r,p.setValue)},j=async r=>{const t=ie(r),l={...t,config:Object.entries(t.config||{}).reduce((o,[N,v])=>(o[N]=Array.isArray(v)?v:[v],o),{})};try{i==="new"?(await c.components.create(l),f(M({realm:I,id:r.parentId,tab:"mappers"}))):await c.components.update({id:i},l),b(l),T(a(i==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),x.success)}catch(o){S(i==="new"?"mappingCreatedError":"mappingUpdatedError",o)}},V=async r=>{try{const t=await c.userStorageProvider.mappersSync({parentId:s?.parentId||"",id:i,direction:r});T(a("syncLDAPGroupsSuccessful",{result:t.status}))}catch(t){S("syncLDAPGroupsError",t)}R()},[B,H]=ne({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:Q.danger,onConfirm:async()=>{try{await c.components.del({id:s.id}),T(a("mappingDeletedSuccess"),x.success),f(M({id:k,realm:I,tab:"mappers"}))}catch(r){S("mappingDeletedError",r)}}}),L=X({control:p.control,name:"providerId"});if(!y)return e(Y,{});const d=i==="new",n=y.find(r=>r.id===L);return m(G,{children:[e(H,{}),e(ce,{titleKey:s?s.name:a("createNewMapper"),dropdownItems:d?void 0:[e(D,{onClick:B,children:a("delete")},"delete"),...n?.metadata.fedToKeycloakSyncSupported?[e(D,{onClick:()=>V("fedToKeycloak"),children:a(n.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...n?.metadata.keycloakToFedSyncSupported?[e(D,{onClick:()=>{V("keycloakToFed")},children:a(n.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},C),m(Z,{variant:"light",isFilled:!0,children:[m(le,{role:"manage-realm",isHorizontal:!0,children:[!d&&e(h,{label:a("id"),fieldId:"kc-ldap-mapper-id",children:e(u,{isDisabled:!0,id:"kc-ldap-mapper-id","data-testid":"ldap-mapper-id",...p.register("id")})}),m(h,{label:a("name"),labelIcon:e(w,{helpText:a("nameHelp"),fieldLabelId:"name"}),fieldId:"kc-ldap-mapper-name",isRequired:!0,children:[e(u,{isDisabled:!d,isRequired:!0,id:"kc-ldap-mapper-name","data-testid":"ldap-mapper-name",validated:p.formState.errors.name?K.error:K.default,...p.register("name",{required:!0})}),e(u,{hidden:!0,defaultValue:d?k:s?s.parentId:"",id:"kc-ldap-parentId","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),e(u,{hidden:!0,defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper",id:"kc-ldap-provider-type","data-testid":"ldap-mapper-provider-type",...p.register("providerType")})]}),d?e(h,{label:a("mapperType"),labelIcon:e(w,{helpText:n?.helpText?n.helpText:a("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:e(ee,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:r})=>e(ae,{toggleId:"kc-providerId",typeAheadAriaLabel:a("mapperType"),required:!0,onToggle:()=>A(!F),isOpen:F,onSelect:(t,l)=>{b({providerId:l,...Object.fromEntries(y.find(o=>o.id===l)?.properties.filter(o=>o.type==="List").map(o=>[se(o.name),o.options?.[0]])||[])}),A(!1)},selections:r.value,variant:re.typeahead,"aria-label":a("selectMapperType"),children:y.map(t=>e(te,{value:t.id},t.id))})})}):e(h,{label:a("mapperType"),labelIcon:e(w,{helpText:n?.helpText?n.helpText:a("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-ldap-mapper-type",isRequired:!0,children:e(u,{isDisabled:!d,isRequired:!0,id:"kc-ldap-mapper-type","data-testid":"ldap-mapper-type-fld",...p.register("providerId")})}),e(pe,{...p,children:!!L&&e(de,{properties:n?.properties})})]}),e(ue,{onSubmit:p.handleSubmit(()=>j(p.getValues())),children:m(ye,{children:[e(O,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:a("save")}),e(O,{variant:"link",onClick:()=>f(d?-1:`/${I}/user-federation/ldap/${s.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:a("cancel")})]})})]})]})}export{Je as default};
//# sourceMappingURL=LdapMapperDetails-BuCMBMnR.js.map
