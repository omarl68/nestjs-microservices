{"version":3,"file":"DetailProvider-CXr6Yngr.js","sources":["../../src/clients/registration/DetailProvider.tsx"],"sourcesContent":["import ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\nimport ComponentTypeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentTypeRepresentation\";\nimport {\n  ActionGroup,\n  Button,\n  ButtonVariant,\n  DropdownItem,\n  FormGroup,\n  PageSection,\n  ValidatedOptions,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { FormProvider, useForm, useWatch } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { HelpItem } from \"ui-shared\";\n\nimport { adminClient } from \"../../admin-client\";\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\nimport { DynamicComponents } from \"../../components/dynamic/DynamicComponents\";\nimport { FormAccess } from \"../../components/form/FormAccess\";\nimport { KeycloakSpinner } from \"../../components/keycloak-spinner/KeycloakSpinner\";\nimport { KeycloakTextInput } from \"../../components/keycloak-text-input/KeycloakTextInput\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { useFetch } from \"../../utils/useFetch\";\nimport { useParams } from \"../../utils/useParams\";\nimport {\n  RegistrationProviderParams,\n  toRegistrationProvider,\n} from \"../routes/AddRegistrationProvider\";\nimport { toClientRegistration } from \"../routes/ClientRegistration\";\n\nexport default function DetailProvider() {\n  const { t } = useTranslation();\n  const { id, providerId, subTab } = useParams<RegistrationProviderParams>();\n  const navigate = useNavigate();\n  const form = useForm<ComponentRepresentation>({\n    defaultValues: { providerId },\n  });\n  const {\n    register,\n    control,\n    handleSubmit,\n    reset,\n    formState: { errors },\n  } = form;\n\n  const { realm } = useRealm();\n  const { addAlert, addError } = useAlerts();\n  const [provider, setProvider] = useState<ComponentTypeRepresentation>();\n  const [parentId, setParentId] = useState(\"\");\n\n  useFetch(\n    async () =>\n      await Promise.all([\n        adminClient.realms.getClientRegistrationPolicyProviders({ realm }),\n        adminClient.realms.findOne({ realm }),\n        id ? adminClient.components.findOne({ id }) : Promise.resolve(),\n      ]),\n    ([providers, realm, data]) => {\n      setProvider(providers.find((p) => p.id === providerId));\n      setParentId(realm?.id || \"\");\n      reset(data || { providerId });\n    },\n    [],\n  );\n\n  const providerName = useWatch({ control, defaultValue: \"\", name: \"name\" });\n\n  const onSubmit = async (component: ComponentRepresentation) => {\n    if (component.config)\n      Object.entries(component.config).forEach(\n        ([key, value]) =>\n          (component.config![key] = Array.isArray(value) ? value : [value]),\n      );\n    try {\n      const updatedComponent = {\n        ...component,\n        subType: subTab,\n        parentId,\n        providerType:\n          \"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy\",\n        providerId,\n      };\n      if (id) {\n        await adminClient.components.update({ id }, updatedComponent);\n      } else {\n        const { id } = await adminClient.components.create(updatedComponent);\n        navigate(toRegistrationProvider({ id, realm, subTab, providerId }));\n      }\n      addAlert(t(`provider${id ? \"Updated\" : \"Create\"}Success`));\n    } catch (error) {\n      addError(`provider${id ? \"Updated\" : \"Create\"}Error`, error);\n    }\n  };\n\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\n    titleKey: \"clientRegisterPolicyDeleteConfirmTitle\",\n    messageKey: t(\"clientRegisterPolicyDeleteConfirm\", {\n      name: providerName,\n    }),\n    continueButtonLabel: \"delete\",\n    continueButtonVariant: ButtonVariant.danger,\n    onConfirm: async () => {\n      try {\n        await adminClient.components.del({\n          realm,\n          id: id!,\n        });\n        addAlert(t(\"clientRegisterPolicyDeleteSuccess\"));\n        navigate(toClientRegistration({ realm, subTab }));\n      } catch (error) {\n        addError(\"clientRegisterPolicyDeleteError\", error);\n      }\n    },\n  });\n\n  if (!provider) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <>\n      <ViewHeader\n        titleKey={id ? providerName! : \"createPolicy\"}\n        subKey={id}\n        dropdownItems={\n          id\n            ? [\n                <DropdownItem\n                  data-testid=\"delete\"\n                  key=\"delete\"\n                  onClick={toggleDeleteDialog}\n                >\n                  {t(\"delete\")}\n                </DropdownItem>,\n              ]\n            : undefined\n        }\n      />\n      <DeleteConfirm />\n      <PageSection variant=\"light\">\n        <FormAccess\n          role=\"manage-clients\"\n          isHorizontal\n          onSubmit={handleSubmit(onSubmit)}\n        >\n          <FormGroup label={t(\"provider\")} fieldId=\"provider\">\n            <KeycloakTextInput\n              id=\"providerId\"\n              data-testid=\"providerId\"\n              aria-label={t(\"providerId\")}\n              {...register(\"providerId\")}\n              readOnly\n            />\n          </FormGroup>\n          <FormGroup\n            label={t(\"name\")}\n            fieldId=\"kc-name\"\n            helperTextInvalid={t(\"required\")}\n            validated={\n              errors.name ? ValidatedOptions.error : ValidatedOptions.default\n            }\n            labelIcon={\n              <HelpItem\n                helpText={t(\"clientPolicyNameHelp\")}\n                fieldLabelId=\"kc-name\"\n              />\n            }\n            isRequired\n          >\n            <KeycloakTextInput\n              id=\"kc-name\"\n              data-testid=\"name\"\n              validated={\n                errors.name ? ValidatedOptions.error : ValidatedOptions.default\n              }\n              {...register(\"name\", { required: true })}\n            />\n          </FormGroup>\n          <FormProvider {...form}>\n            <DynamicComponents properties={provider.properties} />\n          </FormProvider>\n          <ActionGroup>\n            <Button data-testid=\"save\" type=\"submit\">\n              {t(\"save\")}\n            </Button>\n            <Button\n              variant=\"link\"\n              component={(props) => (\n                <Link\n                  {...props}\n                  to={toClientRegistration({ realm, subTab })}\n                ></Link>\n              )}\n            >\n              {t(\"cancel\")}\n            </Button>\n          </ActionGroup>\n        </FormAccess>\n      </PageSection>\n    </>\n  );\n}\n"],"names":["DetailProvider","t","useTranslation","id","providerId","subTab","useParams","navigate","useNavigate","form","useForm","register","control","handleSubmit","reset","errors","realm","useRealm","addAlert","addError","useAlerts","provider","setProvider","useState","parentId","setParentId","useFetch","adminClient","providers","data","p","providerName","useWatch","onSubmit","component","key","value","updatedComponent","toRegistrationProvider","error","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","toClientRegistration","jsxs","Fragment","jsx","ViewHeader","DropdownItem","PageSection","FormAccess","FormGroup","KeycloakTextInput","ValidatedOptions","HelpItem","FormProvider","DynamicComponents","ActionGroup","Button","props","Link","KeycloakSpinner"],"mappings":"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"}