import{jsxs as d,Fragment as M,jsx as t}from"react/jsx-runtime";import{useState as n}from"react";import{u as R,c as _,e as Q,a as U,g as W,q as X,P as Y,a0 as Z,a1 as S,a3 as $,I as ee,J as te,S as oe,F as re,h,L as V,dI as P,f as k,A as ie}from"./index-C9t2UlUN.js";import{D as ce}from"./DynamicComponents-D5DD9CFr.js";import{F as ae}from"./FormAccess-DnQCcStE.js";import{V as se}from"./ViewHeader-cxZm8XhN.js";import{u as F}from"./useParams-DL8-63Ov.js";import{A as le}from"./Form-Cdw1qhWG.js";import"react-dom";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./copy-icon-CYSS18Ce.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./PaginatingTableToolbar-oQUfBy2J.js";import"./ToolbarContent-D6TJq6fk.js";import"./useToggle-K3Kx99tM.js";import"./KeycloakTextInput-DrlF32nr.js";import"./Modal-Bgkd26UL.js";import"./ConfirmDialog-BDkqxnFL.js";import"./DataListItemRow-Bimi62Tu.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./FlexItem-BEayPdRt.js";import"./KeySelect-CPI9XGq0.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./KeycloakDataTable-2rLFZPhG.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";const I={config:{},executor:""};function Je(){const{t:c}=R(),A=_(),{realm:p,profileName:s}=F(),{executorName:l}=F(),{addAlert:C,addError:H}=Q(),[N,T]=n(!1),m=U().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[f,O]=n([]),[D,G]=n([]),[v,L]=n([]),[B,j]=n([]),x=W({defaultValues:I}),{control:w,reset:y,handleSubmit:q}=x,r=!!l,E=e=>{const o=e.find(a=>a.name===s)?.executors?.find(a=>a.executor===l);o&&y({config:o.configuration})};X(()=>k.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{L(e.globalProfiles),j(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const z=async()=>{const e=x.getValues(),i=B.map(o=>{if(o.name!==s)return o;const a=(o.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(r){const u=o.executors.find(K=>K.executor===l);u.configuration={...u.configuration,...e.config}}return r?o:{...o,executors:a}});try{await k.clientPolicies.createProfiles({profiles:i,globalProfiles:v}),C(c(r?"updateExecutorSuccess":"addExecutorSuccess"),ie.success),A(P({realm:p,profileName:s}))}catch(o){H(r?"updateExecutorError":"addExecutorError",o)}},g=v.find(e=>e.name===s),b=m?.find(e=>e.id===l),J=b?.properties.map(e=>{const i=r?e.defaultValue:"";return{...e,defaultValue:i}});return d(M,{children:[t(se,{titleKey:r?l:c("addExecutor"),divider:!0}),d(Y,{variant:"light",children:[d(ae,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",isReadOnly:!!g,children:[t(Z,{label:c("executorType"),fieldId:"kc-executorType",labelIcon:f.length>0&&f[0].helpText!==""?t(S,{helpText:f[0].helpText,fieldLabelId:"executorTypeHelpText"}):r?t(S,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:t($,{name:"executor",defaultValue:"",control:w,render:({field:e})=>t(ee,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:i=>T(i),onSelect:(i,o)=>{y({...I,executor:o.toString()});const a=m?.filter(u=>u.id===o);O(a??[]),G(a?.[0].properties??[]),T(!1)},selections:r?l:e.value,variant:te.single,"data-testid":"executorType-select","aria-label":c("executorType"),isOpen:N,maxHeight:580,isDisabled:r,children:m?.map(i=>t(oe,{selected:i.id===e.value,value:i.id,description:i.helpText},i.id))})})}),t(re,{...x,children:t(ce,{properties:r?J:D})}),!g&&d(le,{children:[t(h,{variant:"primary",onClick:()=>q(z)(),"data-testid":"addExecutor-saveBtn",children:c(r?"save":"add")}),t(h,{variant:"link",component:e=>t(V,{...e,to:P({realm:p,profileName:s})}),"data-testid":"addExecutor-cancelBtn",children:c("cancel")})]})]}),r&&g&&t("div",{className:"kc-backToProfile",children:t(h,{component:e=>t(V,{...e,to:P({realm:p,profileName:s})}),variant:"primary",children:c("back")})})]})]})}export{Je as default};
//# sourceMappingURL=ExecutorForm-DfnG44vh.js.map
