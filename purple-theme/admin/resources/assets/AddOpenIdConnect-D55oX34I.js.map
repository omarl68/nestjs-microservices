{"version":3,"file":"AddOpenIdConnect-D55oX34I.js","sources":["../../src/identity-providers/add/OpenIdConnectSettings.tsx","../../src/identity-providers/add/AddOpenIdConnect.tsx"],"sourcesContent":["import { FormGroup, Title } from \"@patternfly/react-core\";\nimport { useFormContext } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { HelpItem } from \"ui-shared\";\n\nimport { adminClient } from \"../../admin-client\";\nimport { JsonFileUpload } from \"../../components/json-file-upload/JsonFileUpload\";\nimport { DiscoveryEndpointField } from \"../component/DiscoveryEndpointField\";\nimport { DiscoverySettings } from \"./DiscoverySettings\";\n\nexport const OpenIdConnectSettings = () => {\n  const { t } = useTranslation();\n  const id = \"oidc\";\n\n  const {\n    setValue,\n    setError,\n    clearErrors,\n    formState: { errors },\n  } = useFormContext();\n\n  const setupForm = (result: any) => {\n    Object.keys(result).map((k) => setValue(`config.${k}`, result[k]));\n  };\n\n  const fileUpload = async (obj?: object) => {\n    clearErrors(\"discoveryError\");\n    if (!obj) {\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append(\"providerId\", id);\n    formData.append(\"file\", new Blob([JSON.stringify(obj)]));\n\n    try {\n      const result =\n        await adminClient.identityProviders.importFromUrl(formData);\n      setupForm(result);\n    } catch (error) {\n      setError(\"discoveryError\", {\n        type: \"manual\",\n        message: (error as Error).message,\n      });\n    }\n  };\n\n  return (\n    <>\n      <Title headingLevel=\"h2\" size=\"xl\" className=\"kc-form-panel__title\">\n        {t(\"oidcSettings\")}\n      </Title>\n\n      <DiscoveryEndpointField\n        id=\"oidc\"\n        fileUpload={\n          <FormGroup\n            label={t(\"importConfig\")}\n            fieldId=\"kc-import-config\"\n            labelIcon={\n              <HelpItem\n                helpText={t(\"importConfigHelp\")}\n                fieldLabelId=\"importConfig\"\n              />\n            }\n            validated={errors.discoveryError ? \"error\" : \"default\"}\n            helperTextInvalid={errors.discoveryError?.message as string}\n          >\n            <JsonFileUpload\n              id=\"kc-import-config\"\n              helpText={t(\"identity=providers-help:jsonFileUpload\")}\n              hideDefaultPreview\n              unWrap\n              validated={errors.discoveryError ? \"error\" : \"default\"}\n              onChange={(value) => fileUpload(value)}\n            />\n          </FormGroup>\n        }\n      >\n        {(readonly) => <DiscoverySettings readOnly={readonly} />}\n      </DiscoveryEndpointField>\n    </>\n  );\n};\n","import type IdentityProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/identityProviderRepresentation\";\nimport {\n  ActionGroup,\n  AlertVariant,\n  Button,\n  PageSection,\n} from \"@patternfly/react-core\";\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useLocation, useNavigate } from \"react-router-dom\";\n\nimport { adminClient } from \"../../admin-client\";\nimport { useAlerts } from \"../../components/alert/Alerts\";\nimport { FormAccess } from \"../../components/form/FormAccess\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\nimport { toIdentityProvider } from \"../routes/IdentityProvider\";\nimport { toIdentityProviders } from \"../routes/IdentityProviders\";\nimport { OIDCAuthentication } from \"./OIDCAuthentication\";\nimport { OIDCGeneralSettings } from \"./OIDCGeneralSettings\";\nimport { OpenIdConnectSettings } from \"./OpenIdConnectSettings\";\n\ntype DiscoveryIdentity = IdentityProviderRepresentation & {\n  discoveryEndpoint?: string;\n};\n\nexport default function AddOpenIdConnect() {\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const { pathname } = useLocation();\n  const isKeycloak = pathname.includes(\"keycloak-oidc\");\n  const id = `${isKeycloak ? \"keycloak-\" : \"\"}oidc`;\n\n  const form = useForm<IdentityProviderRepresentation>({\n    defaultValues: { alias: id },\n  });\n  const {\n    handleSubmit,\n    formState: { isDirty },\n  } = form;\n\n  const { addAlert, addError } = useAlerts();\n  const { realm } = useRealm();\n\n  const onSubmit = async (provider: DiscoveryIdentity) => {\n    delete provider.discoveryEndpoint;\n    try {\n      await adminClient.identityProviders.create({\n        ...provider,\n        providerId: id,\n      });\n      addAlert(t(\"createIdentityProviderSuccess\"), AlertVariant.success);\n      navigate(\n        toIdentityProvider({\n          realm,\n          providerId: id,\n          alias: provider.alias!,\n          tab: \"settings\",\n        }),\n      );\n    } catch (error) {\n      addError(\"createIdentityProviderError\", error);\n    }\n  };\n\n  return (\n    <>\n      <ViewHeader\n        titleKey={t(\n          isKeycloak ? \"addKeycloakOpenIdProvider\" : \"addOpenIdProvider\",\n        )}\n      />\n      <PageSection variant=\"light\">\n        <FormProvider {...form}>\n          <FormAccess\n            role=\"manage-identity-providers\"\n            isHorizontal\n            onSubmit={handleSubmit(onSubmit)}\n          >\n            <OIDCGeneralSettings />\n            <OpenIdConnectSettings />\n            <OIDCAuthentication />\n            <ActionGroup>\n              <Button\n                isDisabled={!isDirty}\n                variant=\"primary\"\n                type=\"submit\"\n                data-testid=\"createProvider\"\n              >\n                {t(\"add\")}\n              </Button>\n              <Button\n                variant=\"link\"\n                data-testid=\"cancel\"\n                component={(props) => (\n                  <Link {...props} to={toIdentityProviders({ realm })} />\n                )}\n              >\n                {t(\"cancel\")}\n              </Button>\n            </ActionGroup>\n          </FormAccess>\n        </FormProvider>\n      </PageSection>\n    </>\n  );\n}\n"],"names":["OpenIdConnectSettings","useTranslation","id","setValue","setError","clearErrors","errors","useFormContext","setupForm","result","k","fileUpload","obj","formData","adminClient","error","jsxs","Fragment","jsx","Title","DiscoveryEndpointField","FormGroup","HelpItem","JsonFileUpload","value","readonly","DiscoverySettings","AddOpenIdConnect","navigate","useNavigate","pathname","useLocation","isKeycloak","form","useForm","handleSubmit","isDirty","addAlert","addError","useAlerts","realm","useRealm","onSubmit","provider","AlertVariant","toIdentityProvider","ViewHeader","PageSection","FormProvider","FormAccess","OIDCGeneralSettings","OIDCAuthentication","ActionGroup","Button","props","Link","toIdentityProviders"],"mappings":"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"}