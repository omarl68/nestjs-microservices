{"version":3,"file":"CreateUser-ClT-5F5A.js","sources":["../../src/user/CreateUser.tsx"],"sourcesContent":["import type GroupRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/groupRepresentation\";\nimport RealmRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/realmRepresentation\";\nimport type { UserProfileMetadata } from \"@keycloak/keycloak-admin-client/lib/defs/userProfileMetadata\";\nimport { AlertVariant, PageSection } from \"@patternfly/react-core\";\nimport { TFunction } from \"i18next\";\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { useNavigate } from \"react-router-dom\";\nimport { isUserProfileError, setUserProfileServerError } from \"ui-shared\";\n\nimport { adminClient } from \"../admin-client\";\nimport { useAlerts } from \"../components/alert/Alerts\";\nimport { KeycloakSpinner } from \"../components/keycloak-spinner/KeycloakSpinner\";\nimport { ViewHeader } from \"../components/view-header/ViewHeader\";\nimport { useRealm } from \"../context/realm-context/RealmContext\";\nimport { useFetch } from \"../utils/useFetch\";\nimport { UserForm } from \"./UserForm\";\nimport { UserFormFields, toUserRepresentation } from \"./form-state\";\nimport { toUser } from \"./routes/User\";\n\nimport \"./user-section.css\";\n\nexport default function CreateUser() {\n  const { t } = useTranslation();\n  const { addAlert, addError } = useAlerts();\n  const navigate = useNavigate();\n  const { realm: realmName } = useRealm();\n  const form = useForm<UserFormFields>({ mode: \"onChange\" });\n  const [addedGroups, setAddedGroups] = useState<GroupRepresentation[]>([]);\n  const [realm, setRealm] = useState<RealmRepresentation>();\n  const [userProfileMetadata, setUserProfileMetadata] =\n    useState<UserProfileMetadata>();\n\n  useFetch(\n    () =>\n      Promise.all([\n        adminClient.realms.findOne({ realm: realmName }),\n        adminClient.users.getProfileMetadata({ realm: realmName }),\n      ]),\n    ([realm, userProfileMetadata]) => {\n      if (!realm) {\n        throw new Error(t(\"notFound\"));\n      }\n\n      setRealm(realm);\n      form.setValue(\"attributes.locale\", realm.defaultLocale || \"\");\n      setUserProfileMetadata(userProfileMetadata);\n    },\n    [],\n  );\n\n  const save = async (data: UserFormFields) => {\n    try {\n      const createdUser = await adminClient.users.create({\n        ...toUserRepresentation(data),\n        groups: addedGroups.map((group) => group.path!),\n        enabled: true,\n      });\n\n      addAlert(t(\"userCreated\"), AlertVariant.success);\n      navigate(\n        toUser({ id: createdUser.id, realm: realmName, tab: \"settings\" }),\n      );\n    } catch (error) {\n      if (isUserProfileError(error)) {\n        setUserProfileServerError(error, form.setError, ((key, param) =>\n          t(key as string, param as any)) as TFunction);\n      } else {\n        addError(\"userCreateError\", error);\n      }\n    }\n  };\n\n  if (!realm) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <>\n      <ViewHeader\n        titleKey={t(\"createUser\")}\n        className=\"kc-username-view-header\"\n      />\n      <PageSection variant=\"light\">\n        <UserForm\n          form={form}\n          realm={realm}\n          userProfileMetadata={userProfileMetadata}\n          onGroupsUpdate={setAddedGroups}\n          save={save}\n        />\n      </PageSection>\n    </>\n  );\n}\n"],"names":["CreateUser","useTranslation","addAlert","addError","useAlerts","navigate","useNavigate","realmName","useRealm","form","useForm","addedGroups","setAddedGroups","useState","realm","setRealm","userProfileMetadata","setUserProfileMetadata","useFetch","adminClient","save","data","createdUser","toUserRepresentation","group","AlertVariant","toUser","error","isUserProfileError","setUserProfileServerError","key","param","jsxs","Fragment","jsx","ViewHeader","PageSection","UserForm","KeycloakSpinner"],"mappings":"87BAuBA,SAAwBA,IAAa,CAC7B,KAAA,CAAE,GAAMC,IACR,CAAE,SAAAC,EAAU,SAAAC,CAAS,EAAIC,EAAU,EACnCC,EAAWC,IACX,CAAE,MAAOC,CAAU,EAAIC,EAAS,EAChCC,EAAOC,EAAwB,CAAE,KAAM,UAAY,CAAA,EACnD,CAACC,EAAaC,CAAc,EAAIC,EAAgC,CAAE,CAAA,EAClE,CAACC,EAAOC,CAAQ,EAAIF,EAA8B,EAClD,CAACG,EAAqBC,CAAsB,EAChDJ,EAA8B,EAEhCK,EACE,IACE,QAAQ,IAAI,CACVC,EAAY,OAAO,QAAQ,CAAE,MAAOZ,EAAW,EAC/CY,EAAY,MAAM,mBAAmB,CAAE,MAAOZ,EAAW,CAAA,CAC1D,EACH,CAAC,CAACO,EAAOE,CAAmB,IAAM,CAChC,GAAI,CAACF,EACH,MAAM,IAAI,MAAM,EAAE,UAAU,CAAC,EAG/BC,EAASD,CAAK,EACdL,EAAK,SAAS,oBAAqBK,EAAM,eAAiB,EAAE,EAC5DG,EAAuBD,CAAmB,CAC5C,EACA,CAAC,CAAA,EAGG,MAAAI,EAAO,MAAOC,GAAyB,CACvC,GAAA,CACF,MAAMC,EAAc,MAAMH,EAAY,MAAM,OAAO,CACjD,GAAGI,EAAqBF,CAAI,EAC5B,OAAQV,EAAY,IAAKa,GAAUA,EAAM,IAAK,EAC9C,QAAS,EAAA,CACV,EAEDtB,EAAS,EAAE,aAAa,EAAGuB,EAAa,OAAO,EAC/CpB,EACEqB,EAAO,CAAE,GAAIJ,EAAY,GAAI,MAAOf,EAAW,IAAK,WAAY,CAAA,QAE3DoB,EAAO,CACVC,EAAmBD,CAAK,EACAE,EAAAF,EAAOlB,EAAK,SAAW,CAACqB,EAAKC,IACrD,EAAED,EAAeC,CAAY,CAAe,EAE9C5B,EAAS,kBAAmBwB,CAAK,CAErC,CAAA,EAGF,OAAKb,EAMDkB,EAAAC,EAAA,CAAA,SAAA,CAAAC,EAACC,EAAA,CACC,SAAU,EAAE,YAAY,EACxB,UAAU,yBAAA,CACZ,EACAD,EAACE,EAAY,CAAA,QAAQ,QACnB,SAAAF,EAACG,EAAA,CACC,KAAA5B,EACA,MAAAK,EACA,oBAAAE,EACA,eAAgBJ,EAChB,KAAAQ,CAAA,CAAA,EAEJ,CACF,CAAA,CAAA,IAlBQkB,EAAgB,CAAA,CAAA,CAoB5B"}