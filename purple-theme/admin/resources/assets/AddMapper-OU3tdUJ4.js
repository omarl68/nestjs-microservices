import{jsxs as g,Fragment as K,jsx as e}from"react/jsx-runtime";import{useState as O}from"react";import{u as U,a0 as C,a1 as V,a2 as p,a3 as k,I as w,J as x,S as A,g as H,e as R,c as $,p as G,b as _,B as z,f as M,A as D,bZ as q,q as J,U as Z,P as Q,D as W,F as X,h as L,L as Y,N as ee,b$ as re,r as ae,M as te}from"./index-C9t2UlUN.js";import{u as ie}from"./ConfirmDialog-BDkqxnFL.js";import{D as oe}from"./DynamicComponents-D5DD9CFr.js";import{F as se}from"./FormAccess-DnQCcStE.js";import{K as B}from"./KeycloakTextInput-DrlF32nr.js";import{V as ne}from"./ViewHeader-cxZm8XhN.js";import{u as de}from"./useParams-DL8-63Ov.js";import{A as pe}from"./Form-Cdw1qhWG.js";import"react-dom";import"./Modal-Bgkd26UL.js";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./copy-icon-CYSS18Ce.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./PaginatingTableToolbar-oQUfBy2J.js";import"./ToolbarContent-D6TJq6fk.js";import"./useToggle-K3Kx99tM.js";import"./DataListItemRow-Bimi62Tu.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./FlexItem-BEayPdRt.js";import"./KeySelect-CPI9XGq0.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./KeycloakDataTable-2rLFZPhG.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";const le=({mapperTypes:a,mapperType:l,form:F,id:h,updateMapperType:b})=>{const{t}=U(),{control:u,register:I,formState:{errors:P}}=F,[y,i]=O(!1),n=["inherit","import","legacy","force"],[o,f]=O(!1);return g(K,{children:[e(C,{label:t("name"),labelIcon:e(V,{helpText:t("addIdpMapperNameHelp"),fieldLabelId:"name"}),fieldId:"kc-name",isRequired:!0,validated:P.name?p.error:p.default,helperTextInvalid:t("required"),children:e(B,{id:"kc-name",isDisabled:!!h,validated:P.name?p.error:p.default,...I("name",{required:!0})})}),e(C,{label:t("syncModeOverride"),isRequired:!0,labelIcon:e(V,{helpText:t("syncModeOverrideHelp"),fieldLabelId:"syncModeOverride"}),fieldId:"syncMode",children:e(k,{name:"config.syncMode",defaultValue:n[0].toUpperCase(),control:u,render:({field:d})=>e(w,{toggleId:"syncMode","datatest-id":"syncmode-select",required:!0,direction:"down",onToggle:()=>f(!o),onSelect:(r,c)=>{d.onChange(c.toString().toUpperCase()),f(!1)},selections:t(`syncModes.${d.value.toLowerCase()}`),variant:x.single,"aria-label":t("syncMode"),isOpen:o,children:n.map(r=>e(A,{selected:r===d.value,"data-testid":r,value:r.toUpperCase(),children:t(`syncModes.${r}`)},r))})})}),e(C,{label:t("mapperType"),labelIcon:e(V,{helpText:l.helpText,fieldLabelId:"mapperType"}),fieldId:"identityProviderMapper",children:e(k,{name:"identityProviderMapper",defaultValue:a[0].id,control:u,render:({field:d})=>e(w,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!h,required:!0,onToggle:()=>i(!y),onSelect:(r,c)=>{const S=c;b(S),d.onChange(S.id),i(!1)},selections:l.name,variant:x.single,"aria-label":t("mapperType"),isOpen:y,children:a.map(r=>e(A,{selected:r===d.value,"datatest-id":r.id,value:r,children:r.name},r.name))})})})]})};function Re(){const{t:a}=U(),l=H({shouldUnregister:!0}),{handleSubmit:F,register:h,formState:{errors:b}}=l,{addAlert:t,addError:u}=R(),I=$(),P=G(),{realm:y}=_(),{id:i,providerId:n,alias:o}=de(),[f,d]=O(),[r,c]=O(),S=async s=>{const T=ee(s),v={...T,config:{...T.config},identityProviderAlias:o};if(i)try{await M.identityProviders.updateMapper({id:i,alias:o},{...v,id:i}),t(a("mapperSaveSuccess"),D.success)}catch(m){u(a("mapperSaveError"),m)}else try{const m=await M.identityProviders.createMapper({identityProviderMapper:v,alias:o});t(a("mapperCreateSuccess"),D.success),I(re({realm:y,alias:o,providerId:n,id:m.id}))}catch(m){u(a("mapperCreateError"),m)}},[E,N]=ie({titleKey:"deleteProviderMapper",messageKey:a("deleteMapperConfirm",{mapper:r?.name}),continueButtonLabel:"delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{await M.identityProviders.delMapper({alias:o,id:i}),t(a("deleteMapperSuccess"),D.success),I(q({providerId:n,alias:o,tab:"mappers",realm:y}))}catch(s){u("deleteErrorIdentityProvider",s)}}});J(()=>Promise.all([i?M.identityProviders.findOneMapper({alias:o,id:i}):null,M.identityProviders.findMapperTypes({alias:o})]),([s,T])=>{const v=P(Object.values(T),ae("name"));s?(c(v.find(({id:m})=>m===s.identityProviderMapper)),j(s)):c(v[0]),d(v)},[]);const j=s=>{te(s,l.setValue)};return!f||!r?e(Z,{}):g(Q,{variant:"light",children:[e(N,{}),e(ne,{className:"kc-add-mapper-title",titleKey:i?a("editIdPMapper",{providerId:n[0].toUpperCase()+n.substring(1)}):a("addIdPMapper",{providerId:n[0].toUpperCase()+n.substring(1)}),dropdownItems:i?[e(W,{onClick:E,children:a("delete")},"delete")]:void 0,divider:!0}),g(se,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:F(S),className:"pf-u-mt-lg",children:[i&&e(C,{label:a("id"),fieldId:"kc-name",validated:b.name?p.error:p.default,helperTextInvalid:a("required"),children:e(B,{value:r.id,id:"kc-name",isDisabled:!!i,validated:b.name?p.error:p.default,...h("name")})}),r.properties&&g(K,{children:[e(le,{form:l,id:i,mapperTypes:f,updateMapperType:c,mapperType:r}),e(X,{...l,children:e(oe,{properties:r.properties})})]}),g(pe,{children:[e(L,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:a("save")}),e(L,{"data-testid":"new-mapper-cancel-button",variant:"link",component:s=>e(Y,{...s,to:q({realm:y,providerId:n,alias:o,tab:"mappers"})}),children:a("cancel")})]})]})]})}export{Re as default};
//# sourceMappingURL=AddMapper-OU3tdUJ4.js.map
