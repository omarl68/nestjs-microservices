import{jsxs as d,Fragment as H,jsx as e}from"react/jsx-runtime";import{useState as L}from"react";import{u as U,Z as O,a0 as c,a1 as l,a3 as I,V as C,c as j,g as q,e as _,b as R,a as z,q as F,F as T,P as G,h as x,L as K,dJ as N,N as B,f as p,A as J,M}from"./index-C9t2UlUN.js";import{D as W}from"./DynamicComponents-D5DD9CFr.js";import{F as Z}from"./FormAccess-DnQCcStE.js";import{K as g}from"./KeycloakTextInput-DrlF32nr.js";import{u as $}from"./useParams-DL8-63Ov.js";import{E as Q}from"./ExtendedHeader-CL2wJ6yY.js";import{S as X}from"./SettingsCache-VBvTpNnN.js";import{A as Y}from"./Form-Cdw1qhWG.js";import"react-dom";import"./FileUpload-CTw4RKK1.js";import"./CodeEditor-Cp4g17EF.js";import"./copy-icon-CYSS18Ce.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./GroupPickerDialog-tI6XV7Ln.js";import"./PaginatingTableToolbar-oQUfBy2J.js";import"./ToolbarContent-D6TJq6fk.js";import"./useToggle-K3Kx99tM.js";import"./Modal-Bgkd26UL.js";import"./ConfirmDialog-BDkqxnFL.js";import"./DataListItemRow-Bimi62Tu.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./FlexItem-BEayPdRt.js";import"./KeySelect-CPI9XGq0.js";import"./MultiLineInput-DibC-IV_.js";import"./PasswordInput-CJKuHljf.js";import"./AddRoleMappingModal-BWNuJU0W.js";import"./KeycloakDataTable-2rLFZPhG.js";import"./filter-icon-C8nM2k1N.js";import"./KeycloakTextArea-DChmurIP.js";import"./ViewHeader-cxZm8XhN.js";import"./isEqual-CVfl2lzU.js";const ee=()=>{const{t:r}=U(),{control:i,register:t,watch:m}=O(),n=m("config.fullSyncPeriod","-1"),u=m("config.changedSyncPeriod","-1");return d(H,{children:[e(c,{label:r("periodicFullSync"),labelIcon:e(l,{helpText:r("periodicFullSyncHelp"),fieldLabelId:"periodicFullSync"}),fieldId:"kc-periodic-full-sync",hasNoPaddingTop:!0,children:e(I,{name:"config.fullSyncPeriod",defaultValue:"-1",control:i,render:({field:o})=>e(C,{id:"kc-periodic-full-sync","data-testid":"periodic-full-sync",onChange:s=>{o.onChange(s?"604800":"-1")},isChecked:o.value!=="-1",label:r("on"),labelOff:r("off"),"aria-label":r("periodicFullSync")})})}),n!=="-1"&&e(c,{hasNoPaddingTop:!0,label:r("fullSyncPeriod"),labelIcon:e(l,{helpText:r("fullSyncPeriodHelp"),fieldLabelId:"fullSyncPeriod"}),fieldId:"kc-full-sync-period",children:e(g,{type:"number",min:-1,defaultValue:"604800",id:"kc-full-sync-period","data-testid":"full-sync-period",...t("config.fullSyncPeriod")})}),e(c,{label:r("periodicChangedUsersSync"),labelIcon:e(l,{helpText:r("periodicChangedUsersSyncHelp"),fieldLabelId:"periodicChangedUsersSync"}),fieldId:"kc-periodic-changed-users-sync",hasNoPaddingTop:!0,children:e(I,{name:"config.changedSyncPeriod",defaultValue:"-1",control:i,render:({field:o})=>e(C,{id:"kc-periodic-changed-users-sync","data-testid":"periodic-changed-users-sync",onChange:s=>{o.onChange(s?"86400":"-1")},isChecked:o.value!=="-1",label:r("on"),labelOff:r("off"),"aria-label":r("periodicChangedUsersSync")})})}),u!=="-1"&&e(c,{label:r("changedUsersSyncPeriod"),labelIcon:e(l,{helpText:r("changedUsersSyncHelp"),fieldLabelId:"changedUsersSyncPeriod"}),fieldId:"kc-changed-users-sync-period",hasNoPaddingTop:!0,children:e(g,{type:"number",min:-1,defaultValue:"86400",id:"kc-changed-users-sync-period","data-testid":"changed-users-sync-period",...t("config.changedSyncPeriod")})})]})};function Le(){const{t:r}=U(),{id:i,providerId:t}=$(),m=j(),n=q({mode:"onChange"}),{register:u,reset:o,setValue:s,handleSubmit:S,formState:{errors:b,isDirty:w}}=n,{addAlert:A,addError:V}=_(),{realm:f}=R(),[D,E]=L(""),v=(z().componentTypes?.["org.keycloak.storage.UserStorageProvider"]||[]).find(a=>a.id===t);F(async()=>{if(i)return await p.components.findOne({id:i})},a=>{if(a)M(a,s);else if(i)throw new Error(r("notFound"))},[]),F(()=>p.realms.findOne({realm:f}),a=>E(a?.id),[]);const P=async a=>{const k=B({...a,config:Object.fromEntries(Object.entries(a.config||{}).map(([h,y])=>[h,Array.isArray(y)?y:[y]])),providerId:t,providerType:"org.keycloak.storage.UserStorageProvider",parentId:D});try{i?await p.components.update({id:i},k):(await p.components.create(k),m(N({realm:f}))),o({...a}),A(r(i?"userProviderSaveSuccess":"createUserProviderSuccess"),J.success)}catch(h){V(`${i?"userProviderSaveError":"createUserProviderError"}`,h)}};return d(T,{...n,children:[e(Q,{provider:t,save:()=>S(P)()}),e(G,{variant:"light",children:d(Z,{role:"manage-realm",isHorizontal:!0,className:"keycloak__user-federation__custom-form",onSubmit:S(P),children:[e(c,{label:r("uiDisplayName"),labelIcon:e(l,{helpText:r("uiDisplayNameHelp"),fieldLabelId:"uiDisplayName"}),helperTextInvalid:r("validateName"),validated:b.name?"error":"default",fieldId:"kc-ui-display-name",isRequired:!0,children:e(g,{isRequired:!0,id:"kc-ui-display-name","data-testid":"ui-name",validated:b.name?"error":"default",...u("name",{required:!0})})}),d(T,{...n,children:[e(W,{properties:v?.properties||[]}),v?.metadata.synchronizable&&e(ee,{})]}),e(X,{form:n,unWrap:!0}),d(Y,{children:[e(x,{isDisabled:!w,variant:"primary",type:"submit","data-testid":"custom-save",children:r("save")}),e(x,{variant:"link",component:a=>e(K,{...a,to:N({realm:f})}),"data-testid":"custom-cancel",children:r("cancel")})]})]})})]})}export{Le as default};
//# sourceMappingURL=CustomProviderSettings-Bi_IzEZW.js.map
