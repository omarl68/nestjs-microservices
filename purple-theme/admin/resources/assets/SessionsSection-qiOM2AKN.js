import{jsxs as y,jsx as o,Fragment as x}from"react/jsx-runtime";import{useState as m}from"react";import{u as k,e as O,b as D,g as I,q,h as S,B as E,Y as K,a0 as U,a2 as v,dz as V,f as g,A as r,D as L,ag as P,P as M,I as j,S as T,d0 as z}from"./index-C9t2UlUN.js";import{u as G}from"./ConfirmDialog-BDkqxnFL.js";import{V as H}from"./ViewHeader-cxZm8XhN.js";import{K as $}from"./KeycloakTextInput-DrlF32nr.js";import{M as Y,a as _}from"./Modal-Bgkd26UL.js";import{F as J}from"./Form-Cdw1qhWG.js";import{S as Q}from"./SessionsTable-BPkwHML9.js";import{u as W}from"./useToggle-K3Kx99tM.js";import{F as X}from"./filter-icon-C8nM2k1N.js";import"react-dom";import"./ToolbarContent-D6TJq6fk.js";import"./PaginatingTableToolbar-oQUfBy2J.js";import"./EmptyStateBody-CyIhnUop.js";import"./EmptyStateSecondaryActions-BekVwNvY.js";import"./KeycloakDataTable-2rLFZPhG.js";import"./grip-vertical-icon-B_ub3hpF.js";import"./_baseFlatten-BQ8y46Zj.js";import"./useFormatDate-Yp0qEhJS.js";import"./ListItem-B-msUVzK.js";const Z=({handleModalToggle:n,save:i})=>{const{t:e}=k(),{addAlert:s}=O(),{realm:a}=D(),{register:h,handleSubmit:l,formState:{errors:u}}=I(),[c,b]=m(),[w,A]=m(0),d=()=>{A(new Date().getTime())};q(()=>g.realms.findOne({realm:a}),t=>{b(t)},[w]);const B=(t,f)=>{const N=t.successRequests?.length||0,p=t.failedRequests?.length||0;N===0&&p===0?s(e("noAdminUrlSet"),r.warning):p>0?(s(e(""+f+"Success",{successNodes:t.successRequests}),r.success),s(e(""+f+"Fail",{failedNodes:t.failedRequests}),r.danger)):s(e(""+f+"Success",{successNodes:t.successRequests}),r.success)},C=async()=>{try{await g.realms.update({realm:a},{realm:a,notBefore:Date.now()/1e3}),s(e("notBeforeSuccess"),r.success)}catch(t){s(e("setToNowError",{error:t}),r.danger)}},R=async()=>{try{await g.realms.update({realm:a},{realm:a,notBefore:0}),s(e("notBeforeClearedSuccess"),r.success),d()}catch(t){s(e("notBeforeError",{error:t}),r.danger)}},F=async()=>{const t=await g.realms.pushRevocation({realm:a});B(t,"notBeforePush"),d()};return y(Y,{variant:_.small,title:e("revocation"),isOpen:!0,onClose:n,actions:[o(S,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{C(),n()},form:"revocation-modal-form",children:e("setToNow")},"set-to-now"),o(S,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{R(),n()},form:"revocation-modal-form",children:e("clear")},"clear"),o(S,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{F(),n()},form:"revocation-modal-form",children:e("push")},"push"),o(S,{id:"modal-cancel","data-testid":"cancel",variant:E.link,onClick:()=>{n()},children:e("cancel")},"cancel")],children:[o(K,{className:"kc-revocation-description-text",children:e("revocationDescription")}),o(J,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:l(i),children:o(U,{className:"kc-revocation-modal-form-group",label:e("notBefore"),name:"notBefore",fieldId:"not-before",validated:u.email?v.error:v.default,children:o($,{"data-testid":"not-before-input",autoFocus:!0,isReadOnly:!0,value:c?.notBefore===0?e("none"):new Date(c?.notBefore*1e3).toString(),type:"text",id:"not-before",...h("notBefore",{required:!0,pattern:V}),validated:u.email?v.error:v.default})})})]})},ee=({filterType:n,onChange:i})=>{const{t:e}=k(),[s,a]=W();return y(j,{"data-testid":"filter-session-type-select",isOpen:s,onToggle:a,toggleIcon:o(X,{}),onSelect:(h,l)=>{i(l),a()},selections:n,children:[o(T,{"data-testid":"all-sessions-option",value:"ALL",children:e("sessionsType.allSessions")}),o(T,{"data-testid":"regular-sso-option",value:"REGULAR",children:e("sessionsType.regularSSO")}),o(T,{"data-testid":"offline-option",value:"OFFLINE",children:e("sessionsType.offline")})]})};function Ae(){const{t:n}=k(),[i,e]=m(0),s=()=>e(i+1),{addError:a}=O(),{realm:h}=D(),[l,u]=m(!1),[c,b]=m("ALL"),[w,A]=m(!1),d=()=>{u(!l)},B=async(t,f,N)=>{const p=await z("ui-ext/sessions",{first:`${t}`,max:`${f}`,type:c,search:N||""});return A(p.length===0),p},[C,R]=G({titleKey:"logoutAllSessions",messageKey:"logoutAllDescription",continueButtonLabel:"confirm",onConfirm:async()=>{try{await g.realms.logoutAll({realm:h}),s()}catch(t){a("logoutAllSessionsError",t)}}}),F=[o(L,{"data-testid":"revocation",component:"button",onClick:()=>d(),children:n("revocation")},"toggle-modal"),o(L,{"data-testid":"logout-all",component:"button",isDisabled:w,onClick:C,children:n("signOutAllActiveSessions")},"delete-role")];return y(x,{children:[o(R,{}),o(H,{dropdownItems:F,titleKey:"titleSessions",subKey:"sessionExplain",helpUrl:P.sessionsUrl}),y(M,{variant:"light",className:"pf-u-p-0",children:[l&&o(Z,{handleModalToggle:d,save:()=>{d()}}),o(Q,{loader:B,isSearching:c!=="ALL",isPaginated:!0,filter:o(ee,{filterType:c,onChange:t=>{b(t),s()}})},i)]})]})}export{Ae as default};
//# sourceMappingURL=SessionsSection-qiOM2AKN.js.map
